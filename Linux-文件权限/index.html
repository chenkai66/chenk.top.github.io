<!DOCTYPE html>



<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Chen Kai">
    
    <title>
        
            Linux 文件权限 |
        
        Chen Kai Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"chenk.top","root":"/","language":"zh-CN","default_language":"zh-CN","languages":["zh-CN","en"],"path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Chen Kai Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    
    
    
    
    

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Chen Kai Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                    <li class="menu-item lang-switch lang-switch-trigger" title="Language">
                        <i class="fas fa-globe"></i>
                    </li>
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item lang-switch-trigger"><i class="fas fa-globe"></i></div>
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    
    
    
    

    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Linux 文件权限</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Chen Kai</span>
                        
                            <span class="author-label">BOSS</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    
    
    
    
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-12-15 00:00:00</span>
        <span class="mobile">2022-12-15 00:00</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Linux/">Linux</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>4.3k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>17 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>文件权限是 Linux
运维里最"基础但最容易踩坑"的部分：一边是权限不足导致服务起不来、脚本跑不动、Web
应用 403
报错；另一边是权限给大了带来安全风险（任何人都能改配置、删日志、写
crontab）。要把它用对，需要的不只是记住
<code>chmod 755</code>，而是理解<strong>权限位在文件与目录上的语义差异</strong>（r/w/x
对目录的含义与文件完全不同）、属主/属组/其他人的边界、以及
<code>umask</code>、SUID/SGID、Sticky Bit
这些机制为什么会存在、什么场景下才该用。本篇会从最小概念集出发，系统讲清
<code>rwx</code> 的语义、数字/符号写法、<code>chmod/chown</code>
的典型用法与排错思路，并用常见场景（共享目录、可执行脚本、临时目录、安全加固）解释"该怎么给权限、给到什么程度"，再补上
ACL、<code>chattr</code>
这些扩展机制与实战排障清单，让你能把权限问题一次性定位并修正确。</p>
<span id="more"></span>
<h1 id="linux-权限模型ownergroupothers-三层架构">Linux
权限模型：owner/group/others 三层架构</h1>
<h2 id="基本概念">基本概念</h2>
<p>Linux 是多用户系统，每个文件/目录都有三个身份属性：</p>
<ul>
<li><strong>属主（Owner,
u）</strong>：创建或被指定为文件/目录拥有者的用户（UID）</li>
<li><strong>属组（Group,
g）</strong>：多个用户可以同属一个组，在组内具有共享权限（GID）</li>
<li><strong>其他用户（Others,
o）</strong>：不属于该文件属主或属组的所有人</li>
</ul>
<p><strong>为什么要这么设计？</strong></p>
<ul>
<li><strong>属主</strong>：文件的"所有者"，通常有最高权限（如读写执行）</li>
<li><strong>属组</strong>：适用于团队协作（如开发组、运维组），组内成员共享权限</li>
<li><strong>其他用户</strong>：防止文件被任意用户访问（安全隔离）</li>
</ul>
<h2 id="三种权限位rwx">三种权限位（rwx）</h2>
<p>每个身份（u/g/o）都有三个权限位：</p>
<ul>
<li><strong>r（read）</strong>：读权限</li>
<li><strong>w（write）</strong>：写权限</li>
<li><strong>x（execute）</strong>：执行权限</li>
</ul>
<p><strong>示例</strong>：<code>rwxr-xr-x</code></p>
<ul>
<li>属主：<code>rwx</code>（可读可写可执行）</li>
<li>属组：<code>r-x</code>（可读可执行，不可写）</li>
<li>其他：<code>r-x</code>（可读可执行，不可写）</li>
</ul>
<p><strong>转换为数字</strong>：</p>
<ul>
<li><code>rwx</code> = 4+2+1 = 7</li>
<li><code>r-x</code> = 4+0+1 = 5</li>
<li><code>r-x</code> = 4+0+1 = 5</li>
<li>所以 <code>rwxr-xr-x</code> = <code>755</code></li>
</ul>
<hr>
<h1 id="rwx-在文件和目录上的语义差异最容易踩的坑">rwx
在文件和目录上的语义差异（最容易踩的坑）</h1>
<p><strong>这是最容易混淆的点</strong>：rwx
在文件和目录上的含义完全不同。</p>
<h2 id="对文件普通文件">对文件（普通文件）</h2>
<table>
<colgroup>
<col style="width: 6%">
<col style="width: 60%">
<col style="width: 33%">
</colgroup>
<thead>
<tr>
<th>权限</th>
<th>含义</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>r</code></td>
<td>可读取文件内容</td>
<td><code>cat file.txt</code></td>
</tr>
<tr>
<td><code>w</code></td>
<td>可修改文件内容</td>
<td><code>echo "new" &gt; file.txt</code></td>
</tr>
<tr>
<td><code>x</code></td>
<td>可执行文件（脚本需要有 shebang 如 <code>#!/bin/bash</code>）</td>
<td><code>./script.sh</code></td>
</tr>
</tbody>
</table>
<h2 id="对目录">对目录</h2>
<table>
<colgroup>
<col style="width: 6%">
<col style="width: 60%">
<col style="width: 33%">
</colgroup>
<thead>
<tr>
<th>权限</th>
<th>含义</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>r</code></td>
<td>可列出目录内容（看到文件名）</td>
<td><code>ls dir</code></td>
</tr>
<tr>
<td><code>w</code></td>
<td>可在目录内创建、删除、重命名文件（<strong>通常需要
<code>x</code></strong>）</td>
<td><code>touch dir/newfile</code></td>
</tr>
<tr>
<td><code>x</code></td>
<td>可进入目录（<code>cd</code>）、访问目录内的文件（如果知道文件名）</td>
<td><code>cd dir</code> 或 <code>cat dir/file.txt</code></td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<h3 id="情况-1目录有-r-但没有-x">情况 1：目录有 <code>r</code> 但没有
<code>x</code></h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 644 mydir  <span class="comment"># mydir 权限变成 rw-r--r--（没有 x）</span></span><br><span class="line"><span class="built_in">ls</span> mydir  <span class="comment"># ✅ 可以列出文件名</span></span><br><span class="line"><span class="built_in">cd</span> mydir  <span class="comment"># ❌ Permission denied（不能进入）</span></span><br><span class="line"><span class="built_in">cat</span> mydir/file.txt  <span class="comment"># ❌ Permission denied（不能访问文件）</span></span><br></pre></td></tr></table></figure>
<p><strong>原因</strong>：没有 <code>x</code>
就不能进入目录，也不能访问目录内的文件。</p>
<h3 id="情况-2目录有-x-但没有-r">情况 2：目录有 <code>x</code> 但没有
<code>r</code></h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 311 mydir  <span class="comment"># mydir 权限变成 -wx--x--x（有 x 但没有 r）</span></span><br><span class="line"><span class="built_in">ls</span> mydir  <span class="comment"># ❌ Permission denied（不能列出文件名）</span></span><br><span class="line"><span class="built_in">cd</span> mydir  <span class="comment"># ✅ 可以进入</span></span><br><span class="line"><span class="built_in">cat</span> mydir/file.txt  <span class="comment"># ✅ 可以访问（如果知道文件名）</span></span><br></pre></td></tr></table></figure>
<p><strong>原因</strong>：有 <code>x</code> 就能进入和访问文件，但没有
<code>r</code> 就不能列出目录内容。</p>
<h3 id="情况-3目录有-w-但没有-x">情况 3：目录有 <code>w</code> 但没有
<code>x</code></h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 622 mydir  <span class="comment"># mydir 权限变成 rw--w--w-（有 w 但没有 x）</span></span><br><span class="line"><span class="built_in">touch</span> mydir/newfile  <span class="comment"># ❌ Permission denied（不能创建文件）</span></span><br></pre></td></tr></table></figure>
<p><strong>原因</strong>：虽然有 <code>w</code>，但没有 <code>x</code>
就不能进入目录，也就不能在目录内操作。</p>
<p><strong>结论</strong>：对目录来说，<strong><code>x</code>
是最基本的权限</strong>（没有 <code>x</code>
就什么都干不了）；<code>w</code> 通常需要配合 <code>x</code> 使用。</p>
<hr>
<h1 id="chmod修改权限数字和符号两种写法">chmod：修改权限（数字和符号两种写法）</h1>
<h2 id="数字写法快速且常用">数字写法（快速且常用）</h2>
<p>每个权限位对应一个数字：</p>
<ul>
<li><code>r = 4</code></li>
<li><code>w = 2</code></li>
<li><code>x = 1</code></li>
</ul>
<p>相加得到一个 3 位数（owner/group/others）：</p>
<ul>
<li><code>7 = rwx</code>（4+2+1）</li>
<li><code>6 = rw-</code>（4+2）</li>
<li><code>5 = r-x</code>（4+1）</li>
<li><code>4 = r--</code>（4）</li>
<li><code>0 = ---</code>（无权限）</li>
</ul>
<p><strong>常见示例</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 755 script.sh  <span class="comment"># owner=rwx, group=r-x, others=r-x（可执行脚本）</span></span><br><span class="line"><span class="built_in">chmod</span> 644 file.txt  <span class="comment"># owner=rw-, group=r--, others=r--（普通文件）</span></span><br><span class="line"><span class="built_in">chmod</span> 600 secret.key  <span class="comment"># owner=rw-, group=---, others=---（私钥文件）</span></span><br><span class="line"><span class="built_in">chmod</span> 777 shared  <span class="comment"># owner=rwx, group=rwx, others=rwx（完全开放，不推荐）</span></span><br></pre></td></tr></table></figure></p>
<h2 id="符号写法更安全适合增量修改">符号写法（更安全，适合增量修改）</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> u+x script.sh  <span class="comment"># 给 owner 加上执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> g-w file.txt  <span class="comment"># 去掉 group 的写权限</span></span><br><span class="line"><span class="built_in">chmod</span> o=r file.txt  <span class="comment"># 设置 others 只有读权限</span></span><br><span class="line"><span class="built_in">chmod</span> a+r notes.md  <span class="comment"># 给所有人加上读权限（a=all）</span></span><br><span class="line"><span class="built_in">chmod</span> u+rwx,g+rx,o-rwx <span class="built_in">dir</span>  <span class="comment"># 组合修改（逗号分隔）</span></span><br></pre></td></tr></table></figure>
<p><strong>递归修改</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> -R 755 <span class="built_in">dir</span>  <span class="comment"># 递归修改目录及其内容</span></span><br><span class="line"><span class="built_in">chmod</span> -R u+rwX,g+rX,o-rwx <span class="built_in">dir</span>  <span class="comment"># 大写 X 只给目录和已有执行权限的文件加 x（避免所有文件都变成可执行）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>什么时候用数字、什么时候用符号？</strong></p>
<ul>
<li><strong>数字</strong>：适合"一次性设置到目标值"（如
<code>chmod 644 file</code>）</li>
<li><strong>符号</strong>：适合"增量修改"（如
<code>chmod u+x script.sh</code>），更安全（不会误改其他权限位）</li>
</ul>
<hr>
<h1 id="chown修改文件所有权">chown：修改文件所有权</h1>
<p><code>chown</code> 用于修改文件的属主和属组。</p>
<p><strong>基本用法</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> newowner file  <span class="comment"># 只改属主</span></span><br><span class="line">sudo <span class="built_in">chown</span> newowner:newgroup file  <span class="comment"># 同时改属主和属组</span></span><br><span class="line">sudo <span class="built_in">chown</span> :newgroup file  <span class="comment"># 只改属组</span></span><br><span class="line">sudo <span class="built_in">chown</span> -R user:group <span class="built_in">dir</span>  <span class="comment"># 递归修改目录及其内容</span></span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong>：</p>
<ul>
<li>只有 <code>root</code> 或文件的当前属主可以修改所有权</li>
<li>普通用户不能把文件"送给"别人（防止恶意占用别人的配额）</li>
</ul>
<p><strong>常见场景</strong>：</p>
<ul>
<li>Web
服务器目录：<code>sudo chown -R www-data:www-data /var/www/html</code></li>
<li>共享项目目录：<code>sudo chown -R :developers /srv/project</code></li>
</ul>
<hr>
<h1 id="umask新建文件的默认权限">umask：新建文件的默认权限</h1>
<h2 id="什么是-umask">什么是 umask</h2>
<p><code>umask</code> 是 <strong>User File Creation
Mask</strong>（用户文件创建掩码），决定新建文件/目录的默认权限。</p>
<p><strong>计算方法</strong>： 1.
<strong>默认权限</strong>（系统预设）：</p>
<ul>
<li>文件：<code>666</code>（rw-rw-rw-，不包括执行权限，防止误执行）</li>
<li>目录：<code>777</code>（rwxrwxrwx，目录需要 x 才能进入）</li>
</ul>
<ol start="2" type="1">
<li><strong>实际权限</strong> = 默认权限 - umask 值</li>
</ol>
<p><strong>示例</strong>（umask = 022）：</p>
<ul>
<li>文件：<code>666 - 022 = 644</code>（rw-r--r--）</li>
<li>目录：<code>777 - 022 = 755</code>（rwxr-xr-x）</li>
</ul>
<h2 id="查看和设置-umask">查看和设置 umask</h2>
<p><strong>查看当前 umask</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">umask</span>  <span class="comment"># 输出：0022（第一位是特殊权限位，通常忽略）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>临时设置 umask</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">umask</span> 027  <span class="comment"># 设置为 027</span></span><br><span class="line"><span class="comment"># 之后新建的文件权限是 640（666-027），目录权限是 750（777-027）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>永久设置 umask</strong>（对当前用户）： 编辑
<code>~/.bashrc</code> 或 <code>~/.zshrc</code>，添加：
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">umask</span> 027</span><br></pre></td></tr></table></figure></p>
<p><strong>常见 umask 值</strong>：</p>
<table>
<colgroup>
<col style="width: 9%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 61%">
</colgroup>
<thead>
<tr>
<th>umask</th>
<th>文件权限</th>
<th>目录权限</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>022</td>
<td>644</td>
<td>755</td>
<td>默认值（文件不被其他用户修改）</td>
</tr>
<tr>
<td>027</td>
<td>640</td>
<td>750</td>
<td>更严格（仅允许同组用户访问），<strong>生产环境推荐</strong></td>
</tr>
<tr>
<td>002</td>
<td>664</td>
<td>775</td>
<td>共享环境（允许同组用户修改），<strong>开发环境</strong></td>
</tr>
<tr>
<td>077</td>
<td>600</td>
<td>700</td>
<td>极度严格（只有属主能访问），适合个人私密文件</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="特殊权限suidsgidsticky-bit">特殊权限：SUID/SGID/Sticky Bit</h1>
<p>这三种特殊权限位用于特定的运维需求，理解它们的原理和使用场景很重要。</p>
<h2 id="suidset-user-id">SUID（Set User ID）</h2>
<h3 id="原理">原理</h3>
<p>当可执行文件被赋予 SUID
权限后，<strong>普通用户执行该文件时，会以该文件的属主身份运行</strong>，而不是调用者自身的身份。</p>
<p><strong>常见示例</strong>：<code>/usr/bin/passwd</code></p>
<ul>
<li><code>ls -l /usr/bin/passwd</code> 显示：<code>-rwsr-xr-x</code>
root root（注意 owner 的 x 变成了 s）</li>
<li>普通用户执行 <code>passwd</code> 时，以 root 身份运行，才能修改
<code>/etc/shadow</code>（只有 root 能写）</li>
</ul>
<p><strong>为什么需要 SUID？</strong></p>
<ul>
<li>允许普通用户执行特定的需要高权限的操作（如修改自己的密码）</li>
<li>不需要给用户 <code>sudo</code> 权限（更安全）</li>
</ul>
<h3 id="查看和设置">查看和设置</h3>
<p><strong>查看</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l file  <span class="comment"># 如果属主的 x 位显示为 s（小写）或 S（大写），说明有 SUID</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>s</code>（小写）：SUID 且有执行权限</li>
<li><code>S</code>（大写）：SUID 但没有执行权限（通常是配置错误）</li>
</ul>
<p><strong>设置 SUID</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> u+s myprog  <span class="comment"># 符号写法</span></span><br><span class="line"><span class="built_in">chmod</span> 4755 myprog  <span class="comment"># 数字写法（4 表示 SUID，755 是基础权限）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>去除 SUID</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> u-s myprog</span><br></pre></td></tr></table></figure></p>
<h3 id="实战示例">实战示例</h3>
<p>假设你有一个 C 程序 <code>myprog.c</code>： <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Real UID=%d, Effective UID=%d\n&quot;</span>, getuid(), geteuid());</span><br><span class="line">    system(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译并设置 SUID： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gcc -o myprog myprog.c</span><br><span class="line">sudo <span class="built_in">chown</span> root myprog  <span class="comment"># 属主改为 root</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 4755 myprog  <span class="comment"># 设置 SUID + 755</span></span><br></pre></td></tr></table></figure></p>
<p>普通用户执行： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./myprog</span><br></pre></td></tr></table></figure></p>
<p>输出示例： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Real UID=1000, Effective UID=0</span><br><span class="line">uid=1000(user) gid=1000(user) euid=0(root) groups=1000(user)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Real UID 是当前用户（1000）</li>
<li>Effective UID 是文件属主（0=root）</li>
<li>所以程序以 root 权限运行</li>
</ul>
<h3 id="安全注意事项">安全注意事项</h3>
<p><strong>SUID 是高风险的</strong>：</p>
<ul>
<li>SUID 程序一旦有漏洞（如缓冲区溢出、命令注入），攻击者可以获得 root
权限</li>
<li>避免对不可信的程序设置 SUID</li>
<li>定期审计系统中的 SUID 程序</li>
</ul>
<p><strong>查找系统中所有 SUID 程序</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -4000 -<span class="built_in">type</span> f 2&gt;/dev/null</span><br></pre></td></tr></table></figure></p>
<p><strong>常见的 SUID 程序</strong>（这些是合理的）：</p>
<ul>
<li><code>/usr/bin/passwd</code>：修改密码</li>
<li><code>/usr/bin/sudo</code>：临时提权</li>
<li><code>/usr/bin/mount</code>：挂载文件系统</li>
<li><code>/usr/bin/ping</code>：发送 ICMP 包（需要 raw socket
权限）</li>
</ul>
<hr>
<h2 id="sgidset-group-id">SGID（Set Group ID）</h2>
<h3 id="应用场景">应用场景</h3>
<p>SGID 有两种用法：</p>
<h4 id="对可执行文件">1. 对可执行文件</h4>
<p>进程运行时，其有效组
ID（GID）替换为文件的属组。这在需要访问特定组资源的工具中很常见。</p>
<h4 id="对目录更常用">2. 对目录（更常用）</h4>
<p><strong>当目录设置 SGID
后，在此目录中新建的文件或子目录会继承该目录的组</strong>，而非创建者的默认组。这非常适合团队共享目录。</p>
<p><strong>示例</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /srv/project</span><br><span class="line">sudo <span class="built_in">chown</span> :developers /srv/project  <span class="comment"># 属组改为 developers</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 2775 /srv/project  <span class="comment"># 设置 SGID + 775（2 表示 SGID）</span></span><br></pre></td></tr></table></figure></p>
<p>现在，任何 developers 组的成员在 <code>/srv/project</code>
里创建的文件，属组都自动是
<code>developers</code>，组内其他成员也能访问。</p>
<h3 id="查看和设置-1">查看和设置</h3>
<p><strong>查看</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l file  <span class="comment"># 如果属组的 x 位显示为 s（小写）或 S（大写），说明有 SGID</span></span><br></pre></td></tr></table></figure></p>
<p><strong>设置 SGID</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> g+s shared_dir  <span class="comment"># 符号写法</span></span><br><span class="line"><span class="built_in">chmod</span> 2775 shared_dir  <span class="comment"># 数字写法（2 表示 SGID）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>去除 SGID</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> g-s shared_dir</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="sticky-bit粘滞位">Sticky Bit（粘滞位）</h2>
<h3 id="作用与原理">作用与原理</h3>
<p>Sticky Bit 最常见于多用户可写的公共目录，如
<code>/tmp</code>。<strong>当目录设置 Sticky Bit
后，该目录中的文件只能被其属主或 root
删除或改名</strong>，即使其他人对该目录也有写权限。</p>
<p><strong>为什么需要 Sticky Bit？</strong></p>
<ul>
<li><code>/tmp</code> 是所有用户共享的临时目录，权限是
<code>1777</code>（rwxrwxrwt）</li>
<li>如果没有 Sticky Bit，用户 A 可以删除用户 B
的临时文件（安全风险）</li>
<li>有了 Sticky Bit，用户 A 只能删除自己的文件，不能删除用户 B
的文件</li>
</ul>
<h3 id="查看和设置-2">查看和设置</h3>
<p><strong>查看</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -ld /tmp  <span class="comment"># 输出：drwxrwxrwt（最后一位是 t）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>设置 Sticky Bit</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> o+t <span class="built_in">dirname</span>  <span class="comment"># 符号写法</span></span><br><span class="line"><span class="built_in">chmod</span> 1777 /tmp  <span class="comment"># 数字写法（1 表示 Sticky Bit）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>去除 Sticky Bit</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> o-t <span class="built_in">dirname</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="常见场景与最佳实践">常见场景与最佳实践</h1>
<h2 id="场景-1可执行脚本">场景 1：可执行脚本</h2>
<p><strong>问题</strong>：<code>./script.sh: Permission denied</code></p>
<p><strong>排查</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l script.sh  <span class="comment"># 查看权限</span></span><br></pre></td></tr></table></figure></p>
<p>如果显示 <code>-rw-r--r--</code>（没有 x），说明没有执行权限。</p>
<p><strong>解决</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x script.sh  <span class="comment"># 给所有人加上执行权限</span></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="built_in">chmod</span> 755 script.sh  <span class="comment"># owner=rwx, group=r-x, others=r-x</span></span><br></pre></td></tr></table></figure></p>
<p><strong>注意</strong>：脚本还需要有 shebang（如
<code>#!/bin/bash</code>），否则需要用 <code>bash script.sh</code>
运行。</p>
<h2 id="场景-2web-服务器目录">场景 2：Web 服务器目录</h2>
<p><strong>需求</strong>：Nginx/Apache 需要读取
<code>/var/www/html</code> 里的文件。</p>
<p><strong>排查</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -ld /var/www /var/www/html</span><br><span class="line"><span class="built_in">ls</span> -l /var/www/html/index.html</span><br></pre></td></tr></table></figure></p>
<p><strong>常见问题</strong>：</p>
<ul>
<li>目录权限不足（Nginx 用户没有 x 权限，不能进入）</li>
<li>文件权限不足（Nginx 用户没有 r 权限，不能读取）</li>
</ul>
<p><strong>解决</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> -R www-data:www-data /var/www/html  <span class="comment"># 属主改为 www-data</span></span><br><span class="line">sudo <span class="built_in">chmod</span> -R 755 /var/www/html  <span class="comment"># 目录和文件都设为 755</span></span><br><span class="line"><span class="comment"># 或者更严格</span></span><br><span class="line">sudo find /var/www/html -<span class="built_in">type</span> d -<span class="built_in">exec</span> <span class="built_in">chmod</span> 755 &#123;&#125; \;  <span class="comment"># 目录 755</span></span><br><span class="line">sudo find /var/www/html -<span class="built_in">type</span> f -<span class="built_in">exec</span> <span class="built_in">chmod</span> 644 &#123;&#125; \;  <span class="comment"># 文件 644</span></span><br></pre></td></tr></table></figure></p>
<h2 id="场景-3共享目录团队协作">场景 3：共享目录（团队协作）</h2>
<p><strong>需求</strong>：<code>/srv/project</code> 目录，developers
组的成员都能读写，其他人不能访问。</p>
<p><strong>方案</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /srv/project</span><br><span class="line">sudo <span class="built_in">chown</span> :developers /srv/project  <span class="comment"># 属组改为 developers</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 2770 /srv/project  <span class="comment"># SGID + 770（只有 owner 和 group 能访问）</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>2</code>：SGID（新建文件自动继承 developers 组）</li>
<li><code>770</code>：owner 和 group 都是 rwx，others 无权限</li>
</ul>
<p><strong>验证</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户 A（developers 组成员）创建文件</span></span><br><span class="line"><span class="built_in">touch</span> /srv/project/fileA</span><br><span class="line"><span class="built_in">ls</span> -l /srv/project/fileA  <span class="comment"># 输出：-rw-r--r-- userA developers</span></span><br></pre></td></tr></table></figure></p>
<p>文件属组自动是 <code>developers</code>，组内其他成员也能访问。</p>
<h2 id="场景-4临时目录防止互删文件">场景
4：临时目录（防止互删文件）</h2>
<p><strong>需求</strong>：<code>/tmp</code>
目录，所有用户都能创建文件，但不能删除别人的文件。</p>
<p><strong>方案</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> 1777 /tmp  <span class="comment"># Sticky Bit + 777</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>1</code>：Sticky Bit（只有属主和 root 能删除文件）</li>
<li><code>777</code>：所有用户都能读写执行</li>
</ul>
<hr>
<h1 id="扩展机制acl-和-chattr">扩展机制：ACL 和 chattr</h1>
<h2 id="aclaccess-control-lists">ACL（Access Control Lists）</h2>
<p><strong>为什么需要 ACL？</strong></p>
<ul>
<li>传统权限只能设置 owner/group/others 三层，不够灵活</li>
<li>ACL 可以为特定用户或特定组设置权限（如"用户 A 有读权限，用户 B
有写权限"）</li>
</ul>
<p><strong>查看 ACL</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getfacl file.txt</span><br></pre></td></tr></table></figure></p>
<p><strong>设置 ACL</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m u:alice:rw file.txt  <span class="comment"># 给用户 alice 读写权限</span></span><br><span class="line">setfacl -m g:dev:rx <span class="built_in">dir</span>  <span class="comment"># 给组 dev 读执行权限</span></span><br><span class="line">setfacl -x u:alice file.txt  <span class="comment"># 移除用户 alice 的 ACL</span></span><br><span class="line">setfacl -b file.txt  <span class="comment"># 移除所有 ACL</span></span><br></pre></td></tr></table></figure></p>
<p><strong>递归设置</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -R -m u:alice:rwx <span class="built_in">dir</span>  <span class="comment"># 递归设置</span></span><br></pre></td></tr></table></figure></p>
<h2 id="chattr文件属性防止误删误改">chattr：文件属性（防止误删/误改）</h2>
<p><code>chattr</code> 可以设置文件的特殊属性（ext4 文件系统支持）。</p>
<p><strong>常用属性</strong>：</p>
<ul>
<li><code>i</code>（immutable）：文件不可修改、删除、重命名（连 root
也不行，除非先去掉 i 属性）</li>
<li><code>a</code>（append-only）：文件只能追加写入，不能修改已有内容（适合日志文件）</li>
</ul>
<p><strong>设置不可修改</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo chattr +i important.conf  <span class="comment"># 文件变成不可修改</span></span><br><span class="line"><span class="built_in">rm</span> important.conf  <span class="comment"># ❌ Operation not permitted（连 root 也删不掉）</span></span><br><span class="line">sudo chattr -i important.conf  <span class="comment"># 去掉 i 属性后才能删</span></span><br></pre></td></tr></table></figure></p>
<p><strong>设置只能追加</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo chattr +a logfile.txt  <span class="comment"># 只能追加</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;new line&quot;</span> &gt;&gt; logfile.txt  <span class="comment"># ✅ 可以追加</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;overwrite&quot;</span> &gt; logfile.txt  <span class="comment"># ❌ Operation not permitted（不能覆盖）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>查看属性</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsattr file.txt</span><br></pre></td></tr></table></figure></p>
<p><strong>使用场景</strong>：</p>
<ul>
<li>保护重要配置文件（<code>/etc/fstab</code>、<code>/etc/passwd</code>）</li>
<li>防止日志文件被清空</li>
</ul>
<p><strong>chattr 的其他属性</strong>：</p>
<ul>
<li><code>d</code>（no dump）：备份时忽略该文件</li>
<li><code>s</code>（secure deletion）：删除时用 0
填充数据（安全删除）</li>
<li><code>u</code>（undeletable）：删除后内容可恢复</li>
</ul>
<p><strong>示例</strong>：保护 <code>/etc/fstab</code> 不被误删
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo chattr +i /etc/fstab</span><br><span class="line"><span class="built_in">rm</span> /etc/fstab  <span class="comment"># ❌ Operation not permitted</span></span><br><span class="line">sudo chattr -i /etc/fstab  <span class="comment"># 需要先解除保护</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="权限排障清单出问题了怎么办">权限排障清单：出问题了怎么办</h1>
<h2 id="问题-1permission-denied">问题
1：<code>Permission denied</code></h2>
<p><strong>排查步骤</strong>： 1.
确认执行用户：<code>whoami</code>（或查看服务的运行用户，如 systemd unit
文件） 2. 查看文件权限：<code>ls -l file</code> 3.
查看所有父目录权限：<code>namei -l /full/path/to/file</code>（需要安装
<code>util-linux</code> 包） 4.
检查组成员：<code>id</code>（看当前用户属于哪些组） 5.
检查特殊属性：<code>lsattr file</code>（是否有 <code>i</code> 或
<code>a</code> 属性）</p>
<p><strong>常见原因</strong>：</p>
<ul>
<li>文件没有读/写/执行权限</li>
<li>父目录没有 x 权限（不能进入）</li>
<li>用户不在文件的属组里</li>
</ul>
<p><strong>解决</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> 644 file  <span class="comment"># 给读权限</span></span><br><span class="line">sudo <span class="built_in">chmod</span> +x script.sh  <span class="comment"># 给执行权限</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 755 /path/to/parent/dir  <span class="comment"># 给父目录 x 权限</span></span><br><span class="line">sudo <span class="built_in">chown</span> user:group file  <span class="comment"># 修改所有权</span></span><br></pre></td></tr></table></figure></p>
<h2 id="问题-2web-服务器-403-forbidden">问题 2：Web 服务器 403
Forbidden</h2>
<p><strong>原因</strong>：Nginx/Apache 用户（如
<code>www-data</code>、<code>nginx</code>）没有权限读取文件。</p>
<p><strong>排查</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep nginx  <span class="comment"># 查看 nginx 运行用户</span></span><br><span class="line"><span class="built_in">ls</span> -l /var/www/html/index.html  <span class="comment"># 查看文件权限</span></span><br><span class="line">namei -l /var/www/html/index.html  <span class="comment"># 查看所有父目录权限</span></span><br></pre></td></tr></table></figure></p>
<p><strong>解决</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> -R www-data:www-data /var/www/html</span><br><span class="line">sudo <span class="built_in">chmod</span> -R 755 /var/www/html  <span class="comment"># 目录 755</span></span><br><span class="line">sudo find /var/www/html -<span class="built_in">type</span> f -<span class="built_in">exec</span> <span class="built_in">chmod</span> 644 &#123;&#125; \;  <span class="comment"># 文件 644</span></span><br></pre></td></tr></table></figure></p>
<h2 id="问题-3脚本执行失败">问题 3：脚本执行失败</h2>
<p><strong>原因</strong>：脚本没有执行权限或 shebang 错误。</p>
<p><strong>排查</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l script.sh  <span class="comment"># 查看权限</span></span><br><span class="line"><span class="built_in">head</span> -1 script.sh  <span class="comment"># 查看 shebang</span></span><br></pre></td></tr></table></figure></p>
<p><strong>解决</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x script.sh  <span class="comment"># 加执行权限</span></span><br><span class="line"><span class="comment"># 确保 shebang 正确（如 #!/bin/bash）</span></span><br></pre></td></tr></table></figure></p>
<h2 id="问题-4rm-cannot-remove-file-operation-not-permitted">问题
4：<code>rm: cannot remove 'file': Operation not permitted</code></h2>
<p><strong>原因</strong>：文件可能有 <code>i</code>
属性（不可修改/删除）。</p>
<p><strong>排查</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsattr file</span><br></pre></td></tr></table></figure></p>
<p>如果输出包含 <code>i</code>（如
<code>----i--------</code>），说明文件有 immutable 属性。</p>
<p><strong>解决</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chattr -i file  <span class="comment"># 去掉 i 属性</span></span><br><span class="line"><span class="built_in">rm</span> file  <span class="comment"># 现在可以删除了</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="总结与扩展阅读">总结与扩展阅读</h1>
<p>这篇文章涵盖了 Linux 文件权限的核心内容： 1. ✅ Linux
权限模型（owner/group/others、rwx 语义） 2. ✅ rwx
在文件和目录上的差异（最容易踩的坑） 3. ✅ chmod 和 chown
的使用（数字/符号写法） 4. ✅ umask 的原理和常见值（新建文件的默认权限）
5. ✅ 特殊权限（SUID/SGID/Sticky Bit 的原理和使用场景） 6. ✅
扩展机制（ACL、chattr） 7. ✅ 权限排障清单（Permission
denied、403、脚本执行失败等）</p>
<p><strong>扩展阅读</strong>：</p>
<ul>
<li><code>man chmod</code>：查看 chmod 的详细手册</li>
<li><code>man chown</code>：查看 chown 的详细手册</li>
<li><code>man 5 acl</code>：查看 ACL 的详细说明</li>
<li>SELinux / AppArmor：更高级的安全模型（强制访问控制 MAC）</li>
</ul>
<p><strong>下一步</strong>：</p>
<ul>
<li><strong>《Linux
用户管理》</strong>：学习如何管理用户/组、<code>/etc/passwd</code>、<code>/etc/shadow</code>、sudo
配置</li>
<li><strong>《Linux
文件操作深入解析》</strong>：学习管道、重定向、stdin/stdout/stderr、<code>xargs</code>、<code>tee</code></li>
</ul>
<hr>
<p><strong>到这里，建议已经从"会用 chmod
755"升级到"理解权限语义、能设计共享目录权限方案、能排查权限问题"。文件权限是
Linux 安全的基石，掌握了它，你就能更好地保护系统和数据。</strong></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    
    
    
    
    
    
    <ul>
        <li>本文标题：Linux 文件权限</li>
        <li>本文作者：Chen Kai</li>
        <li>创建时间：2022-12-15 00:00:00</li>
        <li>
            本文链接：https://www.chenk.top/Linux-%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Linux/">#Linux</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">#云计算</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/Linux-%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Linux 磁盘管理</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/Linux-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Linux 用户管理</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'p2Cu9MgjoKzo3VmulhNLIusH-gzGzoHsz',
                    appKey: 'QThQHg3c8sVwGpzg9lu8zEG3',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '😜 尽情赞美帅气伟大的ck吧~',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'Chen Kai';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2026&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Chen Kai</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
            </div>
        
        <div class="theme-info info-item">
            <!-- 由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a> -->
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#linux-%E6%9D%83%E9%99%90%E6%A8%A1%E5%9E%8Bownergroupothers-%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">Linux
权限模型：owner&#x2F;group&#x2F;others 三层架构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">1.1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E7%A7%8D%E6%9D%83%E9%99%90%E4%BD%8Drwx"><span class="nav-number">1.2.</span> <span class="nav-text">三种权限位（rwx）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rwx-%E5%9C%A8%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95%E4%B8%8A%E7%9A%84%E8%AF%AD%E4%B9%89%E5%B7%AE%E5%BC%82%E6%9C%80%E5%AE%B9%E6%98%93%E8%B8%A9%E7%9A%84%E5%9D%91"><span class="nav-number">2.</span> <span class="nav-text">rwx
在文件和目录上的语义差异（最容易踩的坑）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E6%96%87%E4%BB%B6%E6%99%AE%E9%80%9A%E6%96%87%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">对文件（普通文件）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E7%9B%AE%E5%BD%95"><span class="nav-number">2.2.</span> <span class="nav-text">对目录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%83%85%E5%86%B5-1%E7%9B%AE%E5%BD%95%E6%9C%89-r-%E4%BD%86%E6%B2%A1%E6%9C%89-x"><span class="nav-number">2.2.1.</span> <span class="nav-text">情况 1：目录有 r 但没有
x</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%83%85%E5%86%B5-2%E7%9B%AE%E5%BD%95%E6%9C%89-x-%E4%BD%86%E6%B2%A1%E6%9C%89-r"><span class="nav-number">2.2.2.</span> <span class="nav-text">情况 2：目录有 x 但没有
r</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%83%85%E5%86%B5-3%E7%9B%AE%E5%BD%95%E6%9C%89-w-%E4%BD%86%E6%B2%A1%E6%9C%89-x"><span class="nav-number">2.2.3.</span> <span class="nav-text">情况 3：目录有 w 但没有
x</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#chmod%E4%BF%AE%E6%94%B9%E6%9D%83%E9%99%90%E6%95%B0%E5%AD%97%E5%92%8C%E7%AC%A6%E5%8F%B7%E4%B8%A4%E7%A7%8D%E5%86%99%E6%B3%95"><span class="nav-number">3.</span> <span class="nav-text">chmod：修改权限（数字和符号两种写法）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E5%86%99%E6%B3%95%E5%BF%AB%E9%80%9F%E4%B8%94%E5%B8%B8%E7%94%A8"><span class="nav-number">3.1.</span> <span class="nav-text">数字写法（快速且常用）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E5%86%99%E6%B3%95%E6%9B%B4%E5%AE%89%E5%85%A8%E9%80%82%E5%90%88%E5%A2%9E%E9%87%8F%E4%BF%AE%E6%94%B9"><span class="nav-number">3.2.</span> <span class="nav-text">符号写法（更安全，适合增量修改）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#chown%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E6%89%80%E6%9C%89%E6%9D%83"><span class="nav-number">4.</span> <span class="nav-text">chown：修改文件所有权</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#umask%E6%96%B0%E5%BB%BA%E6%96%87%E4%BB%B6%E7%9A%84%E9%BB%98%E8%AE%A4%E6%9D%83%E9%99%90"><span class="nav-number">5.</span> <span class="nav-text">umask：新建文件的默认权限</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-umask"><span class="nav-number">5.1.</span> <span class="nav-text">什么是 umask</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E8%AE%BE%E7%BD%AE-umask"><span class="nav-number">5.2.</span> <span class="nav-text">查看和设置 umask</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E6%9D%83%E9%99%90suidsgidsticky-bit"><span class="nav-number">6.</span> <span class="nav-text">特殊权限：SUID&#x2F;SGID&#x2F;Sticky Bit</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#suidset-user-id"><span class="nav-number">6.1.</span> <span class="nav-text">SUID（Set User ID）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">6.1.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E8%AE%BE%E7%BD%AE"><span class="nav-number">6.1.2.</span> <span class="nav-text">查看和设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.1.3.</span> <span class="nav-text">实战示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">6.1.4.</span> <span class="nav-text">安全注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sgidset-group-id"><span class="nav-number">6.2.</span> <span class="nav-text">SGID（Set Group ID）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">6.2.1.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="nav-number">6.2.1.1.</span> <span class="nav-text">1. 对可执行文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E7%9B%AE%E5%BD%95%E6%9B%B4%E5%B8%B8%E7%94%A8"><span class="nav-number">6.2.1.2.</span> <span class="nav-text">2. 对目录（更常用）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E8%AE%BE%E7%BD%AE-1"><span class="nav-number">6.2.2.</span> <span class="nav-text">查看和设置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sticky-bit%E7%B2%98%E6%BB%9E%E4%BD%8D"><span class="nav-number">6.3.</span> <span class="nav-text">Sticky Bit（粘滞位）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%8E%9F%E7%90%86"><span class="nav-number">6.3.1.</span> <span class="nav-text">作用与原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%92%8C%E8%AE%BE%E7%BD%AE-2"><span class="nav-number">6.3.2.</span> <span class="nav-text">查看和设置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%9C%BA%E6%99%AF%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">7.</span> <span class="nav-text">常见场景与最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-1%E5%8F%AF%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC"><span class="nav-number">7.1.</span> <span class="nav-text">场景 1：可执行脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-2web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%AE%E5%BD%95"><span class="nav-number">7.2.</span> <span class="nav-text">场景 2：Web 服务器目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-3%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C"><span class="nav-number">7.3.</span> <span class="nav-text">场景 3：共享目录（团队协作）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-4%E4%B8%B4%E6%97%B6%E7%9B%AE%E5%BD%95%E9%98%B2%E6%AD%A2%E4%BA%92%E5%88%A0%E6%96%87%E4%BB%B6"><span class="nav-number">7.4.</span> <span class="nav-text">场景
4：临时目录（防止互删文件）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6acl-%E5%92%8C-chattr"><span class="nav-number">8.</span> <span class="nav-text">扩展机制：ACL 和 chattr</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#aclaccess-control-lists"><span class="nav-number">8.1.</span> <span class="nav-text">ACL（Access Control Lists）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#chattr%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7%E9%98%B2%E6%AD%A2%E8%AF%AF%E5%88%A0%E8%AF%AF%E6%94%B9"><span class="nav-number">8.2.</span> <span class="nav-text">chattr：文件属性（防止误删&#x2F;误改）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8E%92%E9%9A%9C%E6%B8%85%E5%8D%95%E5%87%BA%E9%97%AE%E9%A2%98%E4%BA%86%E6%80%8E%E4%B9%88%E5%8A%9E"><span class="nav-number">9.</span> <span class="nav-text">权限排障清单：出问题了怎么办</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-1permission-denied"><span class="nav-number">9.1.</span> <span class="nav-text">问题
1：Permission denied</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-2web-%E6%9C%8D%E5%8A%A1%E5%99%A8-403-forbidden"><span class="nav-number">9.2.</span> <span class="nav-text">问题 2：Web 服务器 403
Forbidden</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-3%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E5%A4%B1%E8%B4%A5"><span class="nav-number">9.3.</span> <span class="nav-text">问题 3：脚本执行失败</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-4rm-cannot-remove-file-operation-not-permitted"><span class="nav-number">9.4.</span> <span class="nav-text">问题
4：rm: cannot remove &#39;file&#39;: Operation not permitted</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB"><span class="nav-number">10.</span> <span class="nav-text">总结与扩展阅读</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>

<script src="/js/lang-switch.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
