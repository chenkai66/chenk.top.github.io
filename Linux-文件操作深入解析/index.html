<!DOCTYPE html>



<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Chen Kai">
    
    <title>
        
            Linux 文件操作深入解析 |
        
        Chen Kai Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"chenk.top","root":"/","language":"zh-CN","default_language":"zh-CN","languages":["zh-CN","en"],"path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Chen Kai Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    
    
    
    
    

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Chen Kai Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                    <li class="menu-item lang-switch lang-switch-trigger" title="Language">
                        <i class="fas fa-globe"></i>
                    </li>
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item lang-switch-trigger"><i class="fas fa-globe"></i></div>
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    
    
    
    

    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Linux 文件操作深入解析</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Chen Kai</span>
                        
                            <span class="author-label">BOSS</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    
    
    
    
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2025-01-18 00:00:00</span>
        <span class="mobile">2025-01-18 00:00</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Linux/">Linux</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>5.7k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>25 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>在命令行里真正拉开效率差距的能力，不是会多少命令，而是能不能把命令"拼起来"——把小工具串成一条清晰的数据流。管道符
<code>|</code> 正是 Unix 哲学的核心：让每个小工具只做一件事（grep
只过滤、awk 只提取字段、sort
只排序），然后把它们串成一条可读可调试的流水线。本文从数据流模型（stdin/stdout/stderr）讲起，系统梳理管道与重定向的语义差异（<code>&gt;</code>、<code>&gt;&gt;</code>、<code>2&gt;</code>、<code>2&gt;&amp;1</code>、<code>&lt;</code>
分别干什么），然后补齐日志排查、文本过滤、统计汇总、批量处理里的典型套路（什么时候该用
<code>grep/awk/sed/sort/uniq/wc/cut/tr</code>，怎么逐层缩小范围），并用实战案例（Nginx
日志分析、批量文件操作、安全删除）把"空格与换行"这类坑补上（<code>find -print0</code>
+ <code>xargs -0</code>
的正确用法）。你读完之后应该能把很多"要写脚本"的小需求，直接用一两行可读的命令解决，并且更容易看懂别人写的
one-liner。</p>
<span id="more"></span>
<h1 id="数据流模型stdinstdoutstderr-与文件描述符">数据流模型：stdin/stdout/stderr
与文件描述符</h1>
<h2 id="三个标准流">三个标准流</h2>
<p>每个 Linux 进程都有三个标准流：</p>
<table>
<colgroup>
<col style="width: 19%">
<col style="width: 17%">
<col style="width: 29%">
<col style="width: 33%">
</colgroup>
<thead>
<tr>
<th>流</th>
<th>文件描述符</th>
<th>默认行为</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>stdin</strong></td>
<td>0</td>
<td>从键盘读取输入</td>
<td><code>cat</code>（不带参数时等待用户输入）</td>
</tr>
<tr>
<td><strong>stdout</strong></td>
<td>1</td>
<td>输出到屏幕</td>
<td><code>echo "hello"</code></td>
</tr>
<tr>
<td><strong>stderr</strong></td>
<td>2</td>
<td>错误输出到屏幕</td>
<td><code>ls /nonexistent 2&gt;&amp;1</code></td>
</tr>
</tbody>
</table>
<p><strong>为什么要分 stdout 和 stderr？</strong> -
正常输出和错误输出可以分别处理（如正常输出保存到文件，错误输出显示在屏幕）
- 管道 <code>|</code> 只传递 stdout（不传递
stderr），这样错误信息不会污染数据流</p>
<p><strong>示例</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /nonexistent  <span class="comment"># 错误信息输出到 stderr（屏幕）</span></span><br><span class="line"><span class="built_in">ls</span> /nonexistent 2&gt; err.log  <span class="comment"># 错误信息重定向到 err.log</span></span><br><span class="line"><span class="built_in">ls</span> /nonexistent 2&gt;&amp;1  <span class="comment"># stderr 重定向到 stdout（合并到同一个流）</span></span><br></pre></td></tr></table></figure></p>
<h2 id="文件描述符file-descriptor-fd">文件描述符（File Descriptor,
FD）</h2>
<p>文件描述符是进程打开文件时的"句柄"，用整数表示： -
<code>0</code>：stdin - <code>1</code>：stdout - <code>2</code>：stderr
- <code>3+</code>：进程自己打开的文件</p>
<p><strong>查看进程打开的文件描述符</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /proc/$$/fd  <span class="comment"># $$ 是当前 shell 的 PID</span></span><br></pre></td></tr></table></figure></p>
<p>输出示例： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lrwx------ 1 user user 0 /proc/12345/fd/0 -&gt; /dev/pts/0  # stdin</span><br><span class="line">lrwx------ 1 user user 0 /proc/12345/fd/1 -&gt; /dev/pts/0  # stdout</span><br><span class="line">lrwx------ 1 user user 0 /proc/12345/fd/2 -&gt; /dev/pts/0  # stderr</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="重定向控制数据流的去向">重定向：控制数据流的去向</h1>
<h2 id="输出重定向stdout">输出重定向（stdout）</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> &gt; file.txt  <span class="comment"># 覆盖写入（文件存在会被清空）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;world&quot;</span> &gt;&gt; file.txt  <span class="comment"># 追加写入（在文件末尾追加）</span></span><br></pre></td></tr></table></figure>
<p><strong>常见用法</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l &gt; filelist.txt  <span class="comment"># 保存文件列表</span></span><br><span class="line"><span class="built_in">date</span> &gt;&gt; log.txt  <span class="comment"># 追加时间戳到日志</span></span><br></pre></td></tr></table></figure></p>
<h2 id="错误输出重定向stderr">错误输出重定向（stderr）</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /nonexistent 2&gt; err.log  <span class="comment"># 错误输出重定向到 err.log</span></span><br><span class="line"><span class="built_in">ls</span> /nonexistent 2&gt;&gt; err.log  <span class="comment"># 错误输出追加到 err.log</span></span><br></pre></td></tr></table></figure>
<h2 id="同时重定向-stdout-和-stderr">同时重定向 stdout 和 stderr</h2>
<h3 id="方法-121传统写法">方法
1：<code>2&gt;&amp;1</code>（传统写法）</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span> &gt; output.log 2&gt;&amp;1  <span class="comment"># stdout 和 stderr 都重定向到 output.log</span></span><br></pre></td></tr></table></figure>
<p><strong>顺序很重要</strong>： - <code>&gt; output.log</code> 先把
stdout 重定向到 output.log - <code>2&gt;&amp;1</code> 再把 stderr
重定向到 stdout 的位置（也就是 output.log）</p>
<p><strong>错误写法</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span> 2&gt;&amp;1 &gt; output.log  <span class="comment"># 错误！stderr 先重定向到 stdout（屏幕），然后 stdout 再重定向到文件</span></span><br></pre></td></tr></table></figure></p>
<h3 id="方法-2现代写法推荐">方法
2：<code>&amp;&gt;</code>（现代写法，推荐）</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span> &amp;&gt; output.log  <span class="comment"># stdout 和 stderr 都重定向到 output.log</span></span><br><span class="line"><span class="built_in">command</span> &amp;&gt;&gt; output.log  <span class="comment"># 追加模式</span></span><br></pre></td></tr></table></figure>
<h2 id="丢弃输出devnull">丢弃输出（/dev/null）</h2>
<p><code>/dev/null</code>
是一个特殊的"黑洞"文件，写入的数据会被丢弃。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span> &gt; /dev/null  <span class="comment"># 丢弃 stdout</span></span><br><span class="line"><span class="built_in">command</span> 2&gt; /dev/null  <span class="comment"># 丢弃 stderr</span></span><br><span class="line"><span class="built_in">command</span> &amp;&gt; /dev/null  <span class="comment"># 丢弃 stdout 和 stderr</span></span><br></pre></td></tr></table></figure>
<p><strong>使用场景</strong>： -
不想看到命令的输出（如定时任务里的脚本） - 只关心命令是否成功（通过
<code>$?</code> 判断退出码）</p>
<h2 id="输入重定向stdin">输入重定向（stdin）</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span> &lt; input.txt  <span class="comment"># 从 input.txt 读取输入</span></span><br></pre></td></tr></table></figure>
<p><strong>Here-document（多行输入）</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; config.txt</span></span><br><span class="line"><span class="string">line 1</span></span><br><span class="line"><span class="string">line 2</span></span><br><span class="line"><span class="string">line 3</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Here-string（单行输入）</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;error&quot;</span> &lt;&lt;&lt; <span class="string">&quot;ERROR: something bad&quot;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="管道符把命令串起来">管道符：把命令串起来</h1>
<h2 id="管道的核心思想">管道的核心思想</h2>
<p><strong>Unix
哲学</strong>：每个工具只做一件事，做好一件事，然后通过管道组合起来。</p>
<p><strong>示例</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> access.log | grep <span class="string">&quot;404&quot;</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure></p>
<p>拆解： 1. <code>cat access.log</code>：输出日志内容（stdout） 2.
<code>grep "404"</code>：从 stdin 读取，过滤出包含 "404" 的行（stdout）
3. <code>wc -l</code>：从 stdin 读取，统计行数（stdout）</p>
<p><strong>为什么这么设计？</strong> -
避免临时文件（数据在内存里流动，不写硬盘） -
可读性强（每个步骤都很清晰） -
易调试（可以逐步加管道，看每一步的输出）</p>
<h2 id="调试管道使用-tee">调试管道：使用 tee</h2>
<p><code>tee</code> 可以把数据同时输出到屏幕和文件（类似"三通管"）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> access.log | grep <span class="string">&quot;404&quot;</span> | <span class="built_in">tee</span> filtered.log | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>
<ul>
<li><code>tee filtered.log</code>：把 grep 的输出保存到
filtered.log，同时传递给下一个命令</li>
<li>这样你可以看到中间结果，方便调试</li>
</ul>
<hr>
<h1 id="文本处理工具链grepawksedcuttrsortuniq">文本处理工具链：grep/awk/sed/cut/tr/sort/uniq</h1>
<h2 id="grep过滤行">grep：过滤行</h2>
<p><code>grep</code> 是最常用的文本过滤工具，用于查找匹配的行。</p>
<p><strong>基本用法</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;pattern&quot;</span> file  <span class="comment"># 在文件中查找匹配 pattern 的行</span></span><br><span class="line"><span class="built_in">command</span> | grep <span class="string">&quot;pattern&quot;</span>  <span class="comment"># 在命令输出中查找</span></span><br></pre></td></tr></table></figure></p>
<p><strong>常用参数</strong>： - <code>-i</code>：忽略大小写 -
<code>-v</code>：反向匹配（只显示不包含 pattern 的行） -
<code>-n</code>：显示行号 - <code>-A N</code>：显示匹配行及后面 N
行（After） - <code>-B N</code>：显示匹配行及前面 N 行（Before） -
<code>-C N</code>：显示匹配行及前后各 N 行（Context） -
<code>-E</code>：扩展正则表达式（支持
<code>|</code>、<code>+</code>、<code>?</code> 等） -
<code>-r</code>：递归搜索目录</p>
<p><strong>实战示例</strong>：</p>
<h3 id="查看日志中的错误">1. 查看日志中的错误</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep -i <span class="string">&quot;error&quot;</span> /var/log/syslog  <span class="comment"># 忽略大小写查找 error</span></span><br><span class="line">grep -E <span class="string">&quot;error|fail|timeout&quot;</span> /var/log/syslog  <span class="comment"># 查找多个关键词</span></span><br></pre></td></tr></table></figure>
<h3 id="查看错误的上下文">2. 查看错误的上下文</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -C 3 <span class="string">&quot;OutOfMemoryError&quot;</span> app.log  <span class="comment"># 显示错误前后各 3 行</span></span><br></pre></td></tr></table></figure>
<h3 id="递归搜索目录">3. 递归搜索目录</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep -r <span class="string">&quot;TODO&quot;</span> /srv/project  <span class="comment"># 在项目目录中递归查找 TODO</span></span><br><span class="line">grep -rn <span class="string">&quot;import numpy&quot;</span> /srv/project  <span class="comment"># 查找并显示行号</span></span><br></pre></td></tr></table></figure>
<h3 id="统计匹配次数">4. 统计匹配次数</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep -c <span class="string">&quot;ERROR&quot;</span> app.log  <span class="comment"># 统计包含 ERROR 的行数</span></span><br><span class="line">grep <span class="string">&quot;ERROR&quot;</span> app.log | <span class="built_in">wc</span> -l  <span class="comment"># 同上（更常用）</span></span><br></pre></td></tr></table></figure>
<h2 id="awk提取字段和聚合">awk：提取字段和聚合</h2>
<p><code>awk</code>
是用于处理列式文本（如日志、CSV、表格）的强大工具。</p>
<p><strong>基本概念</strong>： - awk
按行处理文本，每行按空格（或指定分隔符）分成多个字段 - <code>$1</code>
是第一个字段，<code>$2</code> 是第二个字段，<code>$0</code> 是整行</p>
<p><strong>常用示例</strong>：</p>
<h3 id="提取字段">1. 提取字段</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginx 日志格式：IP - - [时间] &quot;GET /path HTTP/1.1&quot; 200 1234</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> access.log  <span class="comment"># 提取 IP 地址（第一列）</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> access.log  <span class="comment"># 提取请求路径（第七列）</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $9&#125;&#x27;</span> access.log  <span class="comment"># 提取状态码（第九列）</span></span><br></pre></td></tr></table></figure>
<h3 id="过滤行类似-grep">2. 过滤行（类似 grep）</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;/404/ &#123;print $0&#125;&#x27;</span> access.log  <span class="comment"># 只显示包含 404 的行</span></span><br><span class="line">awk <span class="string">&#x27;$9 &gt;= 400 &#123;print $0&#125;&#x27;</span> access.log  <span class="comment"># 只显示状态码 &gt;= 400 的行</span></span><br></pre></td></tr></table></figure>
<h3 id="统计和聚合">3. 统计和聚合</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计每个状态码的出现次数</span></span><br><span class="line">awk <span class="string">&#x27;&#123;count[$9]++&#125; END &#123;for (k in count) print k, count[k]&#125;&#x27;</span> access.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计每个 IP 的请求次数</span></span><br><span class="line">awk <span class="string">&#x27;&#123;count[$1]++&#125; END &#123;for (k in count) print k, count[k]&#125;&#x27;</span> access.log | <span class="built_in">sort</span> -nr -k2</span><br></pre></td></tr></table></figure>
<h3 id="自定义分隔符">4. 自定义分隔符</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以逗号分隔的 CSV 文件</span></span><br><span class="line">awk -F<span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> data.csv  <span class="comment"># -F 指定分隔符</span></span><br></pre></td></tr></table></figure>
<h3 id="awk-的高级应用">5. awk 的高级应用</h3>
<p><strong>条件过滤 + 字段提取</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只显示状态码为 500 的请求的 IP 和路径</span></span><br><span class="line">awk <span class="string">&#x27;$9 == 500 &#123;print $1, $7&#125;&#x27;</span> access.log</span><br></pre></td></tr></table></figure></p>
<p><strong>计算平均值</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设第 10 列是响应时间（毫秒），计算平均响应时间</span></span><br><span class="line">awk <span class="string">&#x27;&#123;sum += $10; count++&#125; END &#123;print sum/count&#125;&#x27;</span> access.log</span><br></pre></td></tr></table></figure></p>
<p><strong>按条件聚合</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计每个 IP 的总流量（假设第 10 列是字节数）</span></span><br><span class="line">awk <span class="string">&#x27;&#123;bytes[$1] += $10&#125; END &#123;for (ip in bytes) print ip, bytes[ip]&#125;&#x27;</span> access.log | <span class="built_in">sort</span> -nr -k2</span><br></pre></td></tr></table></figure></p>
<p><strong>处理 CSV 文件</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提取 CSV 文件的第 2 列和第 4 列，并过滤出第 3 列 &gt; 100 的行</span></span><br><span class="line">awk -F<span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;$3 &gt; 100 &#123;print $2, $4&#125;&#x27;</span> data.csv</span><br></pre></td></tr></table></figure></p>
<h2 id="sed文本替换和编辑">sed：文本替换和编辑</h2>
<p><code>sed</code> 是流编辑器（Stream
Editor），用于文本替换、删除、插入等操作。</p>
<p><strong>常用示例</strong>：</p>
<h3 id="替换文本">1. 替换文本</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/foo/bar/&#x27;</span> file.txt  <span class="comment"># 替换每行第一个 foo 为 bar</span></span><br><span class="line">sed <span class="string">&#x27;s/foo/bar/g&#x27;</span> file.txt  <span class="comment"># 替换每行所有 foo 为 bar（g=global）</span></span><br><span class="line">sed <span class="string">&#x27;s/foo/bar/gi&#x27;</span> file.txt  <span class="comment"># 替换时忽略大小写</span></span><br></pre></td></tr></table></figure>
<h3 id="删除行">2. 删除行</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/pattern/d&#x27;</span> file.txt  <span class="comment"># 删除包含 pattern 的行</span></span><br><span class="line">sed <span class="string">&#x27;/^$/d&#x27;</span> file.txt  <span class="comment"># 删除空行</span></span><br><span class="line">sed <span class="string">&#x27;1,10d&#x27;</span> file.txt  <span class="comment"># 删除前 10 行</span></span><br></pre></td></tr></table></figure>
<h3 id="插入和追加">3. 插入和追加</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;1i\First Line&#x27;</span> file.txt  <span class="comment"># 在第一行前插入文本</span></span><br><span class="line">sed <span class="string">&#x27;$a\Last Line&#x27;</span> file.txt  <span class="comment"># 在最后一行后追加文本</span></span><br></pre></td></tr></table></figure>
<h3 id="sed-的高级应用">4. sed 的高级应用</h3>
<p><strong>批量修改配置文件</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 Nginx 配置中的端口（80 改成 8080）</span></span><br><span class="line">sed -i <span class="string">&#x27;s/listen 80;/listen 8080;/g&#x27;</span> /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure></p>
<p><strong>提取特定范围的行</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;10,20p&#x27;</span> file.txt  <span class="comment"># 只显示第 10-20 行（-n 不输出其他行，p 打印）</span></span><br></pre></td></tr></table></figure></p>
<p><strong>删除注释行和空行</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;/^#/d; /^$/d&#x27;</span> config.conf  <span class="comment"># 删除以 # 开头的行和空行</span></span><br></pre></td></tr></table></figure></p>
<p><strong>原地修改文件（-i）</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/old/new/g&#x27;</span> file.txt  <span class="comment"># 直接修改文件（不输出到屏幕）</span></span><br><span class="line">sed -i.bak <span class="string">&#x27;s/old/new/g&#x27;</span> file.txt  <span class="comment"># 修改前备份为 file.txt.bak</span></span><br></pre></td></tr></table></figure></p>
<h2 id="cuttrsortuniq简单高效的文本工具">cut/tr/sort/uniq：简单高效的文本工具</h2>
<h3 id="cut提取字段简单场景">cut：提取字段（简单场景）</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cut</span> -d<span class="string">&#x27;,&#x27;</span> -f1 data.csv  <span class="comment"># 提取逗号分隔的第一列</span></span><br><span class="line"><span class="built_in">cut</span> -d<span class="string">&#x27;:&#x27;</span> -f1,7 /etc/passwd  <span class="comment"># 提取用户名和 shell（第 1 和第 7 列）</span></span><br></pre></td></tr></table></figure>
<h3 id="tr字符替换删除">tr：字符替换/删除</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;HELLO&quot;</span> | <span class="built_in">tr</span> <span class="string">&#x27;A-Z&#x27;</span> <span class="string">&#x27;a-z&#x27;</span>  <span class="comment"># 转小写</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;a b c&quot;</span> | <span class="built_in">tr</span> <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;\n&#x27;</span>  <span class="comment"># 把空格替换成换行</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;abc123&quot;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;0-9&#x27;</span>  <span class="comment"># 删除数字</span></span><br></pre></td></tr></table></figure>
<h3 id="sort排序">sort：排序</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span> file.txt  <span class="comment"># 按字母顺序排序</span></span><br><span class="line"><span class="built_in">sort</span> -n file.txt  <span class="comment"># 按数字排序</span></span><br><span class="line"><span class="built_in">sort</span> -r file.txt  <span class="comment"># 反向排序</span></span><br><span class="line"><span class="built_in">sort</span> -k2 file.txt  <span class="comment"># 按第二列排序</span></span><br><span class="line"><span class="built_in">sort</span> -u file.txt  <span class="comment"># 排序并去重（相当于 sort + uniq）</span></span><br></pre></td></tr></table></figure>
<h3 id="uniq去重只能去除相邻重复">uniq：去重（只能去除相邻重复）</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span> file.txt | <span class="built_in">uniq</span>  <span class="comment"># 先排序，再去重</span></span><br><span class="line"><span class="built_in">sort</span> file.txt | <span class="built_in">uniq</span> -c  <span class="comment"># 统计每行出现次数</span></span><br><span class="line"><span class="built_in">sort</span> file.txt | <span class="built_in">uniq</span> -d  <span class="comment"># 只显示重复的行</span></span><br></pre></td></tr></table></figure>
<p><strong>重要</strong>：<code>uniq</code>
只能去除<strong>相邻</strong>的重复行，所以通常要先
<code>sort</code>。</p>
<hr>
<h1 id="实战案例nginx-日志分析">实战案例：Nginx 日志分析</h1>
<p>假设你有一个 Nginx 日志文件 <code>access.log</code>，每行格式如下：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.100 - - [28/Jan/2025:12:00:00 +0000] &quot;GET /api/users HTTP/1.1&quot; 200 1234</span><br><span class="line">192.168.1.101 - - [28/Jan/2025:12:00:01 +0000] &quot;POST /api/login HTTP/1.1&quot; 404 567</span><br></pre></td></tr></table></figure></p>
<h2 id="统计访问最多的-ip">1. 统计访问最多的 IP</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> access.log | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -10</span><br></pre></td></tr></table></figure>
<p>拆解： 1. <code>awk '&#123;print $1&#125;'</code>：提取 IP 地址（第一列） 2.
<code>sort</code>：排序（让相同的 IP 相邻） 3.
<code>uniq -c</code>：去重并统计次数 4.
<code>sort -nr</code>：按次数倒序排序（-n 数字排序，-r 反向） 5.
<code>head -10</code>：只显示前 10 个</p>
<h2 id="统计访问最多的-url">2. 统计访问最多的 URL</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> access.log | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -10</span><br></pre></td></tr></table></figure>
<ul>
<li><code>$7</code> 是请求路径（如 <code>/api/users</code>）</li>
</ul>
<h2 id="统计各状态码的出现次数">3. 统计各状态码的出现次数</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;print $9&#125;&#x27;</span> access.log | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr</span><br></pre></td></tr></table></figure>
<ul>
<li><code>$9</code> 是状态码（如 200、404、500）</li>
</ul>
<p>输出示例： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1234 200</span><br><span class="line"> 567 404</span><br><span class="line"> 123 500</span><br></pre></td></tr></table></figure></p>
<h2 id="查找最近1小时的错误">4. 查找最近1小时的错误</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;28/Jan/2025:12:&quot;</span> access.log | grep -E <span class="string">&quot; (4|5)[0-9]&#123;2&#125; &quot;</span> | <span class="built_in">tail</span> -n 100</span><br></pre></td></tr></table></figure>
<ul>
<li>第一个 <code>grep</code> 过滤时间</li>
<li>第二个 <code>grep</code> 过滤 4xx 和 5xx 状态码</li>
<li><code>tail -n 100</code> 只显示最后 100 行</li>
</ul>
<hr>
<h1 id="xargs批量处理文件">xargs：批量处理文件</h1>
<p><code>xargs</code>
用于把前一个命令的输出（通常是文件列表）转换成参数，传递给下一个命令。</p>
<h2 id="为什么需要-xargs">为什么需要 xargs</h2>
<p><strong>问题</strong>：有些命令（如
<code>rm</code>、<code>cp</code>、<code>mv</code>）不支持从 stdin
读取参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.tmp&quot;</span>  <span class="comment"># 输出文件列表</span></span><br><span class="line">find . -name <span class="string">&quot;*.tmp&quot;</span> | <span class="built_in">rm</span>  <span class="comment"># ❌ 错误！rm 不从 stdin 读取参数</span></span><br></pre></td></tr></table></figure>
<p><strong>解决</strong>：用 <code>xargs</code> 把文件列表转成参数
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.tmp&quot;</span> | xargs <span class="built_in">rm</span>  <span class="comment"># ✅ 正确</span></span><br></pre></td></tr></table></figure></p>
<h2 id="基本用法">基本用法</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;file1 file2 file3&quot;</span> | xargs <span class="built_in">rm</span>  <span class="comment"># 删除三个文件</span></span><br></pre></td></tr></table></figure>
<h2 id="高级用法-i-和替换符">高级用法：<code>-i</code> 和替换符
<code>&#123;&#125;</code></h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.log&quot;</span> | xargs -i <span class="built_in">cp</span> &#123;&#125; &#123;&#125;.bak  <span class="comment"># 给每个文件复制一个 .bak 备份</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>-i</code>：启用替换符 <code>&#123;&#125;</code></li>
<li><code>&#123;&#125;</code>：代表每个输入的文件名</li>
<li><code>&#123;&#125;.bak</code>：在文件名后加 <code>.bak</code></li>
</ul>
<h2 id="处理包含空格的文件名重要">处理包含空格的文件名（重要！）</h2>
<p><strong>问题</strong>：文件名包含空格时，<code>xargs</code>
会把它当成多个参数。</p>
<p><strong>错误示例</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.txt&quot;</span> | xargs <span class="built_in">rm</span>  <span class="comment"># 如果有文件名是 &quot;my file.txt&quot;，会被当成 &quot;my&quot; 和 &quot;file.txt&quot; 两个文件</span></span><br></pre></td></tr></table></figure></p>
<p><strong>正确做法</strong>：使用 <code>find -print0</code> +
<code>xargs -0</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.txt&quot;</span> -print0 | xargs -0 <span class="built_in">rm</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>-print0</code>：用 null
字符（<code>\0</code>）分隔文件名（而不是换行）</li>
<li><code>-0</code>：xargs 用 null 字符作为分隔符</li>
</ul>
<p><strong>或者用 <code>find -exec</code></strong>（更简单）：
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.txt&quot;</span> -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; +</span><br></pre></td></tr></table></figure></p>
<h2 id="并行处理xargs--p">并行处理（xargs -P）</h2>
<p>如果有多个 CPU 核心，可以并行处理： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.json&quot;</span> -print0 | xargs -0 -P 4 -n 1 jq -c . &gt; /dev/null</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>-P 4</code>：最多同时运行 4 个进程</li>
<li><code>-n 1</code>：每次传递 1 个参数</li>
</ul>
<p><strong>适用场景</strong>： -
批量处理大量文件（如图片压缩、视频转码、JSON 验证） - 充分利用多核
CPU，加快处理速度</p>
<hr>
<h1 id="find-命令与管道的结合">find 命令与管道的结合</h1>
<p><code>find</code>
是查找文件的强大工具，结合管道可以实现复杂的批量操作。</p>
<h2 id="find-的基本用法">find 的基本用法</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">find /path -name <span class="string">&quot;pattern&quot;</span>  <span class="comment"># 查找文件名匹配 pattern 的文件</span></span><br><span class="line">find /path -<span class="built_in">type</span> f  <span class="comment"># 只查找文件（f=file）</span></span><br><span class="line">find /path -<span class="built_in">type</span> d  <span class="comment"># 只查找目录（d=directory）</span></span><br><span class="line">find /path -mtime +7  <span class="comment"># 查找 7 天前修改的文件</span></span><br><span class="line">find /path -size +100M  <span class="comment"># 查找大于 100MB 的文件</span></span><br></pre></td></tr></table></figure>
<h2 id="find-grep在文件内容中搜索">find + grep：在文件内容中搜索</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /srv/project -name <span class="string">&quot;*.py&quot;</span> -<span class="built_in">exec</span> grep -Hn <span class="string">&quot;TODO&quot;</span> &#123;&#125; +</span><br></pre></td></tr></table></figure>
<ul>
<li>查找所有 <code>.py</code> 文件</li>
<li>在文件内容中搜索 "TODO"</li>
<li><code>-H</code> 显示文件名，<code>-n</code> 显示行号</li>
</ul>
<h2 id="find-xargs批量操作">find + xargs：批量操作</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /var/log -name <span class="string">&quot;*.log&quot;</span> -mtime +30 -print0 | xargs -0 gzip</span><br></pre></td></tr></table></figure>
<ul>
<li>查找 30 天前的日志文件</li>
<li>批量压缩</li>
</ul>
<h2 id="find-sed批量替换">find + sed：批量替换</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /srv -name <span class="string">&quot;*.conf&quot;</span> -print0 | xargs -0 sed -i <span class="string">&#x27;s/old_domain/new_domain/g&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>查找所有 <code>.conf</code> 文件</li>
<li>批量替换域名</li>
</ul>
<hr>
<h1 id="实战案例批量文件操作">实战案例：批量文件操作</h1>
<h2 id="案例-1批量重命名文件">案例 1：批量重命名文件</h2>
<p>假设有一批文件
<code>img_001.jpg</code>、<code>img_002.jpg</code>，想改成
<code>photo_001.jpg</code>、<code>photo_002.jpg</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> img_*.jpg; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">mv</span> <span class="string">&quot;<span class="variable">$file</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;file/img/photo&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>或者用 <code>rename</code> 命令（需要安装）： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename <span class="string">&#x27;s/img/photo/&#x27;</span> img_*.jpg</span><br></pre></td></tr></table></figure></p>
<h2 id="案例-2批量修改文件权限">案例 2：批量修改文件权限</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find /var/www/html -<span class="built_in">type</span> f -<span class="built_in">exec</span> <span class="built_in">chmod</span> 644 &#123;&#125; +  <span class="comment"># 文件改成 644</span></span><br><span class="line">find /var/www/html -<span class="built_in">type</span> d -<span class="built_in">exec</span> <span class="built_in">chmod</span> 755 &#123;&#125; +  <span class="comment"># 目录改成 755</span></span><br></pre></td></tr></table></figure>
<h2 id="案例-3批量删除空文件">案例 3：批量删除空文件</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /tmp -<span class="built_in">type</span> f -empty -delete  <span class="comment"># 删除所有空文件</span></span><br></pre></td></tr></table></figure>
<h2 id="案例-4批量压缩日志文件">案例 4：批量压缩日志文件</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /var/log -name <span class="string">&quot;*.log&quot;</span> -mtime +7 -<span class="built_in">exec</span> gzip &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-mtime +7</code>：7 天前修改的文件</li>
<li><code>-exec gzip &#123;&#125; \;</code>：对每个文件执行 gzip 压缩</li>
</ul>
<hr>
<h1 id="高级技巧">高级技巧</h1>
<h2 id="进程替换process-substitution">进程替换（Process
Substitution）</h2>
<p><strong>语法</strong>：<code>&lt;(command)</code></p>
<p><strong>用途</strong>：把命令的输出当作临时文件使用。</p>
<p><strong>示例</strong>：比较两个排序后的文件（不生成临时文件）
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff &lt;(<span class="built_in">sort</span> file1.txt) &lt;(<span class="built_in">sort</span> file2.txt)</span><br></pre></td></tr></table></figure></p>
<p>等价于： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span> file1.txt &gt; /tmp/sorted1</span><br><span class="line"><span class="built_in">sort</span> file2.txt &gt; /tmp/sorted2</span><br><span class="line">diff /tmp/sorted1 /tmp/sorted2</span><br><span class="line"><span class="built_in">rm</span> /tmp/sorted1 /tmp/sorted2</span><br></pre></td></tr></table></figure></p>
<h2 id="并行处理xargs--p-1">并行处理（xargs -P）</h2>
<p>如果有多个 CPU 核心，可以并行处理多个文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.json&quot;</span> -print0 | xargs -0 -P 8 -n 1 jq -c . &gt; /dev/null</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-P 8</code>：最多同时运行 8 个进程</li>
<li><code>-n 1</code>：每次传递 1 个参数给命令</li>
</ul>
<hr>
<h1 id="安全与最佳实践">安全与最佳实践</h1>
<h2 id="永远不要解析-ls-的输出">1. 永远不要解析 <code>ls</code>
的输出</h2>
<p><strong>错误示例</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> | xargs <span class="built_in">rm</span>  <span class="comment"># ❌ 文件名包含空格会出错</span></span><br></pre></td></tr></table></figure></p>
<p><strong>正确做法</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -maxdepth 1 -<span class="built_in">type</span> f -print0 | xargs -0 <span class="built_in">rm</span></span><br></pre></td></tr></table></figure></p>
<h2 id="删除前先预览">2. 删除前先预览</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find . -name <span class="string">&quot;*.tmp&quot;</span> -<span class="built_in">print</span>  <span class="comment"># 先看看要删除哪些文件</span></span><br><span class="line">find . -name <span class="string">&quot;*.tmp&quot;</span> -delete  <span class="comment"># 确认无误后再删除</span></span><br></pre></td></tr></table></figure>
<h2 id="使用-set--e-和-set--o-pipefail在脚本里">3. 使用
<code>set -e</code> 和 <code>set -o pipefail</code>（在脚本里）</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e  <span class="comment"># 任何命令失败就退出</span></span><br><span class="line"><span class="built_in">set</span> -o pipefail  <span class="comment"># 管道中任何命令失败就退出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 现在如果任何步骤失败，脚本会立即退出</span></span><br><span class="line"><span class="built_in">cat</span> file.log | grep <span class="string">&quot;error&quot;</span> | process_errors.sh</span><br></pre></td></tr></table></figure>
<h2 id="引号的重要性">4. 引号的重要性</h2>
<p><strong>错误示例</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span>=<span class="string">&quot;my documents&quot;</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$dir</span>  <span class="comment"># ❌ 会删除 &quot;my&quot; 和 &quot;documents&quot; 两个目录</span></span><br></pre></td></tr></table></figure></p>
<p><strong>正确做法</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf <span class="string">&quot;<span class="variable">$dir</span>&quot;</span>  <span class="comment"># ✅ 正确删除 &quot;my documents&quot; 目录</span></span><br></pre></td></tr></table></figure></p>
<h2 id="避免命令注入在脚本里处理用户输入">5.
避免命令注入（在脚本里处理用户输入）</h2>
<p><strong>危险示例</strong>（永远不要这样写）： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户输入：filename; rm -rf /</span></span><br><span class="line">filename=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$filename</span>  <span class="comment"># ❌ 命令注入！</span></span><br></pre></td></tr></table></figure></p>
<p><strong>安全做法</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">filename=<span class="variable">$1</span></span><br><span class="line"><span class="comment"># 验证输入（只允许字母、数字、下划线、点、横杠）</span></span><br><span class="line"><span class="keyword">if</span> [[ ! <span class="string">&quot;<span class="variable">$filename</span>&quot;</span> =~ ^[a-zA-Z0-9._-]+$ ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Invalid filename&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$filename</span>&quot;</span>  <span class="comment"># ✅ 安全</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="更多实战案例">更多实战案例</h1>
<h2 id="案例生成服务器监控报告">案例：生成服务器监控报告</h2>
<p>假设你需要生成每日的服务器监控报告，包含
CPU、内存、磁盘、网络等信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">REPORT=<span class="string">&quot;/tmp/daily-report-<span class="subst">$(date +%Y%m%d)</span>.txt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 服务器监控报告 ===&quot;</span> &gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;生成时间：<span class="subst">$(date)</span>&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== CPU 负载 ===&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"><span class="built_in">uptime</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 内存使用 ===&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line">free -h &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 磁盘使用 ===&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"><span class="built_in">df</span> -h &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 占用CPU最多的10个进程 ===&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line">ps aux --<span class="built_in">sort</span>=-%cpu | <span class="built_in">head</span> -11 &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== 占用内存最多的10个进程 ===&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line">ps aux --<span class="built_in">sort</span>=-%mem | <span class="built_in">head</span> -11 &gt;&gt; <span class="string">&quot;<span class="variable">$REPORT</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;报告已生成：<span class="variable">$REPORT</span>&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="案例清理旧日志文件">案例：清理旧日志文件</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 查找并删除 30 天前的日志文件</span></span><br><span class="line">find /var/log -name <span class="string">&quot;*.log&quot;</span> -mtime +30 -print0 | xargs -0 <span class="built_in">rm</span> -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找并压缩 7 天前的日志文件</span></span><br><span class="line">find /var/log -name <span class="string">&quot;*.log&quot;</span> -mtime +7 -mtime -30 -print0 | xargs -0 gzip</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;清理完成&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="案例批量处理-csv-文件">案例：批量处理 CSV 文件</h2>
<p>假设你有一个 <code>data.csv</code> 文件： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name,age,city,salary</span><br><span class="line">Alice,30,Beijing,10000</span><br><span class="line">Bob,25,Shanghai,8000</span><br><span class="line">Charlie,35,Guangzhou,12000</span><br></pre></td></tr></table></figure></p>
<p><strong>提取所有工资大于 9000 的员工</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F<span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;NR&gt;1 &amp;&amp; $4 &gt; 9000 &#123;print $1, $4&#125;&#x27;</span> data.csv</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>NR&gt;1</code>：跳过标题行（NR 是行号）</li>
<li><code>$4 &gt; 9000</code>：第 4 列（工资）大于 9000</li>
<li><code>print $1, $4</code>：打印姓名和工资</li>
</ul>
<p><strong>计算平均工资</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F<span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;NR&gt;1 &#123;sum += $4; count++&#125; END &#123;print sum/count&#125;&#x27;</span> data.csv</span><br></pre></td></tr></table></figure></p>
<p><strong>按城市统计人数</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F<span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;NR&gt;1 &#123;count[$3]++&#125; END &#123;for (city in count) print city, count[city]&#125;&#x27;</span> data.csv</span><br></pre></td></tr></table></figure></p>
<h2 id="案例分析-apachenginx-错误日志">案例：分析 Apache/Nginx
错误日志</h2>
<p>假设你的错误日志 <code>error.log</code> 格式如下： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2025/01/28 12:00:00 [error] 1234#0: *567 connect() failed (111: Connection refused) while connecting to upstream</span><br><span class="line">2025/01/28 12:00:01 [warn] 1234#0: *568 upstream server temporarily disabled</span><br></pre></td></tr></table></figure></p>
<p><strong>提取所有错误级别的日志</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;\[error\]&#x27;</span> error.log</span><br></pre></td></tr></table></figure></p>
<p><strong>统计每种错误的出现次数</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;\[error\]&#x27;</span> error.log | awk <span class="string">&#x27;&#123;print $8, $9, $10&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr</span><br></pre></td></tr></table></figure></p>
<p><strong>查找最近 1 小时的错误</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;2025/01/28 <span class="subst">$(date -d &#x27;1 hour ago&#x27; +%H)</span>:&quot;</span> error.log | grep <span class="string">&#x27;\[error\]&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="案例处理系统日志syslog">案例：处理系统日志（syslog）</h2>
<p><strong>查找所有 SSH 登录失败记录</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;Failed password&quot;</span> /var/log/auth.log | awk <span class="string">&#x27;&#123;print $1, $2, $3, $11&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br></pre></td></tr></table></figure></p>
<ul>
<li>提取日期、时间、IP 地址</li>
<li>统计每个 IP 的失败次数</li>
</ul>
<p><strong>查找占用磁盘最多的目录</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> -sh /* 2&gt;/dev/null | <span class="built_in">sort</span> -hr | <span class="built_in">head</span> -10</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>du -sh /*</code>：查看根目录下各目录占用空间</li>
<li><code>2&gt;/dev/null</code>：丢弃错误信息（如权限不足）</li>
<li><code>sort -hr</code>：按人性化大小倒序排序</li>
<li><code>head -10</code>：只显示前 10 个</li>
</ul>
<hr>
<h1 id="命令行技巧与效率提升">命令行技巧与效率提升</h1>
<h2 id="使用命令历史history">使用命令历史（history）</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span>  <span class="comment"># 查看命令历史</span></span><br><span class="line">!123  <span class="comment"># 执行历史中第 123 条命令</span></span><br><span class="line">!!  <span class="comment"># 执行上一条命令</span></span><br><span class="line">!$  <span class="comment"># 引用上一条命令的最后一个参数</span></span><br></pre></td></tr></table></figure>
<p><strong>示例</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /tmp/mydir  <span class="comment"># 创建目录</span></span><br><span class="line"><span class="built_in">cd</span> !$  <span class="comment"># 相当于 cd /tmp/mydir</span></span><br></pre></td></tr></table></figure></p>
<h2 id="使用别名alias">使用别名（alias）</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -lah&#x27;</span>  <span class="comment"># 创建别名</span></span><br><span class="line"><span class="built_in">alias</span> grep=<span class="string">&#x27;grep --color=auto&#x27;</span>  <span class="comment"># grep 默认高亮</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">rm</span>=<span class="string">&#x27;rm -i&#x27;</span>  <span class="comment"># rm 默认询问（防止误删）</span></span><br></pre></td></tr></table></figure>
<p><strong>永久保存别名</strong>（编辑 <code>~/.bashrc</code>）：
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;alias ll=&#x27;ls -lah&#x27;&quot;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<h2 id="使用-ctrl-快捷键">使用 Ctrl 快捷键</h2>
<ul>
<li><code>Ctrl+C</code>：中断当前命令</li>
<li><code>Ctrl+Z</code>：暂停当前命令（放到后台）</li>
<li><code>Ctrl+D</code>：退出当前 shell（或结束输入）</li>
<li><code>Ctrl+L</code>：清屏（相当于 <code>clear</code>）</li>
<li><code>Ctrl+A</code>：光标移到行首</li>
<li><code>Ctrl+E</code>：光标移到行尾</li>
<li><code>Ctrl+U</code>：删除光标前的所有内容</li>
<li><code>Ctrl+K</code>：删除光标后的所有内容</li>
<li><code>Ctrl+R</code>：搜索命令历史（增量搜索）</li>
</ul>
<h2 id="使用命令替换command-substitution">使用命令替换（Command
Substitution）</h2>
<p><strong>语法</strong>：<code>$(command)</code> 或
<code>`command`</code></p>
<p><strong>示例</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前时间：<span class="subst">$(date)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前目录：<span class="subst">$(pwd)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;CPU 核心数：<span class="subst">$(nproc)</span>&quot;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>在脚本里的应用</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份文件时加上时间戳</span></span><br><span class="line"><span class="built_in">cp</span> config.conf config.conf.$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计日志文件行数并写入报告</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;今日日志行数：<span class="subst">$(wc -l &lt; today.log)</span>&quot;</span> &gt; report.txt</span><br></pre></td></tr></table></figure></p>
<h2 id="shell-脚本中的错误处理">Shell 脚本中的错误处理</h2>
<p><strong>检查命令是否成功</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> grep <span class="string">&quot;error&quot;</span> app.log &gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;发现错误！&quot;</span></span><br><span class="line">    <span class="comment"># 发送告警邮件或其他操作</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p>
<p><strong>使用 <code>||</code> 和 <code>&amp;&amp;</code>
简化条件判断</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">command</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;成功&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;失败&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> /tmp/test || &#123; <span class="built_in">echo</span> <span class="string">&quot;创建目录失败&quot;</span>; <span class="built_in">exit</span> 1; &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>安全的脚本模板</strong>： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail  <span class="comment"># -e: 任何命令失败就退出; -u: 使用未定义变量就退出; -o pipefail: 管道中任何命令失败就退出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 你的脚本逻辑</span></span><br><span class="line"><span class="built_in">cat</span> file.log | grep <span class="string">&quot;error&quot;</span> | process_errors.sh</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="总结与扩展阅读">总结与扩展阅读</h1>
<p>这篇文章涵盖了 Linux 文件操作和管道的核心内容： 1. ✅
数据流模型（stdin/stdout/stderr、文件描述符） 2. ✅
重定向（<code>&gt;</code>、<code>&gt;&gt;</code>、<code>2&gt;</code>、<code>2&gt;&amp;1</code>、<code>&lt;</code>）
3. ✅ 管道符（<code>|</code> 的原理和调试技巧） 4. ✅
文本处理工具链（grep/awk/sed/cut/tr/sort/uniq） 5. ✅ 实战案例（Nginx
日志分析、批量文件操作） 6. ✅ xargs 的正确用法（处理空格、并行处理） 7.
✅ 安全与最佳实践（不解析 ls、删除前预览、正确引号）</p>
<p><strong>扩展阅读</strong>： - <a class="link" target="_blank" rel="noopener" href="https://github.com/jlevy/the-art-of-command-line">The Art of
Command Line<i class="fas fa-external-link-alt"></i></a>：命令行技巧大全 - <code>man bash</code>：查看 Bash
的详细手册（重定向、管道等） - <code>man 1 awk</code>：查看 awk
的详细手册</p>
<p><strong>下一步</strong>： - <strong>《Linux
用户管理》</strong>：学习如何管理用户/组、<code>/etc/passwd</code>、<code>/etc/shadow</code>、sudo
配置</p>
<hr>
<p><strong>到这里，你应该已经从"会用管道"升级到"能写可读可调试的
one-liner、能快速分析日志、能安全批量处理文件"。管道和文本处理是 Linux
的核心能力，掌握了它，你就能更高效地完成运维任务。</strong></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    
    
    
    
    
    
    <ul>
        <li>本文标题：Linux 文件操作深入解析</li>
        <li>本文作者：Chen Kai</li>
        <li>创建时间：2025-01-18 00:00:00</li>
        <li>
            本文链接：https://www.chenk.top/Linux-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Linux/">#Linux</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">#云计算</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/Linux-Vim-%E8%A7%A3%E6%9E%90/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Linux Vim 解析</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/Linux-%E4%BD%BF%E7%94%A8%E5%9F%BA%E7%A1%80/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Linux 使用基础</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'p2Cu9MgjoKzo3VmulhNLIusH-gzGzoHsz',
                    appKey: 'QThQHg3c8sVwGpzg9lu8zEG3',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '😜 尽情赞美帅气伟大的ck吧~',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'Chen Kai';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2026&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Chen Kai</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
            </div>
        
        <div class="theme-info info-item">
            <!-- 由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a> -->
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%B5%81%E6%A8%A1%E5%9E%8Bstdinstdoutstderr-%E4%B8%8E%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="nav-number">1.</span> <span class="nav-text">数据流模型：stdin&#x2F;stdout&#x2F;stderr
与文件描述符</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E4%B8%AA%E6%A0%87%E5%87%86%E6%B5%81"><span class="nav-number">1.1.</span> <span class="nav-text">三个标准流</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6file-descriptor-fd"><span class="nav-number">1.2.</span> <span class="nav-text">文件描述符（File Descriptor,
FD）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E6%8E%A7%E5%88%B6%E6%95%B0%E6%8D%AE%E6%B5%81%E7%9A%84%E5%8E%BB%E5%90%91"><span class="nav-number">2.</span> <span class="nav-text">重定向：控制数据流的去向</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91stdout"><span class="nav-number">2.1.</span> <span class="nav-text">输出重定向（stdout）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E8%BE%93%E5%87%BA%E9%87%8D%E5%AE%9A%E5%90%91stderr"><span class="nav-number">2.2.</span> <span class="nav-text">错误输出重定向（stderr）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8C%E6%97%B6%E9%87%8D%E5%AE%9A%E5%90%91-stdout-%E5%92%8C-stderr"><span class="nav-number">2.3.</span> <span class="nav-text">同时重定向 stdout 和 stderr</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-121%E4%BC%A0%E7%BB%9F%E5%86%99%E6%B3%95"><span class="nav-number">2.3.1.</span> <span class="nav-text">方法
1：2&gt;&amp;1（传统写法）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-2%E7%8E%B0%E4%BB%A3%E5%86%99%E6%B3%95%E6%8E%A8%E8%8D%90"><span class="nav-number">2.3.2.</span> <span class="nav-text">方法
2：&amp;&gt;（现代写法，推荐）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%A2%E5%BC%83%E8%BE%93%E5%87%BAdevnull"><span class="nav-number">2.4.</span> <span class="nav-text">丢弃输出（&#x2F;dev&#x2F;null）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E9%87%8D%E5%AE%9A%E5%90%91stdin"><span class="nav-number">2.5.</span> <span class="nav-text">输入重定向（stdin）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AE%A1%E9%81%93%E7%AC%A6%E6%8A%8A%E5%91%BD%E4%BB%A4%E4%B8%B2%E8%B5%B7%E6%9D%A5"><span class="nav-number">3.</span> <span class="nav-text">管道符：把命令串起来</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E9%81%93%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3"><span class="nav-number">3.1.</span> <span class="nav-text">管道的核心思想</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E7%AE%A1%E9%81%93%E4%BD%BF%E7%94%A8-tee"><span class="nav-number">3.2.</span> <span class="nav-text">调试管道：使用 tee</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E9%93%BEgrepawksedcuttrsortuniq"><span class="nav-number">4.</span> <span class="nav-text">文本处理工具链：grep&#x2F;awk&#x2F;sed&#x2F;cut&#x2F;tr&#x2F;sort&#x2F;uniq</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#grep%E8%BF%87%E6%BB%A4%E8%A1%8C"><span class="nav-number">4.1.</span> <span class="nav-text">grep：过滤行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF"><span class="nav-number">4.1.1.</span> <span class="nav-text">1. 查看日志中的错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%94%99%E8%AF%AF%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">4.1.2.</span> <span class="nav-text">2. 查看错误的上下文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%92%E5%BD%92%E6%90%9C%E7%B4%A2%E7%9B%AE%E5%BD%95"><span class="nav-number">4.1.3.</span> <span class="nav-text">3. 递归搜索目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E5%8C%B9%E9%85%8D%E6%AC%A1%E6%95%B0"><span class="nav-number">4.1.4.</span> <span class="nav-text">4. 统计匹配次数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#awk%E6%8F%90%E5%8F%96%E5%AD%97%E6%AE%B5%E5%92%8C%E8%81%9A%E5%90%88"><span class="nav-number">4.2.</span> <span class="nav-text">awk：提取字段和聚合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E5%8F%96%E5%AD%97%E6%AE%B5"><span class="nav-number">4.2.1.</span> <span class="nav-text">1. 提取字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E8%A1%8C%E7%B1%BB%E4%BC%BC-grep"><span class="nav-number">4.2.2.</span> <span class="nav-text">2. 过滤行（类似 grep）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E5%92%8C%E8%81%9A%E5%90%88"><span class="nav-number">4.2.3.</span> <span class="nav-text">3. 统计和聚合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%9A%94%E7%AC%A6"><span class="nav-number">4.2.4.</span> <span class="nav-text">4. 自定义分隔符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#awk-%E7%9A%84%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8"><span class="nav-number">4.2.5.</span> <span class="nav-text">5. awk 的高级应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sed%E6%96%87%E6%9C%AC%E6%9B%BF%E6%8D%A2%E5%92%8C%E7%BC%96%E8%BE%91"><span class="nav-number">4.3.</span> <span class="nav-text">sed：文本替换和编辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%BF%E6%8D%A2%E6%96%87%E6%9C%AC"><span class="nav-number">4.3.1.</span> <span class="nav-text">1. 替换文本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%A1%8C"><span class="nav-number">4.3.2.</span> <span class="nav-text">2. 删除行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E5%92%8C%E8%BF%BD%E5%8A%A0"><span class="nav-number">4.3.3.</span> <span class="nav-text">3. 插入和追加</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sed-%E7%9A%84%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8"><span class="nav-number">4.3.4.</span> <span class="nav-text">4. sed 的高级应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cuttrsortuniq%E7%AE%80%E5%8D%95%E9%AB%98%E6%95%88%E7%9A%84%E6%96%87%E6%9C%AC%E5%B7%A5%E5%85%B7"><span class="nav-number">4.4.</span> <span class="nav-text">cut&#x2F;tr&#x2F;sort&#x2F;uniq：简单高效的文本工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cut%E6%8F%90%E5%8F%96%E5%AD%97%E6%AE%B5%E7%AE%80%E5%8D%95%E5%9C%BA%E6%99%AF"><span class="nav-number">4.4.1.</span> <span class="nav-text">cut：提取字段（简单场景）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tr%E5%AD%97%E7%AC%A6%E6%9B%BF%E6%8D%A2%E5%88%A0%E9%99%A4"><span class="nav-number">4.4.2.</span> <span class="nav-text">tr：字符替换&#x2F;删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sort%E6%8E%92%E5%BA%8F"><span class="nav-number">4.4.3.</span> <span class="nav-text">sort：排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uniq%E5%8E%BB%E9%87%8D%E5%8F%AA%E8%83%BD%E5%8E%BB%E9%99%A4%E7%9B%B8%E9%82%BB%E9%87%8D%E5%A4%8D"><span class="nav-number">4.4.4.</span> <span class="nav-text">uniq：去重（只能去除相邻重复）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8Bnginx-%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90"><span class="nav-number">5.</span> <span class="nav-text">实战案例：Nginx 日志分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E8%AE%BF%E9%97%AE%E6%9C%80%E5%A4%9A%E7%9A%84-ip"><span class="nav-number">5.1.</span> <span class="nav-text">1. 统计访问最多的 IP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E8%AE%BF%E9%97%AE%E6%9C%80%E5%A4%9A%E7%9A%84-url"><span class="nav-number">5.2.</span> <span class="nav-text">2. 统计访问最多的 URL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E5%90%84%E7%8A%B6%E6%80%81%E7%A0%81%E7%9A%84%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0"><span class="nav-number">5.3.</span> <span class="nav-text">3. 统计各状态码的出现次数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E6%9C%80%E8%BF%911%E5%B0%8F%E6%97%B6%E7%9A%84%E9%94%99%E8%AF%AF"><span class="nav-number">5.4.</span> <span class="nav-text">4. 查找最近1小时的错误</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xargs%E6%89%B9%E9%87%8F%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">xargs：批量处理文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-xargs"><span class="nav-number">6.1.</span> <span class="nav-text">为什么需要 xargs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="nav-number">6.2.</span> <span class="nav-text">基本用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95-i-%E5%92%8C%E6%9B%BF%E6%8D%A2%E7%AC%A6"><span class="nav-number">6.3.</span> <span class="nav-text">高级用法：-i 和替换符
{}</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%8C%85%E5%90%AB%E7%A9%BA%E6%A0%BC%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D%E9%87%8D%E8%A6%81"><span class="nav-number">6.4.</span> <span class="nav-text">处理包含空格的文件名（重要！）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86xargs--p"><span class="nav-number">6.5.</span> <span class="nav-text">并行处理（xargs -P）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#find-%E5%91%BD%E4%BB%A4%E4%B8%8E%E7%AE%A1%E9%81%93%E7%9A%84%E7%BB%93%E5%90%88"><span class="nav-number">7.</span> <span class="nav-text">find 命令与管道的结合</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#find-%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="nav-number">7.1.</span> <span class="nav-text">find 的基本用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#find-grep%E5%9C%A8%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E4%B8%AD%E6%90%9C%E7%B4%A2"><span class="nav-number">7.2.</span> <span class="nav-text">find + grep：在文件内容中搜索</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#find-xargs%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="nav-number">7.3.</span> <span class="nav-text">find + xargs：批量操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#find-sed%E6%89%B9%E9%87%8F%E6%9B%BF%E6%8D%A2"><span class="nav-number">7.4.</span> <span class="nav-text">find + sed：批量替换</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E6%89%B9%E9%87%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">8.</span> <span class="nav-text">实战案例：批量文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-1%E6%89%B9%E9%87%8F%E9%87%8D%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6"><span class="nav-number">8.1.</span> <span class="nav-text">案例 1：批量重命名文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-2%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90"><span class="nav-number">8.2.</span> <span class="nav-text">案例 2：批量修改文件权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-3%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E7%A9%BA%E6%96%87%E4%BB%B6"><span class="nav-number">8.3.</span> <span class="nav-text">案例 3：批量删除空文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B-4%E6%89%B9%E9%87%8F%E5%8E%8B%E7%BC%A9%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="nav-number">8.4.</span> <span class="nav-text">案例 4：批量压缩日志文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7"><span class="nav-number">9.</span> <span class="nav-text">高级技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E6%9B%BF%E6%8D%A2process-substitution"><span class="nav-number">9.1.</span> <span class="nav-text">进程替换（Process
Substitution）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E8%A1%8C%E5%A4%84%E7%90%86xargs--p-1"><span class="nav-number">9.2.</span> <span class="nav-text">并行处理（xargs -P）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">10.</span> <span class="nav-text">安全与最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B0%B8%E8%BF%9C%E4%B8%8D%E8%A6%81%E8%A7%A3%E6%9E%90-ls-%E7%9A%84%E8%BE%93%E5%87%BA"><span class="nav-number">10.1.</span> <span class="nav-text">1. 永远不要解析 ls
的输出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%89%8D%E5%85%88%E9%A2%84%E8%A7%88"><span class="nav-number">10.2.</span> <span class="nav-text">2. 删除前先预览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-set--e-%E5%92%8C-set--o-pipefail%E5%9C%A8%E8%84%9A%E6%9C%AC%E9%87%8C"><span class="nav-number">10.3.</span> <span class="nav-text">3. 使用
set -e 和 set -o pipefail（在脚本里）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E5%8F%B7%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7"><span class="nav-number">10.4.</span> <span class="nav-text">4. 引号的重要性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E5%9C%A8%E8%84%9A%E6%9C%AC%E9%87%8C%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5"><span class="nav-number">10.5.</span> <span class="nav-text">5.
避免命令注入（在脚本里处理用户输入）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9B%B4%E5%A4%9A%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="nav-number">11.</span> <span class="nav-text">更多实战案例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E7%94%9F%E6%88%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%91%E6%8E%A7%E6%8A%A5%E5%91%8A"><span class="nav-number">11.1.</span> <span class="nav-text">案例：生成服务器监控报告</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E6%B8%85%E7%90%86%E6%97%A7%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="nav-number">11.2.</span> <span class="nav-text">案例：清理旧日志文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E6%89%B9%E9%87%8F%E5%A4%84%E7%90%86-csv-%E6%96%87%E4%BB%B6"><span class="nav-number">11.3.</span> <span class="nav-text">案例：批量处理 CSV 文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-apachenginx-%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="nav-number">11.4.</span> <span class="nav-text">案例：分析 Apache&#x2F;Nginx
错误日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97syslog"><span class="nav-number">11.5.</span> <span class="nav-text">案例：处理系统日志（syslog）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8A%80%E5%B7%A7%E4%B8%8E%E6%95%88%E7%8E%87%E6%8F%90%E5%8D%87"><span class="nav-number">12.</span> <span class="nav-text">命令行技巧与效率提升</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8E%86%E5%8F%B2history"><span class="nav-number">12.1.</span> <span class="nav-text">使用命令历史（history）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%88%AB%E5%90%8Dalias"><span class="nav-number">12.2.</span> <span class="nav-text">使用别名（alias）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-ctrl-%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="nav-number">12.3.</span> <span class="nav-text">使用 Ctrl 快捷键</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2command-substitution"><span class="nav-number">12.4.</span> <span class="nav-text">使用命令替换（Command
Substitution）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shell-%E8%84%9A%E6%9C%AC%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">12.5.</span> <span class="nav-text">Shell 脚本中的错误处理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB"><span class="nav-number">13.</span> <span class="nav-text">总结与扩展阅读</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>

<script src="/js/lang-switch.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
