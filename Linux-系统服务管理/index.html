<!DOCTYPE html>



<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Chen Kai">
    
    <title>
        
            Linux 系统服务管理 |
        
        Chen Kai Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"chenk.top","root":"/","language":"zh-CN","default_language":"zh-CN","languages":["zh-CN","en"],"path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Chen Kai Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    
    
    
    
    

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Chen Kai Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                    <li class="menu-item lang-switch lang-switch-trigger" title="Language">
                        <i class="fas fa-globe"></i>
                    </li>
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item lang-switch-trigger"><i class="fas fa-globe"></i></div>
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    
    
    
    

    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Linux 系统服务管理</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Chen Kai</span>
                        
                            <span class="author-label">BOSS</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    
    
    
    
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2025-01-10 00:00:00</span>
        <span class="mobile">2025-01-10 00:00</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Linux/">Linux</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>5.2k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>20 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>在操作系统中，“服务&quot;指后台常驻的进程或守护程序（daemon）——它们在系统启动时自动运行，在后台默默工作，提供各种功能（如时间同步、防火墙、计划任务、Web 服务器、数据库等）。现代 Linux 使用 <strong>systemd</strong> 统一管理这些服务，提供了强大的依赖管理、并行启动、日志集成等功能。本文会从 systemd 的核心概念讲起，深入 <code>systemctl</code> 命令的使用，讲解常见服务（时间同步、防火墙、计划任务、SSH）的配置与排障，并教你如何自定义服务、让自己的程序开机自启。如果你是运维人员或需要管理 Linux 服务器，这篇文章会让你从&quot;会启停服务&quot;升级到&quot;能写自定义服务、能排障、能优化启动顺序”。</p>
<span id="more"></span>
<h1>systemd 核心概念：为什么要用它、它解决了什么问题</h1>
<h2 id="为什么需要服务管理器"><a class="header-anchor" href="#为什么需要服务管理器">¶</a>为什么需要服务管理器</h2>
<p>在操作系统中，“服务”（Service）是指那些长期运行在后台、对系统或用户提供某种功能的进程或守护程序（daemon）。例如：</p>
<ul>
<li><strong>时间同步服务</strong>（ntpd / ntpsec）：定期与时间服务器同步，确保系统时钟准确</li>
<li><strong>防火墙服务</strong>（firewalld / iptables）：控制网络流量，保护系统安全</li>
<li><strong>SSH 服务</strong>（sshd）：允许远程登录</li>
<li><strong>Web 服务器</strong>（nginx / apache）：处理 HTTP 请求，提供网站访问</li>
<li><strong>数据库服务</strong>（mysql / postgresql）：存储和查询数据</li>
<li><strong>计划任务服务</strong>（crond）：按时间表自动执行脚本</li>
</ul>
<p>这些服务通常需要：</p>
<ol>
<li><strong>开机自动启动</strong>（不需要手动启动）</li>
<li><strong>崩溃后自动重启</strong>（提高可用性）</li>
<li><strong>依赖关系管理</strong>（例如 Web 服务依赖网络服务，网络服务依赖网卡驱动）</li>
<li><strong>日志集成</strong>（方便排障）</li>
<li><strong>资源限制</strong>（防止某个服务占用过多 CPU/内存）</li>
</ol>
<p><strong>服务管理器</strong>就是用来统一管理这些服务的工具。</p>
<h2 id="systemd-vs-SysV-init（旧系统）"><a class="header-anchor" href="#systemd-vs-SysV-init（旧系统）">¶</a>systemd vs SysV init（旧系统）</h2>
<p>在 systemd 出现之前，Linux 使用 <strong>SysV init</strong> 作为服务管理器（CentOS 6、Ubuntu 14.04 及更早版本）。它的特点是：</p>
<ul>
<li>服务脚本放在 <code>/etc/init.d/</code> 目录下</li>
<li>使用 <code>service &lt;service&gt; start/stop/restart</code> 管理服务</li>
<li>使用 <code>chkconfig</code> 配置开机自启</li>
<li><strong>串行启动</strong>：服务按顺序一个一个启动，慢（尤其是服务很多时）</li>
<li><strong>依赖关系靠脚本手动处理</strong>：容易出错</li>
</ul>
<p><strong>systemd</strong> 是现代 Linux 发行版的服务管理器（CentOS 7+、Ubuntu 16.04+、Debian 8+），它的优点是：</p>
<ul>
<li><strong>并行启动</strong>：多个服务同时启动，快很多</li>
<li><strong>依赖关系自动处理</strong>：systemd 知道服务之间的依赖关系，自动按顺序启动</li>
<li><strong>统一的日志系统</strong>（journald）：所有服务的日志都集中管理，方便查询</li>
<li><strong>Socket 激活</strong>：某些服务可以按需启动（有连接时才启动，节省资源）</li>
<li><strong>Cgroup 集成</strong>：可以限制服务的 CPU/内存使用</li>
<li><strong>统一的命令</strong>：<code>systemctl</code> 一个命令管理所有服务</li>
</ul>
<p><strong>兼容性</strong>：systemd 向下兼容 SysV init 的命令（<code>service</code> 和 <code>chkconfig</code> 在 systemd 系统上仍然可用，但底层调用的是 systemctl）。</p>
<h2 id="systemd-的核心概念：unit"><a class="header-anchor" href="#systemd-的核心概念：unit">¶</a>systemd 的核心概念：unit</h2>
<p>在 systemd 中，<strong>一切皆 unit</strong>（单元）。Unit 是 systemd 管理的最小单位，常见的 unit 类型有：</p>
<table>
<thead>
<tr>
<th>Unit 类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>service</strong></td>
<td>最常见的类型，代表一个后台服务（进程）</td>
<td><code>sshd.service</code>、<code>nginx.service</code></td>
</tr>
<tr>
<td><strong>socket</strong></td>
<td>代表一个 IPC 或网络套接字，用于按需激活服务</td>
<td><code>sshd.socket</code>、<code>docker.socket</code></td>
</tr>
<tr>
<td><strong>target</strong></td>
<td>代表一组 unit 的集合（类似 SysV 的 runlevel）</td>
<td><code>multi-user.target</code>、<code>graphical.target</code></td>
</tr>
<tr>
<td><strong>mount</strong></td>
<td>代表一个挂载点（文件系统）</td>
<td><code>home.mount</code>、<code>tmp.mount</code></td>
</tr>
<tr>
<td><strong>timer</strong></td>
<td>代表一个定时任务（替代 cron）</td>
<td><code>logrotate.timer</code>、<code>apt-daily.timer</code></td>
</tr>
<tr>
<td><strong>device</strong></td>
<td>代表一个设备（如 USB、网卡）</td>
<td><code>dev-sda.device</code></td>
</tr>
<tr>
<td><strong>path</strong></td>
<td>监控文件/目录变化，触发服务启动</td>
<td><code>systemd-tmpfiles-clean.path</code></td>
</tr>
</tbody>
</table>
<p><strong>最常用的是 service 类型</strong>（<code>.service</code> 后缀），所以我们通常说的&quot;服务&quot;就是指 service unit。</p>
<h2 id="systemd-启动流程简述"><a class="header-anchor" href="#systemd-启动流程简述">¶</a>systemd 启动流程简述</h2>
<ol>
<li><strong>内核启动</strong>：内核加载完成后，启动 systemd（PID 1，第一个用户空间进程）</li>
<li><strong>systemd 读取配置</strong>：读取 <code>/etc/systemd/system/</code> 和 <code>/usr/lib/systemd/system/</code> 下的 unit 文件</li>
<li><strong>确定启动目标</strong>：通常是 <code>multi-user.target</code>（多用户文本模式）或 <code>graphical.target</code>（图形界面）</li>
<li><strong>解析依赖关系</strong>：根据 unit 文件中的 <code>Requires</code>、<code>After</code>、<code>Before</code> 等字段，确定启动顺序</li>
<li><strong>并行启动服务</strong>：同时启动多个没有依赖关系的服务（提高启动速度）</li>
<li><strong>进入目标状态</strong>：所有依赖的服务都启动完成后，系统进入目标状态（如登录提示符）</li>
</ol>
<hr>
<h1>systemctl 命令：日常使用的&quot;肌肉记忆&quot;</h1>
<p><code>systemctl</code> 是 systemd 的主要命令行工具，用于管理服务。这部分是你日常操作最常用的命令。</p>
<h2 id="基本操作（启动、停止、重启、查看状态）"><a class="header-anchor" href="#基本操作（启动、停止、重启、查看状态）">¶</a>基本操作（启动、停止、重启、查看状态）</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务（立即生效，但重启后失效）</span></span><br><span class="line">systemctl start &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止服务</span></span><br><span class="line">systemctl stop &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务（停止后再启动）</span></span><br><span class="line">systemctl restart &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载配置文件（不停止服务，适用于支持热重载的服务如 nginx）</span></span><br><span class="line">systemctl reload &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务状态（是否运行、PID、最近的日志、开机是否自启）</span></span><br><span class="line">systemctl status &lt;service&gt;</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start sshd       <span class="comment"># 启动 SSH 服务</span></span><br><span class="line">systemctl status sshd      <span class="comment"># 查看 SSH 服务状态</span></span><br><span class="line">systemctl reload nginx     <span class="comment"># 重新加载 nginx 配置（不停止服务）</span></span><br></pre></td></tr></table></figure>
<h2 id="开机自启管理"><a class="header-anchor" href="#开机自启管理">¶</a>开机自启管理</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置开机自启（创建符号链接到 /etc/systemd/system/multi-user.target.wants/）</span></span><br><span class="line">systemctl <span class="built_in">enable</span> &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消开机自启（删除符号链接）</span></span><br><span class="line">systemctl <span class="built_in">disable</span> &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务是否设置为开机自启</span></span><br><span class="line">systemctl is-enabled &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一步到位：启动服务 + 设置开机自启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> --now &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一步到位：停止服务 + 取消开机自启</span></span><br><span class="line">systemctl <span class="built_in">disable</span> --now &lt;service&gt;</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> sshd      <span class="comment"># 设置 SSH 服务开机自启</span></span><br><span class="line">systemctl is-enabled sshd  <span class="comment"># 输出：enabled</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld  <span class="comment"># 取消防火墙开机自启</span></span><br></pre></td></tr></table></figure>
<h2 id="查看服务列表"><a class="header-anchor" href="#查看服务列表">¶</a>查看服务列表</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有正在运行的服务</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=service --state=running</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有服务（包括未运行的）</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=service --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有失败的服务</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=service --state=failed</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索特定服务（如包含 ssh 的服务）</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=service --all | grep ssh</span><br></pre></td></tr></table></figure>
<p><strong>示例输出</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">● sshd.service    loaded active running OpenBSD Secure Shell server</span><br><span class="line">● nginx.service   loaded active running A high performance web server</span><br></pre></td></tr></table></figure>
<h2 id="查看服务详细信息"><a class="header-anchor" href="#查看服务详细信息">¶</a>查看服务详细信息</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看服务的 unit 文件内容</span></span><br><span class="line">systemctl <span class="built_in">cat</span> &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务的依赖关系</span></span><br><span class="line">systemctl list-dependencies &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务的启动时间（性能分析）</span></span><br><span class="line">systemd-analyze blame</span><br><span class="line">systemd-analyze critical-chain &lt;service&gt;</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">cat</span> sshd.service  <span class="comment"># 查看 sshd 的 unit 文件</span></span><br><span class="line">systemctl list-dependencies sshd.service  <span class="comment"># 查看 sshd 依赖哪些服务</span></span><br><span class="line">systemd-analyze blame  <span class="comment"># 查看所有服务的启动耗时（按耗时排序）</span></span><br></pre></td></tr></table></figure>
<hr>
<h1>自定义服务：让你的程序开机自启</h1>
<p>假设你有一个 Python 脚本或编译好的二进制程序，想让它开机自启、崩溃后自动重启，怎么做？写一个 systemd unit 文件即可。</p>
<h2 id="最小可用示例"><a class="header-anchor" href="#最小可用示例">¶</a>最小可用示例</h2>
<p>假设你有一个脚本 <code>/usr/local/bin/myapp.sh</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MyApp is running...&quot;</span></span><br><span class="line">    <span class="built_in">sleep</span> 10</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>创建 unit 文件 <code>/etc/systemd/system/myapp.service</code>：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=My Custom Application</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/myapp.sh</span><br><span class="line"><span class="attr">Restart</span>=always</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">10</span></span><br><span class="line"><span class="attr">User</span>=nobody</span><br><span class="line"><span class="attr">Group</span>=nogroup</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>
<p>然后启动并启用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload  <span class="comment"># 重新加载 systemd 配置</span></span><br><span class="line">sudo systemctl start myapp</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> myapp</span><br><span class="line">sudo systemctl status myapp</span><br></pre></td></tr></table></figure>
<h2 id="unit-文件详解"><a class="header-anchor" href="#unit-文件详解">¶</a>unit 文件详解</h2>
<h3 id="Unit-部分（描述和依赖关系）"><a class="header-anchor" href="#Unit-部分（描述和依赖关系）">¶</a>[Unit] 部分（描述和依赖关系）</h3>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=My Custom Application  <span class="comment"># 描述（会显示在 systemctl status 里）</span></span><br><span class="line"><span class="attr">After</span>=network.target               <span class="comment"># 在网络服务之后启动</span></span><br><span class="line"><span class="attr">Before</span>=another.service             <span class="comment"># 在另一个服务之前启动</span></span><br><span class="line"><span class="attr">Requires</span>=some.service              <span class="comment"># 强依赖（如果依赖的服务启动失败，这个服务也失败）</span></span><br><span class="line"><span class="attr">Wants</span>=some.service                 <span class="comment"># 弱依赖（如果依赖的服务失败，这个服务仍然尝试启动）</span></span><br></pre></td></tr></table></figure>
<h3 id="Service-部分（服务的启动方式和行为）"><a class="header-anchor" href="#Service-部分（服务的启动方式和行为）">¶</a>[Service] 部分（服务的启动方式和行为）</h3>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple                        <span class="comment"># 最常用的类型（启动后就认为服务已准备好）</span></span><br><span class="line"><span class="comment"># Type=forking                     # 适用于 fork 后台运行的服务（如传统的 daemon）</span></span><br><span class="line"><span class="comment"># Type=oneshot                     # 适用于一次性执行的任务（如初始化脚本）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/myapp.sh  <span class="comment"># 启动命令（必须是绝对路径）</span></span><br><span class="line"><span class="attr">ExecReload</span>=/bin/kill -HUP <span class="variable">$MAINPID</span> <span class="comment"># 重新加载配置（可选）</span></span><br><span class="line"><span class="attr">ExecStop</span>=/bin/kill -TERM <span class="variable">$MAINPID</span>  <span class="comment"># 停止命令（可选，默认发送 SIGTERM）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Restart</span>=always                     <span class="comment"># 崩溃后自动重启（always / on-failure / no）</span></span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">10</span>                      <span class="comment"># 重启前等待 10 秒</span></span><br><span class="line"></span><br><span class="line"><span class="attr">User</span>=nobody                        <span class="comment"># 以哪个用户运行（安全考虑，不要用 root）</span></span><br><span class="line"><span class="attr">Group</span>=nogroup                      <span class="comment"># 以哪个用户组运行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 资源限制</span></span><br><span class="line"><span class="attr">LimitNOFILE</span>=<span class="number">65536</span>                  <span class="comment"># 最大打开文件数</span></span><br><span class="line"><span class="attr">LimitNPROC</span>=<span class="number">4096</span>                    <span class="comment"># 最大进程数</span></span><br><span class="line"><span class="attr">MemoryLimit</span>=<span class="number">512</span>M                   <span class="comment"># 内存限制（需要 cgroup v2 支持）</span></span><br><span class="line"><span class="attr">CPUQuota</span>=<span class="number">50</span>%                       <span class="comment"># CPU 限制（50% 表示最多占用 0.5 个核心）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 工作目录</span></span><br><span class="line"><span class="attr">WorkingDirectory</span>=/var/lib/myapp    <span class="comment"># 启动时的工作目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 环境变量</span></span><br><span class="line"><span class="attr">Environment</span>=<span class="string">&quot;VAR1=value1&quot;</span></span><br><span class="line"><span class="attr">Environment</span>=<span class="string">&quot;VAR2=value2&quot;</span></span><br><span class="line"><span class="attr">EnvironmentFile</span>=/etc/myapp/env     <span class="comment"># 从文件加载环境变量</span></span><br></pre></td></tr></table></figure>
<h3 id="Install-部分（开机自启配置）"><a class="header-anchor" href="#Install-部分（开机自启配置）">¶</a>[Install] 部分（开机自启配置）</h3>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target         <span class="comment"># 在多用户模式下启动（文本模式）</span></span><br><span class="line"><span class="comment"># WantedBy=graphical.target        # 在图形模式下启动</span></span><br></pre></td></tr></table></figure>
<h2 id="常见-Type-的区别"><a class="header-anchor" href="#常见-Type-的区别">¶</a>常见 Type 的区别</h2>
<table>
<thead>
<tr>
<th>Type</th>
<th>说明</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>simple</strong></td>
<td>启动后立即认为服务已准备好（默认）</td>
<td>大部分服务（如 nginx、python 脚本）</td>
</tr>
<tr>
<td><strong>forking</strong></td>
<td>服务会 fork 一个子进程后退出（父进程退出后，子进程成为主进程）</td>
<td>传统的 daemon 程序（如老版本的 Apache）</td>
</tr>
<tr>
<td><strong>oneshot</strong></td>
<td>执行完就退出（不是常驻进程）</td>
<td>一次性初始化任务（如挂载文件系统）</td>
</tr>
<tr>
<td><strong>notify</strong></td>
<td>服务启动后会主动通知 systemd “我准备好了”（需要程序支持 sd_notify）</td>
<td>高级服务（如 systemd-networkd）</td>
</tr>
</tbody>
</table>
<h2 id="修改-unit-文件后必须重新加载"><a class="header-anchor" href="#修改-unit-文件后必须重新加载">¶</a>修改 unit 文件后必须重新加载</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload  <span class="comment"># 告诉 systemd 重新读取 unit 文件</span></span><br><span class="line">sudo systemctl restart myapp</span><br></pre></td></tr></table></figure>
<hr>
<h1>journalctl：systemd 的统一日志系统</h1>
<p>systemd 自带了 <strong>journald</strong>，所有服务的日志都集中存储在 <code>/var/log/journal/</code> 或 <code>/run/log/journal/</code>（重启后清空），可以用 <code>journalctl</code> 查询。</p>
<h2 id="基本用法-v2"><a class="header-anchor" href="#基本用法-v2">¶</a>基本用法</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有日志（从最早到最新）</span></span><br><span class="line">journalctl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个服务的日志</span></span><br><span class="line">journalctl -u &lt;service&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看日志（类似 tail -f）</span></span><br><span class="line">journalctl -u &lt;service&gt; -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看最近的 N 行日志</span></span><br><span class="line">journalctl -u &lt;service&gt; -n 50</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看最近 1 小时的日志</span></span><br><span class="line">journalctl -u &lt;service&gt; --since <span class="string">&quot;1 hour ago&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个时间段的日志</span></span><br><span class="line">journalctl -u &lt;service&gt; --since <span class="string">&quot;2025-02-01 00:00:00&quot;</span> --until <span class="string">&quot;2025-02-01 23:59:59&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看开机日志</span></span><br><span class="line">journalctl -b  <span class="comment"># -b 0 表示当前这次开机，-b -1 表示上一次开机</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内核日志</span></span><br><span class="line">journalctl -k</span><br></pre></td></tr></table></figure>
<h2 id="高级用法"><a class="header-anchor" href="#高级用法">¶</a>高级用法</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看日志并显示详细信息（包括 PID、UID 等）</span></span><br><span class="line">journalctl -u &lt;service&gt; -o verbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看日志并只显示错误和更严重的消息</span></span><br><span class="line">journalctl -u &lt;service&gt; -p err</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个用户的所有日志</span></span><br><span class="line">journalctl _UID=1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个可执行文件的日志</span></span><br><span class="line">journalctl /usr/bin/python3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理日志（保留最近 7 天）</span></span><br><span class="line">journalctl --vacuum-time=7d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理日志（保留最近 1GB）</span></span><br><span class="line">journalctl --vacuum-size=1G</span><br></pre></td></tr></table></figure>
<h2 id="日志持久化"><a class="header-anchor" href="#日志持久化">¶</a>日志持久化</h2>
<p>默认情况下，journald 的日志存储在 <code>/run/log/journal/</code>（内存中，重启后清空）。如果要持久化日志：</p>
<ol>
<li>
<p>创建目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /var/log/journal</span><br><span class="line">sudo systemd-tmpfiles --create --prefix /var/log/journal</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>重启 journald：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart systemd-journald</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>之后日志会保存在 <code>/var/log/journal/</code>，重启后仍然存在。</p>
<hr>
<h1>常见服务配置与排障</h1>
<p>这部分讲解几个最常见的系统服务的配置和排障方法。</p>
<h2 id="时间同步服务（ntpd-ntpsec-timedatectl）"><a class="header-anchor" href="#时间同步服务（ntpd-ntpsec-timedatectl）">¶</a>时间同步服务（ntpd / ntpsec / timedatectl）</h2>
<h3 id="为什么需要时间同步"><a class="header-anchor" href="#为什么需要时间同步">¶</a>为什么需要时间同步</h3>
<p>在分布式系统、集群、日志分析等应用场景下，时间同步至关重要：</p>
<ul>
<li><strong>定时任务的执行</strong>（如 cron 任务）：如果时间不一致，任务可能提前或延后执行</li>
<li><strong>日志对比和分析</strong>：如果多台服务器时间不一致，日志时间戳会错乱，无法关联</li>
<li><strong>数据同步</strong>（如数据库主从复制）：时间不一致可能导致数据顺序混乱</li>
<li><strong>安全协议</strong>（如 Kerberos 身份认证、TLS 证书）：时间差太大会导致认证失败</li>
</ul>
<h3 id="方案-1：使用-ntpsec（推荐）"><a class="header-anchor" href="#方案-1：使用-ntpsec（推荐）">¶</a>方案 1：使用 ntpsec（推荐）</h3>
<p><strong>ntpsec</strong> 是传统 ntpd 的现代化版本，安全性更高、代码更精简。</p>
<p><strong>安装与启动</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ntpsec  <span class="comment"># Debian/Ubuntu</span></span><br><span class="line">sudo yum install ntpsec  <span class="comment"># CentOS/RHEL</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> --now ntpsec</span><br></pre></td></tr></table></figure>
<p><strong>配置</strong>：编辑 <code>/etc/ntpsec/ntp.conf</code>，添加时间服务器（推荐使用国内服务器，延迟低）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server ntp.aliyun.com iburst prefer</span><br><span class="line">server ntp.tencent.com iburst</span><br><span class="line">server cn.pool.ntp.org iburst</span><br></pre></td></tr></table></figure>
<ul>
<li><code>iburst</code>：启动时快速同步（发送 8 个包而不是 1 个）</li>
<li><code>prefer</code>：优先使用这个服务器</li>
</ul>
<p>重启服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart ntpsec</span><br></pre></td></tr></table></figure>
<p><strong>查看同步状态</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntpq -p  <span class="comment"># 查看当前连接的时间服务器</span></span><br></pre></td></tr></table></figure>
<h3 id="方案-2：使用-timedatectl（更简单）"><a class="header-anchor" href="#方案-2：使用-timedatectl（更简单）">¶</a>方案 2：使用 timedatectl（更简单）</h3>
<p><strong>timedatectl</strong> 是 systemd 自带的时间管理工具，底层使用 <code>systemd-timesyncd</code> 进行 NTP 同步。</p>
<p><strong>启用 NTP 同步</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo timedatectl set-ntp <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p><strong>查看状态</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl</span><br></pre></td></tr></table></figure>
<p>输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">               Local time: Mon 2025-02-03 12:00:00 UTC</span><br><span class="line">           Universal time: Mon 2025-02-03 12:00:00 UTC</span><br><span class="line">                 RTC time: Mon 2025-02-03 12:00:00</span><br><span class="line">                Time zone: UTC (UTC, +0000)</span><br><span class="line">System clock synchronized: yes</span><br><span class="line">              NTP service: active</span><br><span class="line">          RTC in local TZ: no</span><br></pre></td></tr></table></figure>
<p><strong>设置时区</strong>（如果需要）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo timedatectl set-timezone Asia/Shanghai</span><br></pre></td></tr></table></figure>
<p><strong>查看可用时区</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl list-timezones | grep Shanghai</span><br></pre></td></tr></table></figure>
<h3 id="ntpdate（一次性同步，不推荐常驻使用）"><a class="header-anchor" href="#ntpdate（一次性同步，不推荐常驻使用）">¶</a>ntpdate（一次性同步，不推荐常驻使用）</h3>
<p>如果只需要临时同步一次时间（不是常驻服务）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ntpdate ntp.aliyun.com</span><br></pre></td></tr></table></figure>
<p><strong>缺点</strong>：</p>
<ul>
<li>暴力修改时间（直接跳变），可能导致依赖时序的程序出错（如定时任务、数据库同步）</li>
<li>ntpd / ntpsec 采用平滑调整，避免时间跳变</li>
</ul>
<p><strong>推荐</strong>：使用 ntpsec 或 timedatectl 进行长时间运行的同步，避免 ntpdate 的问题。</p>
<hr>
<h2 id="防火墙服务（firewalld）"><a class="header-anchor" href="#防火墙服务（firewalld）">¶</a>防火墙服务（firewalld）</h2>
<h3 id="基本介绍"><a class="header-anchor" href="#基本介绍">¶</a>基本介绍</h3>
<p>防火墙（Firewall）是一种网络安全工具，用于<strong>控制和过滤网络流量</strong>，防止未经授权的访问。在 Linux 中，常见的防火墙有：</p>
<ul>
<li><strong>iptables</strong>（传统，规则是有顺序的，配置复杂）</li>
<li><strong>firewalld</strong>（现代，动态规则，支持 zone 概念，RHEL/CentOS 默认）</li>
<li><strong>ufw</strong>（Ubuntu 友好型防火墙，简化了 iptables）</li>
</ul>
<p><strong>firewalld</strong> 是基于 iptables/nftables 的动态防火墙，提供了更友好的命令行接口。</p>
<h3 id="启用与关闭"><a class="header-anchor" href="#启用与关闭">¶</a>启用与关闭</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start firewalld</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> firewalld</span><br><span class="line">sudo systemctl status firewalld</span><br><span class="line"></span><br><span class="line">sudo systemctl stop firewalld</span><br><span class="line">sudo systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>
<h3 id="基本规则操作"><a class="header-anchor" href="#基本规则操作">¶</a>基本规则操作</h3>
<h4 id="开放-关闭端口"><a class="header-anchor" href="#开放-关闭端口">¶</a>开放/关闭端口</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开放 80 端口（TCP）</span></span><br><span class="line">sudo firewall-cmd --permanent --add-port=80/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开放 80-90 端口范围</span></span><br><span class="line">sudo firewall-cmd --permanent --add-port=80-90/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭 80 端口</span></span><br><span class="line">sudo firewall-cmd --permanent --remove-port=80/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<ul>
<li><code>--permanent</code>：写入永久规则（否则重启后失效）</li>
<li><code>--reload</code>：重新加载规则（使永久规则生效）</li>
</ul>
<h4 id="开放-关闭服务"><a class="header-anchor" href="#开放-关闭服务">¶</a>开放/关闭服务</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开放 HTTP 服务（包含 80 端口）</span></span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前开放的服务和端口</span></span><br><span class="line">sudo firewall-cmd --list-all</span><br></pre></td></tr></table></figure>
<p><strong>常见服务名</strong>：<code>http</code>、<code>https</code>、<code>ssh</code>、<code>ntp</code>、<code>mysql</code>、<code>postgresql</code> 等。</p>
<h3 id="zone-概念"><a class="header-anchor" href="#zone-概念">¶</a>zone 概念</h3>
<p>firewalld 使用 <strong>zone</strong>（区域）来定义不同的安全级别：</p>
<table>
<thead>
<tr>
<th>Zone名称</th>
<th>信任级别</th>
<th>默认策略</th>
<th>典型应用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>drop</strong></td>
<td>最低</td>
<td>丢弃所有传入流量，不回应</td>
<td>最高安全性，完全隐藏设备</td>
</tr>
<tr>
<td><strong>public</strong></td>
<td>低</td>
<td>默认拒绝所有入站，仅允许 SSH</td>
<td>公共网络（如 WiFi 热点）</td>
</tr>
<tr>
<td><strong>work</strong></td>
<td>高</td>
<td>允许内部可信网络访问，默认允许 SSH、Samba</td>
<td>公司内部网络</td>
</tr>
<tr>
<td><strong>home</strong></td>
<td>高</td>
<td>允许家用网络访问</td>
<td>家庭网络</td>
</tr>
<tr>
<td><strong>trusted</strong></td>
<td>最高</td>
<td>允许所有流量</td>
<td>完全信任的环境</td>
</tr>
</tbody>
</table>
<p><strong>查看当前默认 zone</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --get-default-zone</span><br></pre></td></tr></table></figure>
<p><strong>修改默认 zone</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --set-default-zone=work</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="计划任务（crontab）"><a class="header-anchor" href="#计划任务（crontab）">¶</a>计划任务（crontab）</h2>
<p>计划任务让系统在指定时间自动执行某些脚本或命令，例如：</p>
<ul>
<li>定时备份数据库（每天凌晨 2 点）</li>
<li>定时清理日志文件或临时文件夹（每周日）</li>
<li>定时同步时间（每小时）</li>
</ul>
<h3 id="编辑与查看"><a class="header-anchor" href="#编辑与查看">¶</a>编辑与查看</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crontab -e  <span class="comment"># 编辑当前用户的计划任务</span></span><br><span class="line">crontab -l  <span class="comment"># 查看当前用户的计划任务</span></span><br><span class="line">crontab -r  <span class="comment"># 删除当前用户的所有计划任务</span></span><br></pre></td></tr></table></figure>
<h3 id="格式"><a class="header-anchor" href="#格式">¶</a>格式</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MIN HOUR DAY MONTH WEEKDAY command</span><br></pre></td></tr></table></figure>
<ul>
<li><code>MIN</code>：分钟（0-59）</li>
<li><code>HOUR</code>：小时（0-23）</li>
<li><code>DAY</code>：日期（1-31）</li>
<li><code>MONTH</code>：月份（1-12）</li>
<li><code>WEEKDAY</code>：星期（0-7，0 和 7 都表示周日）</li>
<li><code>command</code>：要执行的命令（建议使用绝对路径）</li>
</ul>
<p><strong>特殊符号</strong>：</p>
<ul>
<li><code>*</code>：表示&quot;每&quot;（如 <code>*</code> 在分钟位表示每分钟）</li>
<li><code>-</code>：表示范围（如 <code>1-5</code> 表示 1 到 5）</li>
<li><code>/</code>：表示间隔（如 <code>*/10</code> 表示每 10 个单位）</li>
<li><code>,</code>：表示多个值（如 <code>1,2,6</code> 表示 1、2、6）</li>
</ul>
<h3 id="示例"><a class="header-anchor" href="#示例">¶</a>示例</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每天凌晨 1:30 运行备份脚本</span></span><br><span class="line">30 1 * * * /usr/local/bin/backup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每天凌晨 2:30 同步时间（结果重定向到黑洞，不输出）</span></span><br><span class="line">30 2 * * * /usr/sbin/ntpdate -u ntp.aliyun.com &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每小时的第 5 分钟执行一次</span></span><br><span class="line">5 * * * * /usr/local/bin/hourly-task.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每 10 分钟执行一次</span></span><br><span class="line">*/10 * * * * /usr/local/bin/monitor.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每周日凌晨 3 点执行</span></span><br><span class="line">0 3 * * 0 /usr/local/bin/weekly-cleanup.sh</span><br></pre></td></tr></table></figure>
<h3 id="查看日志"><a class="header-anchor" href="#查看日志">¶</a>查看日志</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep CRON /var/log/syslog  <span class="comment"># Debian/Ubuntu</span></span><br><span class="line">grep CRON /var/log/cron    <span class="comment"># CentOS/RHEL</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="SSH-服务配置与安全加固"><a class="header-anchor" href="#SSH-服务配置与安全加固">¶</a>SSH 服务配置与安全加固</h2>
<p>SSH 是远程管理 Linux 服务器的标准方式。在&quot;Linux 使用基础&quot;里已经讲了基本用法（<code>ssh user@host</code>、免密登录），这里讲一些 <strong>sshd 配置和安全加固</strong>。</p>
<h3 id="配置文件"><a class="header-anchor" href="#配置文件">¶</a>配置文件</h3>
<p><strong>配置文件</strong>：<code>/etc/ssh/sshd_config</code></p>
<p>修改后需要重启服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart sshd</span><br></pre></td></tr></table></figure>
<h3 id="常见配置项"><a class="header-anchor" href="#常见配置项">¶</a>常见配置项</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 监听端口（默认 22，建议改成其他端口减少被扫描）</span></span><br><span class="line">Port 22222</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否允许 root 用户直接登录（建议禁止）</span></span><br><span class="line">PermitRootLogin no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否允许密码登录（建议禁止，只用密钥登录）</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否允许空密码登录（强烈建议禁止）</span></span><br><span class="line">PermitEmptyPasswords no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许公钥认证</span></span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 公钥文件位置</span></span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否允许 X11 转发（图形界面转发）</span></span><br><span class="line">X11Forwarding <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大认证尝试次数（防止暴力破解）</span></span><br><span class="line">MaxAuthTries 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 空闲超时时间（秒）</span></span><br><span class="line">ClientAliveInterval 300</span><br><span class="line">ClientAliveCountMax 0</span><br></pre></td></tr></table></figure>
<h3 id="安全加固建议"><a class="header-anchor" href="#安全加固建议">¶</a>安全加固建议</h3>
<ol>
<li><strong>改端口</strong>：把默认端口 22 改成其他端口（如 22222），减少被扫描的概率</li>
<li><strong>禁止 root 登录</strong>：<code>PermitRootLogin no</code>，只允许普通用户登录，需要权限时再 <code>sudo</code></li>
<li><strong>禁止密码登录</strong>：<code>PasswordAuthentication no</code>，只允许密钥登录（防止暴力破解）</li>
<li><strong>安装 fail2ban</strong>：自动封禁暴力破解的 IP（连续失败多次后自动封禁）</li>
<li><strong>配置防火墙</strong>：只允许特定 IP 连接 SSH（如果有固定 IP）</li>
<li><strong>使用 SSH 密钥</strong>：4096 位 RSA 或 Ed25519 密钥（比密码安全得多）</li>
</ol>
<hr>
<h1>服务排障流程：服务起不来怎么办</h1>
<p>当服务起不来时，按这个流程排查：</p>
<h2 id="1-查看服务状态"><a class="header-anchor" href="#1-查看服务状态">¶</a>1. 查看服务状态</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status &lt;service&gt;</span><br></pre></td></tr></table></figure>
<p>关注：</p>
<ul>
<li><strong>Active</strong>：是否显示 <code>active (running)</code> 或 <code>failed</code></li>
<li><strong>Main PID</strong>：主进程 PID（如果是 0 说明进程已退出）</li>
<li><strong>最近的日志</strong>：通常会显示最后几行日志，看有没有错误信息</li>
</ul>
<h2 id="2-查看详细日志"><a class="header-anchor" href="#2-查看详细日志">¶</a>2. 查看详细日志</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl -u &lt;service&gt; -xe</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-x</code>：显示额外的解释信息</li>
<li><code>-e</code>：跳到日志末尾（最新的日志）</li>
</ul>
<h2 id="3-检查配置文件语法"><a class="header-anchor" href="#3-检查配置文件语法">¶</a>3. 检查配置文件语法</h2>
<p>很多服务提供配置文件语法检查工具：</p>
<ul>
<li><strong>nginx</strong>：<code>nginx -t</code></li>
<li><strong>apache</strong>：<code>apachectl configtest</code></li>
<li><strong>sshd</strong>：<code>sshd -t</code></li>
</ul>
<h2 id="4-检查端口冲突"><a class="header-anchor" href="#4-检查端口冲突">¶</a>4. 检查端口冲突</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ss -lntp | grep &lt;port&gt;  <span class="comment"># 查看端口是否被占用</span></span><br><span class="line">sudo lsof -i :&lt;port&gt;         <span class="comment"># 查看哪个进程占用了端口</span></span><br></pre></td></tr></table></figure>
<h2 id="5-检查文件权限"><a class="header-anchor" href="#5-检查文件权限">¶</a>5. 检查文件权限</h2>
<p>服务可能因为权限不足而无法启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /path/to/config</span><br><span class="line"><span class="built_in">ls</span> -l /var/log/&lt;service&gt;</span><br></pre></td></tr></table></figure>
<p>确保服务运行的用户（如 <code>www-data</code>、<code>nginx</code>、<code>nobody</code>）有权限读写相关文件。</p>
<h2 id="6-检查-SELinux-AppArmor"><a class="header-anchor" href="#6-检查-SELinux-AppArmor">¶</a>6. 检查 SELinux / AppArmor</h2>
<p>如果开启了 SELinux（RHEL/CentOS）或 AppArmor（Ubuntu/Debian），可能会阻止服务启动。</p>
<p><strong>临时关闭 SELinux</strong>（仅用于排查）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo setenforce 0  <span class="comment"># 设置为 Permissive 模式</span></span><br></pre></td></tr></table></figure>
<p><strong>查看 SELinux 日志</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ausearch -m avc -ts recent</span><br></pre></td></tr></table></figure>
<p><strong>临时关闭 AppArmor</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop apparmor</span><br></pre></td></tr></table></figure>
<h2 id="7-检查依赖关系"><a class="header-anchor" href="#7-检查依赖关系">¶</a>7. 检查依赖关系</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl list-dependencies &lt;service&gt;</span><br></pre></td></tr></table></figure>
<p>如果依赖的服务没有启动，当前服务也无法启动。</p>
<hr>
<h1>总结与扩展阅读</h1>
<p>这篇文章涵盖了 systemd 服务管理的核心内容：</p>
<ol>
<li>✅ systemd 的核心概念（unit、依赖关系、启动流程）</li>
<li>✅ systemctl 的日常使用（启停、开机自启、查看状态）</li>
<li>✅ 自定义服务（如何让自己的程序开机自启）</li>
<li>✅ journalctl 日志管理（查询、过滤、清理）</li>
<li>✅ 常见服务配置（时间同步、防火墙、计划任务、SSH）</li>
<li>✅ 服务排障流程（服务起不来怎么办）</li>
</ol>
<p><strong>扩展阅读</strong>：</p>
<ul>
<li>systemd 官方文档：<a class="link" target="_blank" rel="noopener" href="https://www.freedesktop.org/wiki/Software/systemd/">https://www.freedesktop.org/wiki/Software/systemd/<i class="fas fa-external-link-alt"></i></a></li>
<li>systemd for Administrators 系列：<a class="link" target="_blank" rel="noopener" href="http://0pointer.de/blog/projects/systemd-for-admins-1.html">http://0pointer.de/blog/projects/systemd-for-admins-1.html<i class="fas fa-external-link-alt"></i></a></li>
<li>journalctl 手册：<code>man journalctl</code></li>
<li>systemd.service 手册：<code>man systemd.service</code></li>
</ul>
<p><strong>下一步</strong>：</p>
<ul>
<li><strong>《Linux 软件包管理》</strong>：学习如何安装/卸载/更新软件包（apt/yum/dnf/rpm）</li>
<li><strong>《Linux 进程与资源管理》</strong>：学习如何监控和限制进程的 CPU/内存使用</li>
<li><strong>《Linux 用户管理》</strong>：学习如何管理用户/组/权限</li>
</ul>
<hr>
<p><strong>到这里，你应该已经从&quot;会启停服务&quot;升级到&quot;能写自定义服务、能排障、能优化启动顺序&quot;。服务管理是 Linux 运维的核心技能，掌握了 systemd，你就能更好地管理服务器。</strong></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    
    
    
    
    
    
    <ul>
        <li>本文标题：Linux 系统服务管理</li>
        <li>本文作者：Chen Kai</li>
        <li>创建时间：2025-01-10 00:00:00</li>
        <li>
            本文链接：https://www.chenk.top/Linux-%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/Linux/">#Linux</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">#云计算</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/Linux-%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Linux 软件包管理</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/Linux-%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Linux 磁盘管理</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'p2Cu9MgjoKzo3VmulhNLIusH-gzGzoHsz',
                    appKey: 'QThQHg3c8sVwGpzg9lu8zEG3',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '😜 尽情赞美帅气伟大的ck吧~',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'Chen Kai';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2026&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Chen Kai</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
            </div>
        
        <div class="theme-info info-item">
            <!-- 由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a> -->
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">systemd 核心概念：为什么要用它、它解决了什么问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">1.1.</span> <span class="nav-text">为什么需要服务管理器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#systemd-vs-SysV-init%EF%BC%88%E6%97%A7%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="nav-number">1.2.</span> <span class="nav-text">systemd vs SysV init（旧系统）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#systemd-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%EF%BC%9Aunit"><span class="nav-number">1.3.</span> <span class="nav-text">systemd 的核心概念：unit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#systemd-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0"><span class="nav-number">1.4.</span> <span class="nav-text">systemd 启动流程简述</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">2.</span> <span class="nav-text">systemctl 命令：日常使用的&quot;肌肉记忆&quot;</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%EF%BC%88%E5%90%AF%E5%8A%A8%E3%80%81%E5%81%9C%E6%AD%A2%E3%80%81%E9%87%8D%E5%90%AF%E3%80%81%E6%9F%A5%E7%9C%8B%E7%8A%B6%E6%80%81%EF%BC%89"><span class="nav-number">2.1.</span> <span class="nav-text">基本操作（启动、停止、重启、查看状态）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E7%AE%A1%E7%90%86"><span class="nav-number">2.2.</span> <span class="nav-text">开机自启管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8"><span class="nav-number">2.3.</span> <span class="nav-text">查看服务列表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="nav-number">2.4.</span> <span class="nav-text">查看服务详细信息</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">3.</span> <span class="nav-text">自定义服务：让你的程序开机自启</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%B0%8F%E5%8F%AF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.1.</span> <span class="nav-text">最小可用示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#unit-%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.2.</span> <span class="nav-text">unit 文件详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Unit-%E9%83%A8%E5%88%86%EF%BC%88%E6%8F%8F%E8%BF%B0%E5%92%8C%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%EF%BC%89"><span class="nav-number">3.2.1.</span> <span class="nav-text">[Unit] 部分（描述和依赖关系）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Service-%E9%83%A8%E5%88%86%EF%BC%88%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F%E5%92%8C%E8%A1%8C%E4%B8%BA%EF%BC%89"><span class="nav-number">3.2.2.</span> <span class="nav-text">[Service] 部分（服务的启动方式和行为）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Install-%E9%83%A8%E5%88%86%EF%BC%88%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E9%85%8D%E7%BD%AE%EF%BC%89"><span class="nav-number">3.2.3.</span> <span class="nav-text">[Install] 部分（开机自启配置）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81-Type-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">3.3.</span> <span class="nav-text">常见 Type 的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-unit-%E6%96%87%E4%BB%B6%E5%90%8E%E5%BF%85%E9%A1%BB%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD"><span class="nav-number">3.4.</span> <span class="nav-text">修改 unit 文件后必须重新加载</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">4.</span> <span class="nav-text">journalctl：systemd 的统一日志系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95-v2"><span class="nav-number">4.1.</span> <span class="nav-text">基本用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="nav-number">4.2.</span> <span class="nav-text">高级用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">4.3.</span> <span class="nav-text">日志持久化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">5.</span> <span class="nav-text">常见服务配置与排障</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%EF%BC%88ntpd-ntpsec-timedatectl%EF%BC%89"><span class="nav-number">5.1.</span> <span class="nav-text">时间同步服务（ntpd &#x2F; ntpsec &#x2F; timedatectl）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5"><span class="nav-number">5.1.1.</span> <span class="nav-text">为什么需要时间同步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%88-1%EF%BC%9A%E4%BD%BF%E7%94%A8-ntpsec%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="nav-number">5.1.2.</span> <span class="nav-text">方案 1：使用 ntpsec（推荐）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%88-2%EF%BC%9A%E4%BD%BF%E7%94%A8-timedatectl%EF%BC%88%E6%9B%B4%E7%AE%80%E5%8D%95%EF%BC%89"><span class="nav-number">5.1.3.</span> <span class="nav-text">方案 2：使用 timedatectl（更简单）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ntpdate%EF%BC%88%E4%B8%80%E6%AC%A1%E6%80%A7%E5%90%8C%E6%AD%A5%EF%BC%8C%E4%B8%8D%E6%8E%A8%E8%8D%90%E5%B8%B8%E9%A9%BB%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="nav-number">5.1.4.</span> <span class="nav-text">ntpdate（一次性同步，不推荐常驻使用）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E6%9C%8D%E5%8A%A1%EF%BC%88firewalld%EF%BC%89"><span class="nav-number">5.2.</span> <span class="nav-text">防火墙服务（firewalld）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="nav-number">5.2.1.</span> <span class="nav-text">基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E4%B8%8E%E5%85%B3%E9%97%AD"><span class="nav-number">5.2.2.</span> <span class="nav-text">启用与关闭</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E8%A7%84%E5%88%99%E6%93%8D%E4%BD%9C"><span class="nav-number">5.2.3.</span> <span class="nav-text">基本规则操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E6%94%BE-%E5%85%B3%E9%97%AD%E7%AB%AF%E5%8F%A3"><span class="nav-number">5.2.3.1.</span> <span class="nav-text">开放&#x2F;关闭端口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E6%94%BE-%E5%85%B3%E9%97%AD%E6%9C%8D%E5%8A%A1"><span class="nav-number">5.2.3.2.</span> <span class="nav-text">开放&#x2F;关闭服务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zone-%E6%A6%82%E5%BF%B5"><span class="nav-number">5.2.4.</span> <span class="nav-text">zone 概念</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%EF%BC%88crontab%EF%BC%89"><span class="nav-number">5.3.</span> <span class="nav-text">计划任务（crontab）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E4%B8%8E%E6%9F%A5%E7%9C%8B"><span class="nav-number">5.3.1.</span> <span class="nav-text">编辑与查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F"><span class="nav-number">5.3.2.</span> <span class="nav-text">格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">5.3.3.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="nav-number">5.3.4.</span> <span class="nav-text">查看日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH-%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA"><span class="nav-number">5.4.</span> <span class="nav-text">SSH 服务配置与安全加固</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">5.4.1.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">5.4.2.</span> <span class="nav-text">常见配置项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E5%BB%BA%E8%AE%AE"><span class="nav-number">5.4.3.</span> <span class="nav-text">安全加固建议</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">6.</span> <span class="nav-text">服务排障流程：服务起不来怎么办</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81"><span class="nav-number">6.1.</span> <span class="nav-text">1. 查看服务状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86%E6%97%A5%E5%BF%97"><span class="nav-number">6.2.</span> <span class="nav-text">2. 查看详细日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%AD%E6%B3%95"><span class="nav-number">6.3.</span> <span class="nav-text">3. 检查配置文件语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%A3%80%E6%9F%A5%E7%AB%AF%E5%8F%A3%E5%86%B2%E7%AA%81"><span class="nav-number">6.4.</span> <span class="nav-text">4. 检查端口冲突</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90"><span class="nav-number">6.5.</span> <span class="nav-text">5. 检查文件权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E6%A3%80%E6%9F%A5-SELinux-AppArmor"><span class="nav-number">6.6.</span> <span class="nav-text">6. 检查 SELinux &#x2F; AppArmor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E6%A3%80%E6%9F%A5%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="nav-number">6.7.</span> <span class="nav-text">7. 检查依赖关系</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">7.</span> <span class="nav-text">总结与扩展阅读</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>

<script src="/js/lang-switch.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
