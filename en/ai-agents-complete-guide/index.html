<!DOCTYPE html>



<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Chen Kai">
    
    <title>
        
            AI Agents Complete Guide: From Theory to Industrial Practice |
        
        Chen Kai Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"chenk.top","root":"/","language":"en","default_language":"zh-CN","languages":["zh-CN","en"],"path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Chen Kai Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    
    
    
    
    

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/en/">
                Chen Kai Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/en/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/en/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/en/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            
                            
                            <a class=""
                               href="/en/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                    <li class="menu-item lang-switch lang-switch-trigger" title="Language">
                        <i class="fas fa-globe"></i>
                    </li>
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item lang-switch-trigger"><i class="fas fa-globe"></i></div>
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/en/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/en/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/en/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    
                    
                    <a class=""
                       href="/en/tags">TAGS</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    
    
    
    

    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">AI Agents Complete Guide: From Theory to Industrial Practice</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Chen Kai</span>
                        
                            <span class="author-label">BOSS</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    
    
    
    
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2025-04-03 00:00:00</span>
        <span class="mobile">2025-04-03 00:00</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/en/categories/Large-Language-Models/">Large Language Models</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/en/tags/LLM/">LLM</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/en/tags/AI-Agents/">AI Agents</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/en/tags/Applications/">Applications</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>14.1k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>88 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>Large Language Models (LLMs) have demonstrated remarkable
capabilities in understanding and generating human language, but they
face a critical limitation: they remain passive responders confined to
their training data. AI Agents break this barrier by transforming static
models into autonomous problem-solvers that can plan, use external
tools, maintain memory, and iteratively refine their approaches. This
article explores how AI Agents extend LLMs from mere text generators
into active reasoning systems capable of handling complex, multi-step
real-world tasks.</p>
<p>We'll trace the evolution from basic prompt engineering to
sophisticated agent architectures, examine the four core capabilities
that define modern agents (planning, memory, tool use, and reflection),
dissect popular frameworks like LangChain and AutoGPT, understand
multi-agent collaboration patterns, and analyze how these systems are
evaluated in production. Whether you're building your first agent or
scaling to multi-agent orchestration, this guide provides both
theoretical foundations and practical implementation details to help you
navigate this rapidly evolving field.</p>
<span id="more"></span>
<h2 id="what-are-ai-agents">What Are AI Agents?</h2>
<p>The term "AI Agent" has become increasingly prevalent in the LLM
ecosystem, but its definition varies widely across different contexts.
At its core, an AI Agent is an autonomous system powered by a large
language model that can perceive its environment, make decisions, take
actions, and iteratively work towards achieving specific goals without
constant human intervention.</p>
<h3 id="from-static-llms-to-dynamic-agents">From Static LLMs to Dynamic
Agents</h3>
<p>Traditional LLM interactions follow a simple request-response
pattern: you provide a prompt, the model generates text, and the
interaction ends. This approach has significant limitations:</p>
<ul>
<li><strong>No persistence</strong>: Each interaction is isolated with
no memory of previous exchanges</li>
<li><strong>Limited reasoning</strong>: Complex problems requiring
multiple steps are difficult to solve in a single forward pass</li>
<li><strong>No tool access</strong>: The model cannot verify facts,
perform calculations, or interact with external systems</li>
<li><strong>Static knowledge</strong>: Information is frozen at the
training cutoff date</li>
</ul>
<p>AI Agents address these limitations by wrapping LLMs in a reasoning
loop that enables:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Traditional LLM interaction</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">traditional_llm</span>(<span class="params">prompt</span>):</span><br><span class="line">    response = llm.generate(prompt)</span><br><span class="line">    <span class="keyword">return</span> response  <span class="comment"># One-shot, no follow-up</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AI Agent interaction</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">agent_loop</span>(<span class="params">task</span>):</span><br><span class="line">    state = initialize_memory()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> is_goal_achieved(state):</span><br><span class="line">        <span class="comment"># Perceive current state</span></span><br><span class="line">        observation = observe_environment(state)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Think and plan</span></span><br><span class="line">        thought = llm.reason(observation, state.memory)</span><br><span class="line">        action = llm.decide_action(thought, available_tools)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Act in environment</span></span><br><span class="line">        result = execute_action(action)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Update memory and reflect</span></span><br><span class="line">        state.memory.update(thought, action, result)</span><br><span class="line">        state = evaluate_progress(state, result)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> state.final_output</span><br></pre></td></tr></table></figure>
<p>This fundamental shift from passive generation to active reasoning is
what distinguishes agents from vanilla LLMs.</p>
<h3 id="core-components-of-ai-agents">Core Components of AI Agents</h3>
<p>Every effective AI Agent consists of several interconnected
components:</p>
<p><strong>1. Brain (LLM Core)</strong></p>
<p>The LLM serves as the agent's reasoning engine, responsible for: -
Understanding natural language instructions - Breaking down complex
goals into actionable steps - Generating code, queries, or API calls -
Synthesizing information from multiple sources</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chat_models <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> AgentExecutor, create_openai_functions_agent</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize the LLM brain</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=<span class="string">&quot;gpt-4-turbo&quot;</span>,</span><br><span class="line">    temperature=<span class="number">0</span>,  <span class="comment"># Deterministic for reliable reasoning</span></span><br><span class="line">    max_tokens=<span class="number">2000</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The brain processes thoughts and generates actions</span></span><br><span class="line">thought = llm.predict(</span><br><span class="line">    <span class="string">&quot;Given the task &#x27;Find the weather in Tokyo&#x27;, what should I do first?&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># Output: &quot;I need to use a weather API tool to fetch current weather data for Tokyo.&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>2. Planning Module</strong></p>
<p>Planning is the agent's ability to decompose complex tasks into
manageable sub-tasks. Two primary planning strategies exist:</p>
<p><em>Task Decomposition</em> involves breaking down the goal
hierarchically:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TaskPlanner</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm</span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decompose_task</span>(<span class="params">self, goal</span>):</span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;Break down this goal into a sequence of actionable steps:</span></span><br><span class="line"><span class="string">        Goal: <span class="subst">&#123;goal&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Provide steps in this format:</span></span><br><span class="line"><span class="string">        1. [First step with clear action]</span></span><br><span class="line"><span class="string">        2. [Second step depending on step 1]</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        response = self.llm.predict(prompt)</span><br><span class="line">        <span class="keyword">return</span> self.parse_steps(response)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_steps</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># Extract numbered steps from LLM response</span></span><br><span class="line">        steps = []</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> response.split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> line.strip() <span class="keyword">and</span> line[<span class="number">0</span>].isdigit():</span><br><span class="line">                steps.append(line.split(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].strip())</span><br><span class="line">        <span class="keyword">return</span> steps</span><br><span class="line"></span><br><span class="line">planner = TaskPlanner(llm)</span><br><span class="line">steps = planner.decompose_task(</span><br><span class="line">    <span class="string">&quot;Research competitor pricing and create a comparative analysis report&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># Returns: [</span></span><br><span class="line"><span class="comment">#   &quot;Identify top 5 competitors in the market&quot;,</span></span><br><span class="line"><span class="comment">#   &quot;For each competitor, search for their public pricing pages&quot;,</span></span><br><span class="line"><span class="comment">#   &quot;Extract pricing tiers and feature comparisons&quot;,</span></span><br><span class="line"><span class="comment">#   &quot;Compile data into a structured format&quot;,</span></span><br><span class="line"><span class="comment">#   &quot;Generate a summary analysis with key insights&quot;</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></table></figure>
<p><em>Multi-path reasoning</em> explores different solution approaches
simultaneously:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MultiPathPlanner</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_alternatives</span>(<span class="params">self, task, num_paths=<span class="number">3</span></span>):</span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;Generate <span class="subst">&#123;num_paths&#125;</span> different approaches to solve this task:</span></span><br><span class="line"><span class="string">        Task: <span class="subst">&#123;task&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        For each approach, explain:</span></span><br><span class="line"><span class="string">        - Strategy overview</span></span><br><span class="line"><span class="string">        - Pros and cons</span></span><br><span class="line"><span class="string">        - Estimated steps required</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        alternatives = self.llm.predict(prompt)</span><br><span class="line">        <span class="keyword">return</span> self.parse_alternatives(alternatives)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">select_best_path</span>(<span class="params">self, alternatives, constraints</span>):</span><br><span class="line">        evaluation_prompt = <span class="string">f&quot;&quot;&quot;Given these approaches and constraints:</span></span><br><span class="line"><span class="string">        Approaches: <span class="subst">&#123;alternatives&#125;</span></span></span><br><span class="line"><span class="string">        Constraints: <span class="subst">&#123;constraints&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Select the most appropriate approach and explain why.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.llm.predict(evaluation_prompt)</span><br></pre></td></tr></table></figure>
<p><strong>3. Memory System</strong></p>
<p>Memory enables agents to maintain context across interactions. Modern
agents typically implement multiple memory types:</p>
<p><em>Short-term Memory</em> stores information within the current
session:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ShortTermMemory</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, max_tokens=<span class="number">4000</span></span>):</span><br><span class="line">        self.messages = []</span><br><span class="line">        self.max_tokens = max_tokens</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_message</span>(<span class="params">self, role, content</span>):</span><br><span class="line">        self.messages.append(&#123;<span class="string">&quot;role&quot;</span>: role, <span class="string">&quot;content&quot;</span>: content&#125;)</span><br><span class="line">        self._trim_if_needed()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_trim_if_needed</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Estimate tokens (rough approximation)</span></span><br><span class="line">        total_tokens = <span class="built_in">sum</span>(<span class="built_in">len</span>(m[<span class="string">&quot;content&quot;</span>]) / <span class="number">4</span> <span class="keyword">for</span> m <span class="keyword">in</span> self.messages)</span><br><span class="line">        <span class="keyword">while</span> total_tokens &gt; self.max_tokens <span class="keyword">and</span> <span class="built_in">len</span>(self.messages) &gt; <span class="number">2</span>:</span><br><span class="line">            self.messages.pop(<span class="number">0</span>)  <span class="comment"># Remove oldest messages</span></span><br><span class="line">            total_tokens = <span class="built_in">sum</span>(<span class="built_in">len</span>(m[<span class="string">&quot;content&quot;</span>]) / <span class="number">4</span> <span class="keyword">for</span> m <span class="keyword">in</span> self.messages)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_context</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.messages</span><br><span class="line"></span><br><span class="line">memory = ShortTermMemory()</span><br><span class="line">memory.add_message(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;Find restaurants in Paris&quot;</span>)</span><br><span class="line">memory.add_message(<span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;I&#x27;ll search for restaurants in Paris...&quot;</span>)</span><br><span class="line">memory.add_message(<span class="string">&quot;system&quot;</span>, <span class="string">&quot;Found 50 results&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><em>Long-term Memory</em> persists important information across
sessions using vector databases:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LongTermMemory</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.embeddings = OpenAIEmbeddings()</span><br><span class="line">        self.vectorstore = Chroma(</span><br><span class="line">            collection_name=<span class="string">&quot;agent_memory&quot;</span>,</span><br><span class="line">            embedding_function=self.embeddings,</span><br><span class="line">            persist_directory=<span class="string">&quot;./memory_db&quot;</span></span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">store_experience</span>(<span class="params">self, task, action, result, success</span>):</span><br><span class="line">        doc = Document(</span><br><span class="line">            page_content=<span class="string">f&quot;Task: <span class="subst">&#123;task&#125;</span>\nAction: <span class="subst">&#123;action&#125;</span>\nResult: <span class="subst">&#123;result&#125;</span>&quot;</span>,</span><br><span class="line">            metadata=&#123;</span><br><span class="line">                <span class="string">&quot;task_type&quot;</span>: self._classify_task(task),</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: success,</span><br><span class="line">                <span class="string">&quot;timestamp&quot;</span>: datetime.now().isoformat()</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        self.vectorstore.add_documents([doc])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recall_similar_experiences</span>(<span class="params">self, current_task, k=<span class="number">3</span></span>):</span><br><span class="line">        <span class="comment"># Retrieve similar past experiences</span></span><br><span class="line">        similar_docs = self.vectorstore.similarity_search(</span><br><span class="line">            current_task, k=k</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> [doc.page_content <span class="keyword">for</span> doc <span class="keyword">in</span> similar_docs]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_classify_task</span>(<span class="params">self, task</span>):</span><br><span class="line">        <span class="comment"># Simple classification - could use LLM for more accuracy</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;search&quot;</span> <span class="keyword">in</span> task.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;information_retrieval&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;calculate&quot;</span> <span class="keyword">in</span> task.lower() <span class="keyword">or</span> <span class="string">&quot;compute&quot;</span> <span class="keyword">in</span> task.lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;computation&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;general&quot;</span></span><br><span class="line"></span><br><span class="line">ltm = LongTermMemory()</span><br><span class="line">ltm.store_experience(</span><br><span class="line">    task=<span class="string">&quot;Find population of Tokyo&quot;</span>,</span><br><span class="line">    action=<span class="string">&quot;Used search tool with query &#x27;Tokyo population 2024&#x27;&quot;</span>,</span><br><span class="line">    result=<span class="string">&quot;14 million in city proper, 37 million in metro area&quot;</span>,</span><br><span class="line">    success=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Later, when facing a similar task</span></span><br><span class="line">similar = ltm.recall_similar_experiences(<span class="string">&quot;What&#x27;s the population of London?&quot;</span>)</span><br><span class="line"><span class="comment"># Returns relevant past experiences to inform current approach</span></span><br></pre></td></tr></table></figure>
<p><strong>4. Tool Interface</strong></p>
<p>Tools extend the agent's capabilities beyond text generation. A
robust tool interface includes:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span>, <span class="type">Dict</span>, <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tool</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span></span><br><span class="line">    function: <span class="type">Callable</span></span><br><span class="line">    parameters: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = Field(default_factory=<span class="built_in">dict</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = self.function(**kwargs)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;success&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;result&quot;</span>: result&#125;</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;success&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Calculator tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculator</span>(<span class="params">expression: <span class="built_in">str</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Safely evaluate mathematical expressions&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">import</span> ast</span><br><span class="line">    <span class="keyword">import</span> operator</span><br><span class="line">    </span><br><span class="line">    ops = &#123;</span><br><span class="line">        ast.Add: operator.add,</span><br><span class="line">        ast.Sub: operator.sub,</span><br><span class="line">        ast.Mult: operator.mul,</span><br><span class="line">        ast.Div: operator.truediv,</span><br><span class="line">        ast.Pow: operator.<span class="built_in">pow</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eval_node</span>(<span class="params">node</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(node, ast.Num):</span><br><span class="line">            <span class="keyword">return</span> node.n</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(node, ast.BinOp):</span><br><span class="line">            <span class="keyword">return</span> ops[<span class="built_in">type</span>(node.op)](eval_node(node.left), eval_node(node.right))</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Unsupported operation: <span class="subst">&#123;node&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    tree = ast.parse(expression, mode=<span class="string">&#x27;eval&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> eval_node(tree.body)</span><br><span class="line"></span><br><span class="line">calc_tool = Tool(</span><br><span class="line">    name=<span class="string">&quot;calculator&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;Evaluates mathematical expressions. Input should be a valid expression like &#x27;2 + 2&#x27; or &#x27;10 * (3 + 4)&#x27;&quot;</span>,</span><br><span class="line">    function=calculator,</span><br><span class="line">    parameters=&#123;</span><br><span class="line">        <span class="string">&quot;expression&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Mathematical expression to evaluate&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using the tool</span></span><br><span class="line">result = calc_tool.execute(expression=<span class="string">&quot;(100 + 50) * 2&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># &#123;&quot;success&quot;: True, &quot;result&quot;: 300.0&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>5. Reflection and Self-Critique</strong></p>
<p>Advanced agents can evaluate their own outputs and iteratively
improve:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReflectiveAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, max_iterations=<span class="number">3</span></span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.max_iterations = max_iterations</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solve_with_reflection</span>(<span class="params">self, task</span>):</span><br><span class="line">        iterations = []</span><br><span class="line">        current_solution = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.max_iterations):</span><br><span class="line">            <span class="comment"># Generate solution</span></span><br><span class="line">            <span class="keyword">if</span> current_solution <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                prompt = <span class="string">f&quot;Solve this task: <span class="subst">&#123;task&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                prompt = <span class="string">f&quot;&quot;&quot;Previous solution: <span class="subst">&#123;current_solution&#125;</span></span></span><br><span class="line"><span class="string">                Critique: <span class="subst">&#123;iterations[-<span class="number">1</span>][<span class="string">&#x27;critique&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                Improve the solution based on the critique.&quot;&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            solution = self.llm.predict(prompt)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Self-critique</span></span><br><span class="line">            critique_prompt = <span class="string">f&quot;&quot;&quot;Evaluate this solution for the task: <span class="subst">&#123;task&#125;</span></span></span><br><span class="line"><span class="string">            Solution: <span class="subst">&#123;solution&#125;</span></span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            Identify:</span></span><br><span class="line"><span class="string">            1. What&#x27;s correct</span></span><br><span class="line"><span class="string">            2. What&#x27;s missing or incorrect</span></span><br><span class="line"><span class="string">            3. How to improve</span></span><br><span class="line"><span class="string">            4. Is this solution satisfactory? (Yes/No)</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">            critique = self.llm.predict(critique_prompt)</span><br><span class="line">            </span><br><span class="line">            iterations.append(&#123;</span><br><span class="line">                <span class="string">&quot;solution&quot;</span>: solution,</span><br><span class="line">                <span class="string">&quot;critique&quot;</span>: critique</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Check if satisfactory</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;yes&quot;</span> <span class="keyword">in</span> critique.lower().split(<span class="string">&quot;satisfactory?&quot;</span>)[-<span class="number">1</span>][:<span class="number">50</span>]:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            current_solution = solution</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;final_solution&quot;</span>: iterations[-<span class="number">1</span>][<span class="string">&quot;solution&quot;</span>],</span><br><span class="line">            <span class="string">&quot;iterations&quot;</span>: iterations</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">reflective_agent = ReflectiveAgent(llm)</span><br><span class="line">result = reflective_agent.solve_with_reflection(</span><br><span class="line">    <span class="string">&quot;Write a Python function to find all prime numbers up to n&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="ai-agents-vs.-traditional-llms-a-direct-comparison">AI Agents
vs. Traditional LLMs: A Direct Comparison</h3>
<p>To clarify the distinction, consider how each system handles the same
complex task:</p>
<p><strong>Task</strong>: "Research the top 3 machine learning
conferences, find their submission deadlines for 2025, and create a
calendar event for each deadline minus 2 weeks."</p>
<p><strong>Traditional LLM</strong>: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User: [sends entire task]</span><br><span class="line">LLM: Based on my training data (cutoff 2023), the top ML conferences are:</span><br><span class="line">     1. NeurIPS - typically December</span><br><span class="line">     2. ICML - typically July</span><br><span class="line">     3. CVPR - typically June</span><br><span class="line">     </span><br><span class="line">     However, I cannot access current 2025 deadlines or create calendar events.</span><br><span class="line">     You would need to manually search for these deadlines and create the events.</span><br></pre></td></tr></table></figure> Result: Provides
outdated information, cannot execute actions.</p>
<p><strong>AI Agent</strong>: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Agent (internal reasoning): </span><br><span class="line">  Step 1: Search for &quot;top machine learning conferences 2025&quot;</span><br><span class="line">  [Uses web search tool]</span><br><span class="line">  Result: NeurIPS, ICML, ICLR, CVPR, AAAI</span><br><span class="line"></span><br><span class="line">  Step 2: For top 3 (NeurIPS, ICML, ICLR), search submission deadlines</span><br><span class="line">  [Uses web search tool for each]</span><br><span class="line">  Results:</span><br><span class="line">    - NeurIPS 2025: May 15, 2025</span><br><span class="line">    - ICML 2025: January 31, 2025</span><br><span class="line">    - ICLR 2026: September 27, 2025</span><br><span class="line"></span><br><span class="line">  Step 3: Calculate reminder dates (deadline - 14 days)</span><br><span class="line">    - NeurIPS: May 1, 2025</span><br><span class="line">    - ICML: January 17, 2025</span><br><span class="line">    - ICLR: September 13, 2025</span><br><span class="line"></span><br><span class="line">  Step 4: Create calendar events</span><br><span class="line">  [Uses calendar API tool for each]</span><br><span class="line">  </span><br><span class="line">Agent response: </span><br><span class="line">  I&#x27;ve created calendar reminders for submission deadlines:</span><br><span class="line">  1. ICML 2025 reminder: January 17, 2025 (deadline: January 31)</span><br><span class="line">  2. NeurIPS 2025 reminder: May 1, 2025 (deadline: May 15)</span><br><span class="line">  3. ICLR 2026 reminder: September 13, 2025 (deadline: September 27)</span><br><span class="line">  </span><br><span class="line">  All events include links to conference websites and submission portals.</span><br></pre></td></tr></table></figure> Result: Autonomous execution
with current information and concrete actions taken.</p>
<h2 id="core-capabilities-of-ai-agents">Core Capabilities of AI
Agents</h2>
<p>The power of AI Agents stems from four fundamental capabilities that
work in concert. Understanding each capability in depth is essential for
building effective agent systems.</p>
<h3 id="planning-and-task-decomposition">Planning and Task
Decomposition</h3>
<p>Planning is the agent's ability to break down complex, ambiguous
goals into structured, executable sequences. Without effective planning,
agents resort to trial-and-error approaches that waste resources and
fail frequently.</p>
<h4 id="chain-of-thought-planning">Chain-of-Thought Planning</h4>
<p>The simplest planning approach is Chain-of-Thought (CoT), where
agents explicitly verbalize their reasoning:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ChainOfThoughtAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm</span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">self, problem</span>):</span><br><span class="line">        cot_prompt = <span class="string">f&quot;&quot;&quot;Solve this step-by-step. For each step, write:</span></span><br><span class="line"><span class="string">        - Thought: [Your reasoning]</span></span><br><span class="line"><span class="string">        - Action: [What to do]</span></span><br><span class="line"><span class="string">        - Observation: [Expected outcome]</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Problem: <span class="subst">&#123;problem&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Let&#x27;s think through this carefully:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        reasoning = self.llm.predict(cot_prompt)</span><br><span class="line">        <span class="keyword">return</span> self._parse_cot_response(reasoning)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_parse_cot_response</span>(<span class="params">self, response</span>):</span><br><span class="line">        steps = []</span><br><span class="line">        current_step = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> response.split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> line.startswith(<span class="string">&#x27;Thought:&#x27;</span>):</span><br><span class="line">                <span class="keyword">if</span> current_step:</span><br><span class="line">                    steps.append(current_step)</span><br><span class="line">                current_step = &#123;<span class="string">&#x27;thought&#x27;</span>: line.replace(<span class="string">&#x27;Thought:&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()&#125;</span><br><span class="line">            <span class="keyword">elif</span> line.startswith(<span class="string">&#x27;Action:&#x27;</span>):</span><br><span class="line">                current_step[<span class="string">&#x27;action&#x27;</span>] = line.replace(<span class="string">&#x27;Action:&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">            <span class="keyword">elif</span> line.startswith(<span class="string">&#x27;Observation:&#x27;</span>):</span><br><span class="line">                current_step[<span class="string">&#x27;observation&#x27;</span>] = line.replace(<span class="string">&#x27;Observation:&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> current_step:</span><br><span class="line">            steps.append(current_step)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> steps</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example usage</span></span><br><span class="line">agent = ChainOfThoughtAgent(llm)</span><br><span class="line">steps = agent.solve(</span><br><span class="line">    <span class="string">&quot;I have $100 and want to buy gifts for 5 friends. &quot;</span></span><br><span class="line">    <span class="string">&quot;Each gift should cost between $15-25. Do I have enough money?&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output steps:</span></span><br><span class="line"><span class="comment"># [</span></span><br><span class="line"><span class="comment">#   &#123;</span></span><br><span class="line"><span class="comment">#     &#x27;thought&#x27;: &#x27;First, determine the minimum and maximum total cost&#x27;,</span></span><br><span class="line"><span class="comment">#     &#x27;action&#x27;: &#x27;Calculate: 5 friends  $15 (minimum) and 5 friends  $25 (maximum)&#x27;,</span></span><br><span class="line"><span class="comment">#     &#x27;observation&#x27;: &#x27;Minimum total: $75, Maximum total: $125&#x27;</span></span><br><span class="line"><span class="comment">#   &#125;,</span></span><br><span class="line"><span class="comment">#   &#123;</span></span><br><span class="line"><span class="comment">#     &#x27;thought&#x27;: &#x27;Compare budget to the cost range&#x27;,</span></span><br><span class="line"><span class="comment">#     &#x27;action&#x27;: &#x27;Check if $100 falls within [$75, $125]&#x27;,</span></span><br><span class="line"><span class="comment">#     &#x27;observation&#x27;: &#x27;$100 is greater than minimum ($75) but less than maximum ($125)&#x27;</span></span><br><span class="line"><span class="comment">#   &#125;,</span></span><br><span class="line"><span class="comment">#   &#123;</span></span><br><span class="line"><span class="comment">#     &#x27;thought&#x27;: &#x27;Determine if budget is sufficient&#x27;,</span></span><br><span class="line"><span class="comment">#     &#x27;action&#x27;: &#x27;Conclude based on comparison&#x27;,</span></span><br><span class="line"><span class="comment">#     &#x27;observation&#x27;: &#x27;You have enough for minimum but not maximum. Budget carefully.&#x27;</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment"># ]</span></span><br></pre></td></tr></table></figure>
<h4 id="react-reasoning-acting">ReAct: Reasoning + Acting</h4>
<p>ReAct (Reason + Act) interleaves thinking with tool use, allowing
agents to gather information before planning subsequent steps:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReActAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, tools: <span class="type">List</span>[Tool], max_iterations=<span class="number">10</span></span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.tools = &#123;tool.name: tool <span class="keyword">for</span> tool <span class="keyword">in</span> tools&#125;</span><br><span class="line">        self.max_iterations = max_iterations</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, task: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        history = []</span><br><span class="line">        observation = <span class="string">f&quot;Task: <span class="subst">&#123;task&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> iteration <span class="keyword">in</span> <span class="built_in">range</span>(self.max_iterations):</span><br><span class="line">            <span class="comment"># Reasoning step</span></span><br><span class="line">            thought_prompt = self._build_prompt(task, history, observation)</span><br><span class="line">            response = self.llm.predict(thought_prompt)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Parse response</span></span><br><span class="line">            parsed = self._parse_response(response)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> parsed[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;final_answer&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&#x27;answer&#x27;</span>: parsed[<span class="string">&#x27;content&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;iterations&#x27;</span>: iteration + <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&#x27;history&#x27;</span>: history</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Action step</span></span><br><span class="line">            tool_name = parsed[<span class="string">&#x27;tool&#x27;</span>]</span><br><span class="line">            tool_input = parsed[<span class="string">&#x27;input&#x27;</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> tool_name <span class="keyword">not</span> <span class="keyword">in</span> self.tools:</span><br><span class="line">                observation = <span class="string">f&quot;Error: Tool &#x27;<span class="subst">&#123;tool_name&#125;</span>&#x27; not found. Available tools: <span class="subst">&#123;<span class="built_in">list</span>(self.tools.keys())&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = self.tools[tool_name].execute(**tool_input)</span><br><span class="line">                observation = result[<span class="string">&#x27;result&#x27;</span>] <span class="keyword">if</span> result[<span class="string">&#x27;success&#x27;</span>] <span class="keyword">else</span> result[<span class="string">&#x27;error&#x27;</span>]</span><br><span class="line">            </span><br><span class="line">            history.append(&#123;</span><br><span class="line">                <span class="string">&#x27;iteration&#x27;</span>: iteration + <span class="number">1</span>,</span><br><span class="line">                <span class="string">&#x27;thought&#x27;</span>: parsed.get(<span class="string">&#x27;thought&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">                <span class="string">&#x27;action&#x27;</span>: <span class="string">f&quot;<span class="subst">&#123;tool_name&#125;</span>(<span class="subst">&#123;tool_input&#125;</span>)&quot;</span>,</span><br><span class="line">                <span class="string">&#x27;observation&#x27;</span>: observation</span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;answer&#x27;</span>: <span class="string">&#x27;Max iterations reached without finding answer&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;iterations&#x27;</span>: self.max_iterations,</span><br><span class="line">            <span class="string">&#x27;history&#x27;</span>: history</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_build_prompt</span>(<span class="params">self, task, history, last_observation</span>):</span><br><span class="line">        history_str = <span class="string">&quot;\n&quot;</span>.join([</span><br><span class="line">            <span class="string">f&quot;Thought <span class="subst">&#123;h[<span class="string">&#x27;iteration&#x27;</span>]&#125;</span>: <span class="subst">&#123;h[<span class="string">&#x27;thought&#x27;</span>]&#125;</span>\n&quot;</span></span><br><span class="line">            <span class="string">f&quot;Action <span class="subst">&#123;h[<span class="string">&#x27;iteration&#x27;</span>]&#125;</span>: <span class="subst">&#123;h[<span class="string">&#x27;action&#x27;</span>]&#125;</span>\n&quot;</span></span><br><span class="line">            <span class="string">f&quot;Observation <span class="subst">&#123;h[<span class="string">&#x27;iteration&#x27;</span>]&#125;</span>: <span class="subst">&#123;h[<span class="string">&#x27;observation&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">for</span> h <span class="keyword">in</span> history</span><br><span class="line">        ])</span><br><span class="line">        </span><br><span class="line">        tools_description = <span class="string">&quot;\n&quot;</span>.join([</span><br><span class="line">            <span class="string">f&quot;- <span class="subst">&#123;name&#125;</span>: <span class="subst">&#123;tool.description&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">for</span> name, tool <span class="keyword">in</span> self.tools.items()</span><br><span class="line">        ])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;&quot;&quot;You are a helpful assistant that can use tools to solve tasks.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Available tools:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;tools_description&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Task: <span class="subst">&#123;task&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">&#123;history_str&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last observation: <span class="subst">&#123;last_observation&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Think step by step:</span></span><br><span class="line"><span class="string">Thought: [Your reasoning about what to do next]</span></span><br><span class="line"><span class="string">Action: [Tool name to use, or &quot;Final Answer&quot; if task is complete]</span></span><br><span class="line"><span class="string">Action Input: [Input to the tool as JSON, or your final answer]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your response:&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_parse_response</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># Extract thought, action, and input from LLM response</span></span><br><span class="line">        lines = response.strip().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        parsed = &#123;<span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;action&#x27;</span>&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            <span class="keyword">if</span> line.startswith(<span class="string">&#x27;Thought:&#x27;</span>):</span><br><span class="line">                parsed[<span class="string">&#x27;thought&#x27;</span>] = line.replace(<span class="string">&#x27;Thought:&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">            <span class="keyword">elif</span> line.startswith(<span class="string">&#x27;Action:&#x27;</span>):</span><br><span class="line">                action = line.replace(<span class="string">&#x27;Action:&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;Final Answer&#x27;</span> <span class="keyword">in</span> action:</span><br><span class="line">                    parsed[<span class="string">&#x27;type&#x27;</span>] = <span class="string">&#x27;final_answer&#x27;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    parsed[<span class="string">&#x27;tool&#x27;</span>] = action</span><br><span class="line">            <span class="keyword">elif</span> line.startswith(<span class="string">&#x27;Action Input:&#x27;</span>):</span><br><span class="line">                input_str = line.replace(<span class="string">&#x27;Action Input:&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">                <span class="keyword">if</span> parsed[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;final_answer&#x27;</span>:</span><br><span class="line">                    parsed[<span class="string">&#x27;content&#x27;</span>] = input_str</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        parsed[<span class="string">&#x27;input&#x27;</span>] = <span class="built_in">eval</span>(input_str)  <span class="comment"># or json.loads for safer parsing</span></span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        parsed[<span class="string">&#x27;input&#x27;</span>] = &#123;<span class="string">&#x27;query&#x27;</span>: input_str&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parsed</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Building a ReAct agent with search and calculator tools</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">search_tool</span>(<span class="params">query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># Simulated search - in production, use real search API</span></span><br><span class="line">    search_results = &#123;</span><br><span class="line">        <span class="string">&quot;capital of France&quot;</span>: <span class="string">&quot;Paris is the capital of France, with a population of approximately 2.2 million.&quot;</span>,</span><br><span class="line">        <span class="string">&quot;population of Tokyo&quot;</span>: <span class="string">&quot;Tokyo&#x27;s population is approximately 14 million in the city proper, 37 million in the metro area.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> search_results.get(query.lower(), <span class="string">f&quot;No results found for: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">tools = [</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;Search&quot;</span>,</span><br><span class="line">        description=<span class="string">&quot;Searches for factual information. Input should be a search query string.&quot;</span>,</span><br><span class="line">        function=search_tool</span><br><span class="line">    ),</span><br><span class="line">    calc_tool  <span class="comment"># Defined earlier</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">react_agent = ReActAgent(llm, tools)</span><br><span class="line">result = react_agent.run(</span><br><span class="line">    <span class="string">&quot;What&#x27;s the population of Tokyo divided by the population of Paris?&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The agent will:</span></span><br><span class="line"><span class="comment"># 1. Search for Tokyo population (Observation: ~14 million)</span></span><br><span class="line"><span class="comment"># 2. Search for Paris population (Observation: ~2.2 million)</span></span><br><span class="line"><span class="comment"># 3. Use calculator: 14000000 / 2200000 (Observation: ~6.36)</span></span><br><span class="line"><span class="comment"># 4. Return final answer: &quot;Tokyo&#x27;s population is approximately 6.36 times Paris&#x27;s population&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="tree-of-thoughts-exploring-multiple-reasoning-paths">Tree of
Thoughts: Exploring Multiple Reasoning Paths</h4>
<p>For complex problems, Tree of Thoughts (ToT) explores multiple
reasoning branches and evaluates them:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeOfThoughts</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, max_depth=<span class="number">3</span>, num_branches=<span class="number">3</span></span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.max_depth = max_depth</span><br><span class="line">        self.num_branches = num_branches</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">self, problem</span>):</span><br><span class="line">        root = ThoughtNode(</span><br><span class="line">            content=<span class="string">f&quot;Problem: <span class="subst">&#123;problem&#125;</span>&quot;</span>,</span><br><span class="line">            depth=<span class="number">0</span>,</span><br><span class="line">            value=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Best-first search through thought tree</span></span><br><span class="line">        frontier = [root]</span><br><span class="line">        best_solution = <span class="literal">None</span></span><br><span class="line">        best_value = <span class="built_in">float</span>(<span class="string">&#x27;-inf&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> frontier <span class="keyword">and</span> <span class="built_in">len</span>(frontier) &lt; <span class="number">100</span>:  <span class="comment"># Limit total nodes</span></span><br><span class="line">            <span class="comment"># Select most promising node</span></span><br><span class="line">            current = <span class="built_in">max</span>(frontier, key=<span class="keyword">lambda</span> n: n.value)</span><br><span class="line">            frontier.remove(current)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> current.depth &gt;= self.max_depth:</span><br><span class="line">                <span class="comment"># Evaluate as potential solution</span></span><br><span class="line">                value = self._evaluate_solution(problem, current)</span><br><span class="line">                <span class="keyword">if</span> value &gt; best_value:</span><br><span class="line">                    best_value = value</span><br><span class="line">                    best_solution = current</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Generate child thoughts</span></span><br><span class="line">            children = self._generate_thoughts(problem, current)</span><br><span class="line">            frontier.extend(children)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self._extract_solution_path(best_solution)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_thoughts</span>(<span class="params">self, problem, parent_node</span>):</span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;Given this problem and current reasoning path:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Problem: <span class="subst">&#123;problem&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Current path: <span class="subst">&#123;parent_node.get_path()&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Generate <span class="subst">&#123;self.num_branches&#125;</span> different next reasoning steps.</span></span><br><span class="line"><span class="string">For each, provide:</span></span><br><span class="line"><span class="string">- The reasoning step</span></span><br><span class="line"><span class="string">- Why this approach might work</span></span><br><span class="line"><span class="string">- Potential issues</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Format each thought as:</span></span><br><span class="line"><span class="string">Thought N: [reasoning step]</span></span><br><span class="line"><span class="string">Rationale: [why it might work]</span></span><br><span class="line"><span class="string">Issues: [potential problems]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(prompt)</span><br><span class="line">        thoughts = self._parse_thoughts(response)</span><br><span class="line">        </span><br><span class="line">        children = []</span><br><span class="line">        <span class="keyword">for</span> thought <span class="keyword">in</span> thoughts[:self.num_branches]:</span><br><span class="line">            child = ThoughtNode(</span><br><span class="line">                content=thought[<span class="string">&#x27;content&#x27;</span>],</span><br><span class="line">                depth=parent_node.depth + <span class="number">1</span>,</span><br><span class="line">                parent=parent_node</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># Evaluate this thought&#x27;s promise</span></span><br><span class="line">            child.value = self._evaluate_thought(problem, child)</span><br><span class="line">            children.append(child)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> children</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_evaluate_thought</span>(<span class="params">self, problem, node</span>):</span><br><span class="line">        eval_prompt = <span class="string">f&quot;&quot;&quot;Evaluate this reasoning step for solving the problem.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">Problem: <span class="subst">&#123;problem&#125;</span></span></span><br><span class="line"><span class="string">Reasoning path: <span class="subst">&#123;node.get_path()&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Rate this path&#x27;s promise from 0-10:</span></span><br><span class="line"><span class="string">- Correctness: Does it make logical sense?</span></span><br><span class="line"><span class="string">- Relevance: Does it address the problem?</span></span><br><span class="line"><span class="string">- Progress: Does it move closer to a solution?</span></span><br><span class="line"><span class="string">- Feasibility: Can it lead to a concrete answer?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Provide a score and brief justification.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(eval_prompt)</span><br><span class="line">        <span class="comment"># Parse score from response</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            score = <span class="built_in">float</span>([s <span class="keyword">for</span> s <span class="keyword">in</span> response.split() <span class="keyword">if</span> s.replace(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;&#x27;</span>).isdigit()][<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">min</span>(<span class="built_in">max</span>(score, <span class="number">0</span>), <span class="number">10</span>)  <span class="comment"># Clamp to [0, 10]</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">5.0</span>  <span class="comment"># Default score</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_evaluate_solution</span>(<span class="params">self, problem, node</span>):</span><br><span class="line">        eval_prompt = <span class="string">f&quot;&quot;&quot;Evaluate this complete solution to the problem.</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">Problem: <span class="subst">&#123;problem&#125;</span></span></span><br><span class="line"><span class="string">Solution path: <span class="subst">&#123;node.get_path()&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Rate this solution from 0-10:</span></span><br><span class="line"><span class="string">- Correctness: Is the solution correct?</span></span><br><span class="line"><span class="string">- Completeness: Does it fully address the problem?</span></span><br><span class="line"><span class="string">- Clarity: Is the reasoning clear?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Provide a score.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(eval_prompt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            score = <span class="built_in">float</span>([s <span class="keyword">for</span> s <span class="keyword">in</span> response.split() <span class="keyword">if</span> s.replace(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;&#x27;</span>).isdigit()][<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">min</span>(<span class="built_in">max</span>(score, <span class="number">0</span>), <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">5.0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_parse_thoughts</span>(<span class="params">self, response</span>):</span><br><span class="line">        thoughts = []</span><br><span class="line">        current = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> response.split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> line.startswith(<span class="string">&#x27;Thought&#x27;</span>):</span><br><span class="line">                <span class="keyword">if</span> current:</span><br><span class="line">                    thoughts.append(current)</span><br><span class="line">                current = &#123;<span class="string">&#x27;content&#x27;</span>: line.split(<span class="string">&#x27;:&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].strip() <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> line <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">            <span class="keyword">elif</span> line.startswith(<span class="string">&#x27;Rationale:&#x27;</span>):</span><br><span class="line">                current[<span class="string">&#x27;rationale&#x27;</span>] = line.replace(<span class="string">&#x27;Rationale:&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">            <span class="keyword">elif</span> line.startswith(<span class="string">&#x27;Issues:&#x27;</span>):</span><br><span class="line">                current[<span class="string">&#x27;issues&#x27;</span>] = line.replace(<span class="string">&#x27;Issues:&#x27;</span>, <span class="string">&#x27;&#x27;</span>).strip()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> current:</span><br><span class="line">            thoughts.append(current)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> thoughts</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_extract_solution_path</span>(<span class="params">self, node</span>):</span><br><span class="line">        path = []</span><br><span class="line">        current = node</span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            path.append(current.content)</span><br><span class="line">            current = current.parent</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">reversed</span>(path))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThoughtNode</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, content, depth, parent=<span class="literal">None</span>, value=<span class="number">0</span></span>):</span><br><span class="line">        self.content = content</span><br><span class="line">        self.depth = depth</span><br><span class="line">        self.parent = parent</span><br><span class="line">        self.value = value</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_path</span>(<span class="params">self</span>):</span><br><span class="line">        path = []</span><br><span class="line">        current = self</span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            path.append(current.content)</span><br><span class="line">            current = current.parent</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot; -&gt; &quot;</span>.join(<span class="built_in">reversed</span>(path))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example usage</span></span><br><span class="line">tot_solver = TreeOfThoughts(llm, max_depth=<span class="number">4</span>, num_branches=<span class="number">3</span>)</span><br><span class="line">solution = tot_solver.solve(</span><br><span class="line">    <span class="string">&quot;Design a database schema for a social media platform that supports &quot;</span></span><br><span class="line">    <span class="string">&quot;posts, comments, likes, follows, and direct messaging while ensuring &quot;</span></span><br><span class="line">    <span class="string">&quot;scalability and fast query performance.&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="memory-architecture">Memory Architecture</h3>
<p>Memory is what transforms a stateless LLM into a stateful agent that
learns from experience and maintains context across long
interactions.</p>
<h4 id="working-memory-conversation-buffer">Working Memory (Conversation
Buffer)</h4>
<p>The simplest memory form stores recent conversation history:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConversationBuffer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, max_messages=<span class="number">20</span>, max_tokens=<span class="number">4000</span></span>):</span><br><span class="line">        self.messages = deque(maxlen=max_messages)</span><br><span class="line">        self.max_tokens = max_tokens</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, role, content</span>):</span><br><span class="line">        self.messages.append(&#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: role,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: content,</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: datetime.now()</span><br><span class="line">        &#125;)</span><br><span class="line">        self._enforce_token_limit()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_enforce_token_limit</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> self._estimate_tokens() &gt; self.max_tokens <span class="keyword">and</span> <span class="built_in">len</span>(self.messages) &gt; <span class="number">2</span>:</span><br><span class="line">            self.messages.popleft()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_estimate_tokens</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Rough token estimation (4 chars  1 token)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(<span class="built_in">len</span>(msg[<span class="string">&quot;content&quot;</span>]) <span class="keyword">for</span> msg <span class="keyword">in</span> self.messages) // <span class="number">4</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_context</span>(<span class="params">self, include_system=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="keyword">if</span> include_system:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">list</span>(self.messages)</span><br><span class="line">        <span class="keyword">return</span> [msg <span class="keyword">for</span> msg <span class="keyword">in</span> self.messages <span class="keyword">if</span> msg[<span class="string">&quot;role&quot;</span>] != <span class="string">&quot;system&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear</span>(<span class="params">self</span>):</span><br><span class="line">        self.messages.clear()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Usage in agent</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConversationalAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm</span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.memory = ConversationBuffer()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">self, user_input</span>):</span><br><span class="line">        self.memory.add(<span class="string">&quot;user&quot;</span>, user_input)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Build prompt with conversation history</span></span><br><span class="line">        messages = self.memory.get_context()</span><br><span class="line">        response = self.llm.predict_messages(messages)</span><br><span class="line">        </span><br><span class="line">        self.memory.add(<span class="string">&quot;assistant&quot;</span>, response)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h4 id="entity-memory-tracking-important-information">Entity Memory:
Tracking Important Information</h4>
<p>Entity memory extracts and maintains information about specific
entities (people, places, concepts):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EntityMemory</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm</span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.entities = &#123;&#125;  <span class="comment"># entity_name -&gt; &#123;attributes&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_entities</span>(<span class="params">self, text</span>):</span><br><span class="line">        extract_prompt = <span class="string">f&quot;&quot;&quot;Extract all important entities from this text and their attributes:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text: <span class="subst">&#123;text&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For each entity, provide:</span></span><br><span class="line"><span class="string">- Name</span></span><br><span class="line"><span class="string">- Type (person, place, organization, concept, etc.)</span></span><br><span class="line"><span class="string">- Attributes (key facts about this entity)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Format as JSON:</span></span><br><span class="line"><span class="string">&#123;&#123;</span></span><br><span class="line"><span class="string">  &quot;entities&quot;: [</span></span><br><span class="line"><span class="string">    &#123;&#123;&quot;name&quot;: &quot;...&quot;, &quot;type&quot;: &quot;...&quot;, &quot;attributes&quot;: [&quot;...&quot;, &quot;...&quot;]&#125;&#125;,</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(extract_prompt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            entities_data = <span class="built_in">eval</span>(response)  <span class="comment"># or json.loads</span></span><br><span class="line">            <span class="keyword">for</span> entity <span class="keyword">in</span> entities_data.get(<span class="string">&quot;entities&quot;</span>, []):</span><br><span class="line">                self._update_entity(entity)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Error parsing entities: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_update_entity</span>(<span class="params">self, entity_data</span>):</span><br><span class="line">        name = entity_data[<span class="string">&quot;name&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> self.entities:</span><br><span class="line">            self.entities[name] = &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: entity_data[<span class="string">&quot;type&quot;</span>],</span><br><span class="line">                <span class="string">&quot;attributes&quot;</span>: <span class="built_in">set</span>(),</span><br><span class="line">                <span class="string">&quot;mentioned_count&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">&quot;last_mentioned&quot;</span>: <span class="literal">None</span></span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        self.entities[name][<span class="string">&quot;attributes&quot;</span>].update(entity_data.get(<span class="string">&quot;attributes&quot;</span>, []))</span><br><span class="line">        self.entities[name][<span class="string">&quot;mentioned_count&quot;</span>] += <span class="number">1</span></span><br><span class="line">        self.entities[name][<span class="string">&quot;last_mentioned&quot;</span>] = datetime.now()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_entity_info</span>(<span class="params">self, entity_name</span>):</span><br><span class="line">        <span class="keyword">return</span> self.entities.get(entity_name, <span class="literal">None</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_context_about</span>(<span class="params">self, entity_names: <span class="type">List</span>[<span class="built_in">str</span>]</span>):</span><br><span class="line">        context = []</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> entity_names:</span><br><span class="line">            <span class="keyword">if</span> name <span class="keyword">in</span> self.entities:</span><br><span class="line">                entity = self.entities[name]</span><br><span class="line">                attributes_str = <span class="string">&quot;, &quot;</span>.join(entity[<span class="string">&quot;attributes&quot;</span>])</span><br><span class="line">                context.append(</span><br><span class="line">                    <span class="string">f&quot;<span class="subst">&#123;name&#125;</span> (<span class="subst">&#123;entity[<span class="string">&#x27;type&#x27;</span>]&#125;</span>): <span class="subst">&#123;attributes_str&#125;</span>&quot;</span></span><br><span class="line">                )</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(context)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example usage</span></span><br><span class="line">entity_mem = EntityMemory(llm)</span><br><span class="line"></span><br><span class="line">conversation = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">User: Tell me about John. He works at Google as a senior engineer.</span></span><br><span class="line"><span class="string">Assistant: I&#x27;ll remember that John is a senior engineer at Google.</span></span><br><span class="line"><span class="string">User: John is working on their new AI project.</span></span><br><span class="line"><span class="string">Assistant: Got it, John is involved in Google&#x27;s AI project.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">entity_mem.extract_entities(conversation)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Later retrieval</span></span><br><span class="line">john_info = entity_mem.get_entity_info(<span class="string">&quot;John&quot;</span>)</span><br><span class="line"><span class="comment"># Returns: &#123;</span></span><br><span class="line"><span class="comment">#   &quot;type&quot;: &quot;person&quot;,</span></span><br><span class="line"><span class="comment">#   &quot;attributes&quot;: &#123;&quot;senior engineer&quot;, &quot;works at Google&quot;, &quot;working on AI project&quot;&#125;,</span></span><br><span class="line"><span class="comment">#   &quot;mentioned_count&quot;: 2,</span></span><br><span class="line"><span class="comment">#   &quot;last_mentioned&quot;: datetime(...)</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="semantic-memory-vector-based-retrieval">Semantic Memory:
Vector-based Retrieval</h4>
<p>For long-term knowledge retention, semantic memory uses embeddings to
retrieve relevant past experiences:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> FAISS</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SemanticMemory</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embedding_model=<span class="string">&quot;text-embedding-ada-002&quot;</span></span>):</span><br><span class="line">        self.embeddings = OpenAIEmbeddings(model=embedding_model)</span><br><span class="line">        self.vectorstore = <span class="literal">None</span></span><br><span class="line">        self.documents = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_memory</span>(<span class="params">self, content, metadata=<span class="literal">None</span></span>):</span><br><span class="line">        doc = Document(</span><br><span class="line">            page_content=content,</span><br><span class="line">            metadata=metadata <span class="keyword">or</span> &#123;<span class="string">&quot;timestamp&quot;</span>: datetime.now().isoformat()&#125;</span><br><span class="line">        )</span><br><span class="line">        self.documents.append(doc)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Rebuild vector store</span></span><br><span class="line">        <span class="keyword">if</span> self.vectorstore <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.vectorstore = FAISS.from_documents(self.documents, self.embeddings)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.vectorstore.add_documents([doc])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recall</span>(<span class="params">self, query, k=<span class="number">5</span>, filter_metadata=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="keyword">if</span> self.vectorstore <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Semantic similarity search</span></span><br><span class="line">        results = self.vectorstore.similarity_search_with_score(</span><br><span class="line">            query, k=k</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Filter by metadata if provided</span></span><br><span class="line">        <span class="keyword">if</span> filter_metadata:</span><br><span class="line">            results = [</span><br><span class="line">                (doc, score) <span class="keyword">for</span> doc, score <span class="keyword">in</span> results</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">all</span>(doc.metadata.get(k) == v <span class="keyword">for</span> k, v <span class="keyword">in</span> filter_metadata.items())</span><br><span class="line">            ]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [(doc.page_content, doc.metadata, score) <span class="keyword">for</span> doc, score <span class="keyword">in</span> results]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_relevant_context</span>(<span class="params">self, query, max_tokens=<span class="number">1000</span></span>):</span><br><span class="line">        memories = self.recall(query, k=<span class="number">10</span>)</span><br><span class="line">        </span><br><span class="line">        context_parts = []</span><br><span class="line">        current_tokens = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> content, metadata, score <span class="keyword">in</span> memories:</span><br><span class="line">            tokens = <span class="built_in">len</span>(content) // <span class="number">4</span></span><br><span class="line">            <span class="keyword">if</span> current_tokens + tokens &gt; max_tokens:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            context_parts.append(<span class="string">f&quot;[Relevance: <span class="subst">&#123;score:<span class="number">.2</span>f&#125;</span>] <span class="subst">&#123;content&#125;</span>&quot;</span>)</span><br><span class="line">            current_tokens += tokens</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n\n&quot;</span>.join(context_parts)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Agent with semantic memory</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MemoryEnhancedAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm</span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.semantic_memory = SemanticMemory()</span><br><span class="line">        self.conversation_buffer = ConversationBuffer()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process</span>(<span class="params">self, user_input</span>):</span><br><span class="line">        <span class="comment"># Retrieve relevant past context</span></span><br><span class="line">        relevant_memories = self.semantic_memory.get_relevant_context(user_input)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Build prompt with both recent conversation and relevant memories</span></span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;Relevant past context:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;relevant_memories&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Recent conversation:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;self._format_recent_messages()&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">User: <span class="subst">&#123;user_input&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Assistant (respond naturally):&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(prompt)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Store this interaction in memory</span></span><br><span class="line">        self.conversation_buffer.add(<span class="string">&quot;user&quot;</span>, user_input)</span><br><span class="line">        self.conversation_buffer.add(<span class="string">&quot;assistant&quot;</span>, response)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Add to semantic memory for long-term retention</span></span><br><span class="line">        self.semantic_memory.add_memory(</span><br><span class="line">            <span class="string">f&quot;User asked: <span class="subst">&#123;user_input&#125;</span>\nAssistant responded: <span class="subst">&#123;response&#125;</span>&quot;</span>,</span><br><span class="line">            metadata=&#123;</span><br><span class="line">                <span class="string">&quot;timestamp&quot;</span>: datetime.now().isoformat(),</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;conversation&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_format_recent_messages</span>(<span class="params">self</span>):</span><br><span class="line">        messages = self.conversation_buffer.get_context()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join([</span><br><span class="line">            <span class="string">f&quot;<span class="subst">&#123;msg[<span class="string">&#x27;role&#x27;</span>].capitalize()&#125;</span>: <span class="subst">&#123;msg[<span class="string">&#x27;content&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">for</span> msg <span class="keyword">in</span> messages[-<span class="number">5</span>:]  <span class="comment"># Last 5 messages</span></span><br><span class="line">        ])</span><br></pre></td></tr></table></figure>
<h4 id="episodic-memory-learning-from-experience">Episodic Memory:
Learning from Experience</h4>
<p>Episodic memory stores complete episodes (sequences of actions and
their outcomes) to inform future behavior:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Episode</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, task, steps, outcome, success</span>):</span><br><span class="line">        self.task = task</span><br><span class="line">        self.steps = steps</span><br><span class="line">        self.outcome = outcome</span><br><span class="line">        self.success = success</span><br><span class="line">        self.timestamp = datetime.now()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_dict</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;task&quot;</span>: self.task,</span><br><span class="line">            <span class="string">&quot;steps&quot;</span>: self.steps,</span><br><span class="line">            <span class="string">&quot;outcome&quot;</span>: self.outcome,</span><br><span class="line">            <span class="string">&quot;success&quot;</span>: self.success,</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: self.timestamp.isoformat()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EpisodicMemory</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.episodes = []</span><br><span class="line">        self.embeddings = OpenAIEmbeddings()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">store_episode</span>(<span class="params">self, task, steps, outcome, success</span>):</span><br><span class="line">        episode = Episode(task, steps, outcome, success)</span><br><span class="line">        self.episodes.append(episode)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve_similar_episodes</span>(<span class="params">self, current_task, k=<span class="number">3</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.episodes:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Embed current task</span></span><br><span class="line">        current_embedding = self.embeddings.embed_query(current_task)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Embed all past episodes</span></span><br><span class="line">        episode_texts = [ep.task <span class="keyword">for</span> ep <span class="keyword">in</span> self.episodes]</span><br><span class="line">        episode_embeddings = self.embeddings.embed_documents(episode_texts)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Calculate similarities</span></span><br><span class="line">        <span class="keyword">from</span> numpy <span class="keyword">import</span> dot</span><br><span class="line">        <span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> norm</span><br><span class="line">        </span><br><span class="line">        similarities = [</span><br><span class="line">            dot(current_embedding, ep_emb) / (norm(current_embedding) * norm(ep_emb))</span><br><span class="line">            <span class="keyword">for</span> ep_emb <span class="keyword">in</span> episode_embeddings</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Get top k similar episodes</span></span><br><span class="line">        sorted_indices = <span class="built_in">sorted</span>(</span><br><span class="line">            <span class="built_in">range</span>(<span class="built_in">len</span>(similarities)),</span><br><span class="line">            key=<span class="keyword">lambda</span> i: similarities[i],</span><br><span class="line">            reverse=<span class="literal">True</span></span><br><span class="line">        )[:k]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [(self.episodes[i], similarities[i]) <span class="keyword">for</span> i <span class="keyword">in</span> sorted_indices]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">learn_from_episodes</span>(<span class="params">self, llm, current_task</span>):</span><br><span class="line">        similar_episodes = self.retrieve_similar_episodes(current_task, k=<span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> similar_episodes:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No relevant past experience.&quot;</span></span><br><span class="line">        </span><br><span class="line">        episodes_text = <span class="string">&quot;\n\n&quot;</span>.join([</span><br><span class="line">            <span class="string">f&quot;Episode <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> (similarity: <span class="subst">&#123;sim:<span class="number">.2</span>f&#125;</span>):\n&quot;</span></span><br><span class="line">            <span class="string">f&quot;Task: <span class="subst">&#123;ep.task&#125;</span>\n&quot;</span></span><br><span class="line">            <span class="string">f&quot;Steps taken: <span class="subst">&#123;ep.steps&#125;</span>\n&quot;</span></span><br><span class="line">            <span class="string">f&quot;Outcome: <span class="subst">&#123;ep.outcome&#125;</span>\n&quot;</span></span><br><span class="line">            <span class="string">f&quot;Success: <span class="subst">&#123;ep.success&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">for</span> i, (ep, sim) <span class="keyword">in</span> <span class="built_in">enumerate</span>(similar_episodes)</span><br><span class="line">        ])</span><br><span class="line">        </span><br><span class="line">        learning_prompt = <span class="string">f&quot;&quot;&quot;Based on these past experiences with similar tasks:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">&#123;episodes_text&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Current task: <span class="subst">&#123;current_task&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">What lessons can we learn? Provide:</span></span><br><span class="line"><span class="string">1. What approaches worked well</span></span><br><span class="line"><span class="string">2. What approaches failed</span></span><br><span class="line"><span class="string">3. Recommended strategy for the current task</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> llm.predict(learning_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Agent that learns from experience</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LearningAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, tools</span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.tools = tools</span><br><span class="line">        self.episodic_memory = EpisodicMemory()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_task</span>(<span class="params">self, task</span>):</span><br><span class="line">        <span class="comment"># Learn from similar past tasks</span></span><br><span class="line">        lessons = self.episodic_memory.learn_from_episodes(self.llm, task)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Execute with learned knowledge</span></span><br><span class="line">        steps = []</span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;Task: <span class="subst">&#123;task&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Lessons from similar past tasks:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;lessons&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Create a step-by-step plan:&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        plan = self.llm.predict(prompt)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Execute plan (simplified)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># ... execution logic ...</span></span><br><span class="line">            outcome = <span class="string">&quot;Successfully completed task&quot;</span></span><br><span class="line">            success = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            outcome = <span class="string">f&quot;Failed: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">            success = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Store this episode</span></span><br><span class="line">        self.episodic_memory.store_episode(task, steps, outcome, success)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> outcome</span><br></pre></td></tr></table></figure>
<h3 id="tool-use-and-function-calling">Tool Use and Function
Calling</h3>
<p>Tools extend agents beyond text generation into concrete actions.
Modern agents use function calling to interact with APIs, databases,
calculators, search engines, and more.</p>
<h4 id="function-calling-with-openai-api">Function Calling with OpenAI
API</h4>
<p>OpenAI's function calling allows structured tool invocation:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FunctionCallingAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, api_key, model=<span class="string">&quot;gpt-4-turbo&quot;</span></span>):</span><br><span class="line">        self.client = openai.OpenAI(api_key=api_key)</span><br><span class="line">        self.model = model</span><br><span class="line">        self.available_functions = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_tool</span>(<span class="params">self, func, schema</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Register a Python function as a tool&quot;&quot;&quot;</span></span><br><span class="line">        self.available_functions[func.__name__] = &#123;</span><br><span class="line">            <span class="string">&quot;function&quot;</span>: func,</span><br><span class="line">            <span class="string">&quot;schema&quot;</span>: schema</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, user_message, max_iterations=<span class="number">5</span></span>):</span><br><span class="line">        messages = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_message&#125;]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> iteration <span class="keyword">in</span> <span class="built_in">range</span>(max_iterations):</span><br><span class="line">            <span class="comment"># Get function schemas</span></span><br><span class="line">            functions = [</span><br><span class="line">                tool[<span class="string">&quot;schema&quot;</span>]</span><br><span class="line">                <span class="keyword">for</span> tool <span class="keyword">in</span> self.available_functions.values()</span><br><span class="line">            ]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Call LLM with function definitions</span></span><br><span class="line">            response = self.client.chat.completions.create(</span><br><span class="line">                model=self.model,</span><br><span class="line">                messages=messages,</span><br><span class="line">                functions=functions,</span><br><span class="line">                function_call=<span class="string">&quot;auto&quot;</span></span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            response_message = response.choices[<span class="number">0</span>].message</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Check if LLM wants to call a function</span></span><br><span class="line">            <span class="keyword">if</span> response_message.function_call:</span><br><span class="line">                <span class="comment"># Extract function name and arguments</span></span><br><span class="line">                function_name = response_message.function_call.name</span><br><span class="line">                function_args = json.loads(response_message.function_call.arguments)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Execute the function</span></span><br><span class="line">                function_to_call = self.available_functions[function_name][<span class="string">&quot;function&quot;</span>]</span><br><span class="line">                function_result = function_to_call(**function_args)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Add function call and result to conversation</span></span><br><span class="line">                messages.append(response_message)</span><br><span class="line">                messages.append(&#123;</span><br><span class="line">                    <span class="string">&quot;role&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: function_name,</span><br><span class="line">                    <span class="string">&quot;content&quot;</span>: json.dumps(function_result)</span><br><span class="line">                &#125;)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># LLM provided final answer</span></span><br><span class="line">                <span class="keyword">return</span> response_message.content</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Max iterations reached&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example tools</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">location: <span class="built_in">str</span>, unit: <span class="built_in">str</span> = <span class="string">&quot;celsius&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Get current weather for a location&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Simulated weather data</span></span><br><span class="line">    weather_data = &#123;</span><br><span class="line">        <span class="string">&quot;Tokyo&quot;</span>: &#123;<span class="string">&quot;temp&quot;</span>: <span class="number">22</span>, <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;Sunny&quot;</span>&#125;,</span><br><span class="line">        <span class="string">&quot;London&quot;</span>: &#123;<span class="string">&quot;temp&quot;</span>: <span class="number">15</span>, <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;Cloudy&quot;</span>&#125;,</span><br><span class="line">        <span class="string">&quot;New York&quot;</span>: &#123;<span class="string">&quot;temp&quot;</span>: <span class="number">18</span>, <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;Rainy&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    data = weather_data.get(location, &#123;<span class="string">&quot;temp&quot;</span>: <span class="number">20</span>, <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;Unknown&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;location&quot;</span>: location,</span><br><span class="line">        <span class="string">&quot;temperature&quot;</span>: data[<span class="string">&quot;temp&quot;</span>],</span><br><span class="line">        <span class="string">&quot;unit&quot;</span>: unit,</span><br><span class="line">        <span class="string">&quot;condition&quot;</span>: data[<span class="string">&quot;condition&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_trip_cost</span>(<span class="params">distance_km: <span class="built_in">float</span>, fuel_price_per_liter: <span class="built_in">float</span>, fuel_efficiency_km_per_liter: <span class="built_in">float</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Calculate fuel cost for a trip&quot;&quot;&quot;</span></span><br><span class="line">    liters_needed = distance_km / fuel_efficiency_km_per_liter</span><br><span class="line">    total_cost = liters_needed * fuel_price_per_liter</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;distance&quot;</span>: distance_km,</span><br><span class="line">        <span class="string">&quot;liters_needed&quot;</span>: <span class="built_in">round</span>(liters_needed, <span class="number">2</span>),</span><br><span class="line">        <span class="string">&quot;total_cost&quot;</span>: <span class="built_in">round</span>(total_cost, <span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register tools with schemas</span></span><br><span class="line">agent = FunctionCallingAgent(api_key=<span class="string">&quot;your-api-key&quot;</span>)</span><br><span class="line"></span><br><span class="line">agent.register_tool(</span><br><span class="line">    get_weather,</span><br><span class="line">    schema=&#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;get_weather&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Get the current weather for a specific location&quot;</span>,</span><br><span class="line">        <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">            <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The city name, e.g., Tokyo, London&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;unit&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;enum&quot;</span>: [<span class="string">&quot;celsius&quot;</span>, <span class="string">&quot;fahrenheit&quot;</span>],</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Temperature unit&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;location&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">agent.register_tool(</span><br><span class="line">    calculate_trip_cost,</span><br><span class="line">    schema=&#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;calculate_trip_cost&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Calculate the fuel cost for a road trip&quot;</span>,</span><br><span class="line">        <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">            <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;distance_km&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Distance in kilometers&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;fuel_price_per_liter&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Price per liter of fuel&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;fuel_efficiency_km_per_liter&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Vehicle&#x27;s fuel efficiency in km per liter&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;distance_km&quot;</span>, <span class="string">&quot;fuel_price_per_liter&quot;</span>, <span class="string">&quot;fuel_efficiency_km_per_liter&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the agent</span></span><br><span class="line">result = agent.run(</span><br><span class="line">    <span class="string">&quot;I&#x27;m planning a 500km trip from Tokyo. The weather looks good. &quot;</span></span><br><span class="line">    <span class="string">&quot;If fuel costs 150 yen per liter and my car does 15 km/liter, &quot;</span></span><br><span class="line">    <span class="string">&quot;how much will the fuel cost?&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Agent will:</span></span><br><span class="line"><span class="comment"># 1. Call get_weather(location=&quot;Tokyo&quot;)</span></span><br><span class="line"><span class="comment"># 2. Call calculate_trip_cost(distance_km=500, fuel_price_per_liter=150, fuel_efficiency_km_per_liter=15)</span></span><br><span class="line"><span class="comment"># 3. Synthesize: &quot;The weather in Tokyo is sunny at 22C. For your 500km trip, you&#x27;ll need approximately 33.33 liters of fuel, costing about 5000 yen.&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="building-custom-tool-executors">Building Custom Tool
Executors</h4>
<p>For more control, implement custom tool execution logic:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Callable</span>, <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ToolType</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    API_CALL = <span class="string">&quot;api_call&quot;</span></span><br><span class="line">    COMPUTATION = <span class="string">&quot;computation&quot;</span></span><br><span class="line">    DATABASE = <span class="string">&quot;database&quot;</span></span><br><span class="line">    FILE_SYSTEM = <span class="string">&quot;file_system&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ToolExecutor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.tools = &#123;&#125;</span><br><span class="line">        self.execution_history = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">self, name: <span class="built_in">str</span>, func: <span class="type">Callable</span>, tool_type: ToolType,</span></span><br><span class="line"><span class="params">                 description: <span class="built_in">str</span>, parameters: <span class="type">Dict</span></span>):</span><br><span class="line">        self.tools[name] = &#123;</span><br><span class="line">            <span class="string">&quot;function&quot;</span>: func,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: tool_type,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: description,</span><br><span class="line">            <span class="string">&quot;parameters&quot;</span>: parameters,</span><br><span class="line">            <span class="string">&quot;call_count&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, tool_name: <span class="built_in">str</span>, **kwargs</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="keyword">if</span> tool_name <span class="keyword">not</span> <span class="keyword">in</span> self.tools:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="string">f&quot;Tool &#x27;<span class="subst">&#123;tool_name&#125;</span>&#x27; not found&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        tool = self.tools[tool_name]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Validate parameters</span></span><br><span class="line">        validation_result = self._validate_parameters(tool[<span class="string">&quot;parameters&quot;</span>], kwargs)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> validation_result[<span class="string">&quot;valid&quot;</span>]:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="string">f&quot;Invalid parameters: <span class="subst">&#123;validation_result[<span class="string">&#x27;errors&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Execute with error handling and logging</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            start_time = datetime.now()</span><br><span class="line">            result = tool[<span class="string">&quot;function&quot;</span>](**kwargs)</span><br><span class="line">            execution_time = (datetime.now() - start_time).total_seconds()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Log execution</span></span><br><span class="line">            self.execution_history.append(&#123;</span><br><span class="line">                <span class="string">&quot;tool&quot;</span>: tool_name,</span><br><span class="line">                <span class="string">&quot;parameters&quot;</span>: kwargs,</span><br><span class="line">                <span class="string">&quot;result&quot;</span>: result,</span><br><span class="line">                <span class="string">&quot;execution_time&quot;</span>: execution_time,</span><br><span class="line">                <span class="string">&quot;timestamp&quot;</span>: start_time</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            tool[<span class="string">&quot;call_count&quot;</span>] += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;result&quot;</span>: result,</span><br><span class="line">                <span class="string">&quot;execution_time&quot;</span>: execution_time</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                <span class="string">&quot;tool&quot;</span>: tool_name,</span><br><span class="line">                <span class="string">&quot;parameters&quot;</span>: kwargs</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_validate_parameters</span>(<span class="params">self, schema: <span class="type">Dict</span>, provided: <span class="type">Dict</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        errors = []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Check required parameters</span></span><br><span class="line">        <span class="keyword">for</span> param_name, param_info <span class="keyword">in</span> schema.items():</span><br><span class="line">            <span class="keyword">if</span> param_info.get(<span class="string">&quot;required&quot;</span>, <span class="literal">False</span>) <span class="keyword">and</span> param_name <span class="keyword">not</span> <span class="keyword">in</span> provided:</span><br><span class="line">                errors.append(<span class="string">f&quot;Missing required parameter: <span class="subst">&#123;param_name&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> param_name <span class="keyword">in</span> provided:</span><br><span class="line">                <span class="comment"># Type validation</span></span><br><span class="line">                expected_type = param_info.get(<span class="string">&quot;type&quot;</span>)</span><br><span class="line">                actual_value = provided[param_name]</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> expected_type == <span class="string">&quot;string&quot;</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(actual_value, <span class="built_in">str</span>):</span><br><span class="line">                    errors.append(<span class="string">f&quot;<span class="subst">&#123;param_name&#125;</span> must be a string&quot;</span>)</span><br><span class="line">                <span class="keyword">elif</span> expected_type == <span class="string">&quot;number&quot;</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(actual_value, (<span class="built_in">int</span>, <span class="built_in">float</span>)):</span><br><span class="line">                    errors.append(<span class="string">f&quot;<span class="subst">&#123;param_name&#125;</span> must be a number&quot;</span>)</span><br><span class="line">                <span class="keyword">elif</span> expected_type == <span class="string">&quot;boolean&quot;</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(actual_value, <span class="built_in">bool</span>):</span><br><span class="line">                    errors.append(<span class="string">f&quot;<span class="subst">&#123;param_name&#125;</span> must be a boolean&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;valid&quot;</span>: <span class="built_in">len</span>(errors) == <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;errors&quot;</span>: errors</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_tool_descriptions</span>(<span class="params">self</span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>]:</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: name,</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: tool[<span class="string">&quot;description&quot;</span>],</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: tool[<span class="string">&quot;type&quot;</span>].value,</span><br><span class="line">                <span class="string">&quot;parameters&quot;</span>: tool[<span class="string">&quot;parameters&quot;</span>],</span><br><span class="line">                <span class="string">&quot;usage_count&quot;</span>: tool[<span class="string">&quot;call_count&quot;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> name, tool <span class="keyword">in</span> self.tools.items()</span><br><span class="line">        ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_execution_stats</span>(<span class="params">self</span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        total_calls = <span class="built_in">len</span>(self.execution_history)</span><br><span class="line">        successful_calls = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> h <span class="keyword">in</span> self.execution_history <span class="keyword">if</span> <span class="string">&quot;error&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> h)</span><br><span class="line">        avg_execution_time = <span class="built_in">sum</span>(h[<span class="string">&quot;execution_time&quot;</span>] <span class="keyword">for</span> h <span class="keyword">in</span> self.execution_history) / <span class="built_in">max</span>(total_calls, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;total_calls&quot;</span>: total_calls,</span><br><span class="line">            <span class="string">&quot;successful_calls&quot;</span>: successful_calls,</span><br><span class="line">            <span class="string">&quot;success_rate&quot;</span>: successful_calls / <span class="built_in">max</span>(total_calls, <span class="number">1</span>),</span><br><span class="line">            <span class="string">&quot;average_execution_time&quot;</span>: avg_execution_time,</span><br><span class="line">            <span class="string">&quot;most_used_tools&quot;</span>: self._get_most_used_tools()</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_most_used_tools</span>(<span class="params">self</span>) -&gt; <span class="type">List</span>[<span class="built_in">tuple</span>]:</span><br><span class="line">        tool_counts = [(name, tool[<span class="string">&quot;call_count&quot;</span>]) <span class="keyword">for</span> name, tool <span class="keyword">in</span> self.tools.items()]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sorted</span>(tool_counts, key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="literal">True</span>)[:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Advanced tool ecosystem</span></span><br><span class="line">executor = ToolExecutor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register computational tools</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prime_factors</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Find prime factors of a number&quot;&quot;&quot;</span></span><br><span class="line">    factors = []</span><br><span class="line">    d = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> d * d &lt;= n:</span><br><span class="line">        <span class="keyword">while</span> n % d == <span class="number">0</span>:</span><br><span class="line">            factors.append(d)</span><br><span class="line">            n //= d</span><br><span class="line">        d += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n &gt; <span class="number">1</span>:</span><br><span class="line">        factors.append(n)</span><br><span class="line">    <span class="keyword">return</span> factors</span><br><span class="line"></span><br><span class="line">executor.register(</span><br><span class="line">    name=<span class="string">&quot;prime_factorization&quot;</span>,</span><br><span class="line">    func=prime_factors,</span><br><span class="line">    tool_type=ToolType.COMPUTATION,</span><br><span class="line">    description=<span class="string">&quot;Finds prime factors of a given number&quot;</span>,</span><br><span class="line">    parameters=&#123;</span><br><span class="line">        <span class="string">&quot;n&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span>, <span class="string">&quot;required&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Number to factorize&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register API tools</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_github_repo</span>(<span class="params">username: <span class="built_in">str</span>, repo_name: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Fetch GitHub repository information&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Simulated API call</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;full_name&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;username&#125;</span>/<span class="subst">&#123;repo_name&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;stars&quot;</span>: <span class="number">1234</span>,</span><br><span class="line">        <span class="string">&quot;forks&quot;</span>: <span class="number">567</span>,</span><br><span class="line">        <span class="string">&quot;language&quot;</span>: <span class="string">&quot;Python&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A sample repository&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">executor.register(</span><br><span class="line">    name=<span class="string">&quot;github_repo_info&quot;</span>,</span><br><span class="line">    func=fetch_github_repo,</span><br><span class="line">    tool_type=ToolType.API_CALL,</span><br><span class="line">    description=<span class="string">&quot;Fetches information about a GitHub repository&quot;</span>,</span><br><span class="line">    parameters=&#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>, <span class="string">&quot;required&quot;</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">        <span class="string">&quot;repo_name&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>, <span class="string">&quot;required&quot;</span>: <span class="literal">True</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use the executor</span></span><br><span class="line">result1 = executor.execute(<span class="string">&quot;prime_factorization&quot;</span>, n=<span class="number">84</span>)</span><br><span class="line"><span class="comment"># Returns: &#123;&quot;success&quot;: True, &quot;result&quot;: [2, 2, 3, 7], &quot;execution_time&quot;: 0.001&#125;</span></span><br><span class="line"></span><br><span class="line">result2 = executor.execute(<span class="string">&quot;github_repo_info&quot;</span>, username=<span class="string">&quot;pytorch&quot;</span>, repo_name=<span class="string">&quot;pytorch&quot;</span>)</span><br><span class="line"><span class="comment"># Returns repository information</span></span><br><span class="line"></span><br><span class="line">stats = executor.get_execution_stats()</span><br><span class="line"><span class="comment"># Returns usage statistics</span></span><br></pre></td></tr></table></figure>
<h3 id="reflection-and-self-improvement">Reflection and
Self-Improvement</h3>
<p>Reflection enables agents to critique their own outputs and
iteratively improve. This meta-cognitive capability is crucial for
handling ambiguous or complex tasks.</p>
<h4 id="reflexionagent-learning-from-mistakes">ReflexionAgent: Learning
from Mistakes</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReflexionAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, tools, max_trials=<span class="number">3</span></span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.tools = tools</span><br><span class="line">        self.max_trials = max_trials</span><br><span class="line">        self.memory = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solve_with_feedback</span>(<span class="params">self, task, success_criteria</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Solve task with self-reflection and retry logic&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> trial <span class="keyword">in</span> <span class="built_in">range</span>(self.max_trials):</span><br><span class="line">            <span class="comment"># Generate solution attempt</span></span><br><span class="line">            attempt = self._generate_attempt(task, trial)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Evaluate attempt</span></span><br><span class="line">            evaluation = self._evaluate_attempt(attempt, success_criteria)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Store in memory</span></span><br><span class="line">            self.memory.append(&#123;</span><br><span class="line">                <span class="string">&quot;trial&quot;</span>: trial + <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;attempt&quot;</span>: attempt,</span><br><span class="line">                <span class="string">&quot;evaluation&quot;</span>: evaluation</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> evaluation[<span class="string">&quot;success&quot;</span>]:</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&quot;solution&quot;</span>: attempt,</span><br><span class="line">                    <span class="string">&quot;trials_needed&quot;</span>: trial + <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&quot;reflection_history&quot;</span>: self.memory</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Generate reflection on failure</span></span><br><span class="line">            reflection = self._reflect_on_failure(task, attempt, evaluation)</span><br><span class="line">            self.memory.append(&#123;</span><br><span class="line">                <span class="string">&quot;trial&quot;</span>: trial + <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;reflection&quot;</span>: reflection</span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;solution&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&quot;trials_needed&quot;</span>: self.max_trials,</span><br><span class="line">            <span class="string">&quot;error&quot;</span>: <span class="string">&quot;Failed to solve after max trials&quot;</span>,</span><br><span class="line">            <span class="string">&quot;reflection_history&quot;</span>: self.memory</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_attempt</span>(<span class="params">self, task, trial_number</span>):</span><br><span class="line">        <span class="keyword">if</span> trial_number == <span class="number">0</span>:</span><br><span class="line">            prompt = <span class="string">f&quot;Solve this task: <span class="subst">&#123;task&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># Include reflections from previous trials</span></span><br><span class="line">            previous_attempts = <span class="string">&quot;\n\n&quot;</span>.join([</span><br><span class="line">                <span class="string">f&quot;Trial <span class="subst">&#123;m[<span class="string">&#x27;trial&#x27;</span>]&#125;</span>:\n&quot;</span></span><br><span class="line">                <span class="string">f&quot;Attempt: <span class="subst">&#123;m.get(<span class="string">&#x27;attempt&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)&#125;</span>\n&quot;</span></span><br><span class="line">                <span class="string">f&quot;Evaluation: <span class="subst">&#123;m.get(<span class="string">&#x27;evaluation&#x27;</span>, &#123;&#125;</span>).get(&#x27;feedback&#x27;, &#x27;N/A&#x27;)&#125;\n&quot;</span></span><br><span class="line">                <span class="string">f&quot;Reflection: <span class="subst">&#123;m.get(<span class="string">&#x27;reflection&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)&#125;</span>&quot;</span></span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> self.memory</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;reflection&#x27;</span> <span class="keyword">in</span> m</span><br><span class="line">            ])</span><br><span class="line">            </span><br><span class="line">            prompt = <span class="string">f&quot;&quot;&quot;Previous attempts and reflections:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;previous_attempts&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Task: <span class="subst">&#123;task&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Based on the reflections above, provide an improved solution:&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.llm.predict(prompt)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_evaluate_attempt</span>(<span class="params">self, attempt, success_criteria</span>):</span><br><span class="line">        eval_prompt = <span class="string">f&quot;&quot;&quot;Evaluate this solution against the criteria:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Solution: <span class="subst">&#123;attempt&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Success Criteria: <span class="subst">&#123;success_criteria&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Provide:</span></span><br><span class="line"><span class="string">1. Does it meet the criteria? (Yes/No)</span></span><br><span class="line"><span class="string">2. What&#x27;s correct about the solution?</span></span><br><span class="line"><span class="string">3. What&#x27;s incorrect or missing?</span></span><br><span class="line"><span class="string">4. Specific feedback for improvement</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Format:</span></span><br><span class="line"><span class="string">Success: [Yes/No]</span></span><br><span class="line"><span class="string">Correct aspects: [...]</span></span><br><span class="line"><span class="string">Issues: [...]</span></span><br><span class="line"><span class="string">Feedback: [...]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        evaluation_text = self.llm.predict(eval_prompt)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Parse evaluation</span></span><br><span class="line">        success = <span class="string">&quot;yes&quot;</span> <span class="keyword">in</span> evaluation_text.lower().split(<span class="string">&quot;success:&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;\n&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;success&quot;</span>: success,</span><br><span class="line">            <span class="string">&quot;feedback&quot;</span>: evaluation_text</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_reflect_on_failure</span>(<span class="params">self, task, failed_attempt, evaluation</span>):</span><br><span class="line">        reflection_prompt = <span class="string">f&quot;&quot;&quot;Reflect on why this solution failed:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Task: <span class="subst">&#123;task&#125;</span></span></span><br><span class="line"><span class="string">Attempted Solution: <span class="subst">&#123;failed_attempt&#125;</span></span></span><br><span class="line"><span class="string">Evaluation: <span class="subst">&#123;evaluation[<span class="string">&#x27;feedback&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Provide a reflection that includes:</span></span><br><span class="line"><span class="string">1. Root cause analysis: Why did this approach fail?</span></span><br><span class="line"><span class="string">2. Key insights: What did we learn?</span></span><br><span class="line"><span class="string">3. Strategy adjustment: What should we try differently?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Keep the reflection concise and actionable.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.llm.predict(reflection_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example usage</span></span><br><span class="line">reflexion_agent = ReflexionAgent(llm, tools=[])</span><br><span class="line"></span><br><span class="line">result = reflexion_agent.solve_with_feedback(</span><br><span class="line">    task=<span class="string">&quot;Write a Python function to merge two sorted linked lists&quot;</span>,</span><br><span class="line">    success_criteria=<span class="string">&quot;Function must handle edge cases (empty lists, lists of different lengths), return a new merged sorted list, and have O(n+m) time complexity&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The agent will:</span></span><br><span class="line"><span class="comment"># Trial 1: Generate initial solution</span></span><br><span class="line"><span class="comment"># If fails: Reflect on why (e.g., &quot;Didn&#x27;t handle empty list case&quot;)</span></span><br><span class="line"><span class="comment"># Trial 2: Generate improved solution incorporating reflection</span></span><br><span class="line"><span class="comment"># If fails: Reflect again (e.g., &quot;Comparison logic was incorrect&quot;)</span></span><br><span class="line"><span class="comment"># Trial 3: Final attempt with all accumulated insights</span></span><br></pre></td></tr></table></figure>
<h2 id="popular-ai-agent-frameworks">Popular AI Agent Frameworks</h2>
<p>Building agents from scratch provides maximum control but requires
significant engineering effort. Several frameworks have emerged to
streamline agent development.</p>
<h3 id="langchain-modular-agent-framework">LangChain: Modular Agent
Framework</h3>
<p>LangChain is the most widely adopted agent framework, offering
composable components for building LLM applications.</p>
<h4 id="basic-langchain-agent">Basic LangChain Agent</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> initialize_agent, AgentType</span><br><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> Tool</span><br><span class="line"><span class="keyword">from</span> langchain.llms <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.utilities <span class="keyword">import</span> SerpAPIWrapper, PythonREPL</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize LLM</span></span><br><span class="line">llm = OpenAI(temperature=<span class="number">0</span>, model=<span class="string">&quot;gpt-4&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define tools</span></span><br><span class="line">search = SerpAPIWrapper()</span><br><span class="line">python_repl = PythonREPL()</span><br><span class="line"></span><br><span class="line">tools = [</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;Search&quot;</span>,</span><br><span class="line">        func=search.run,</span><br><span class="line">        description=<span class="string">&quot;Useful for answering questions about current events or finding recent information. Input should be a search query.&quot;</span></span><br><span class="line">    ),</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;Python_REPL&quot;</span>,</span><br><span class="line">        func=python_repl.run,</span><br><span class="line">        description=<span class="string">&quot;Useful for executing Python code. Input should be valid Python code. Use this for calculations, data processing, or any computational task.&quot;</span></span><br><span class="line">    )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize agent</span></span><br><span class="line">agent = initialize_agent(</span><br><span class="line">    tools=tools,</span><br><span class="line">    llm=llm,</span><br><span class="line">    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,</span><br><span class="line">    verbose=<span class="literal">True</span>,</span><br><span class="line">    max_iterations=<span class="number">5</span>,</span><br><span class="line">    early_stopping_method=<span class="string">&quot;generate&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run agent</span></span><br><span class="line">result = agent.run(</span><br><span class="line">    <span class="string">&quot;What&#x27;s the population of the capital of Japan? &quot;</span></span><br><span class="line">    <span class="string">&quot;Then calculate what 15% of that population would be.&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Agent execution trace:</span></span><br><span class="line"><span class="comment"># Thought: I need to find the capital of Japan and its population</span></span><br><span class="line"><span class="comment"># Action: Search</span></span><br><span class="line"><span class="comment"># Action Input: &quot;capital of Japan population&quot;</span></span><br><span class="line"><span class="comment"># Observation: Tokyo is the capital with ~14 million people</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Thought: Now I need to calculate 15% of 14 million</span></span><br><span class="line"><span class="comment"># Action: Python_REPL</span></span><br><span class="line"><span class="comment"># Action Input: 14_000_000 * 0.15</span></span><br><span class="line"><span class="comment"># Observation: 2100000.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Thought: I now know the final answer</span></span><br><span class="line"><span class="comment"># Final Answer: The population of Tokyo (Japan&#x27;s capital) is approximately 14 million people. 15% of that would be 2.1 million people.</span></span><br></pre></td></tr></table></figure>
<h4 id="custom-langchain-agent-with-memory">Custom LangChain Agent with
Memory</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.agents <span class="keyword">import</span> AgentExecutor, create_structured_chat_agent</span><br><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationBufferMemory</span><br><span class="line"><span class="keyword">from</span> langchain.prompts <span class="keyword">import</span> ChatPromptTemplate, MessagesPlaceholder</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomLangChainAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, tools, model=<span class="string">&quot;gpt-4-turbo&quot;</span></span>):</span><br><span class="line">        self.llm = ChatOpenAI(model=model, temperature=<span class="number">0</span>)</span><br><span class="line">        self.tools = tools</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Initialize memory</span></span><br><span class="line">        self.memory = ConversationBufferMemory(</span><br><span class="line">            memory_key=<span class="string">&quot;chat_history&quot;</span>,</span><br><span class="line">            return_messages=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Create custom prompt</span></span><br><span class="line">        self.prompt = ChatPromptTemplate.from_messages([</span><br><span class="line">            (<span class="string">&quot;system&quot;</span>, <span class="string">&quot;&quot;&quot;You are a helpful AI assistant with access to tools.</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">Available tools:</span></span><br><span class="line"><span class="string">&#123;tools&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tool names: &#123;tool_names&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">When using tools, follow this format:</span></span><br><span class="line"><span class="string">Thought: [reasoning about what to do]</span></span><br><span class="line"><span class="string">Action: [tool name]</span></span><br><span class="line"><span class="string">Action Input: [input for the tool]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">When you have the final answer:</span></span><br><span class="line"><span class="string">Thought: I now know the final answer</span></span><br><span class="line"><span class="string">Final Answer: [your response to the user]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Begin!&quot;&quot;&quot;</span>),</span><br><span class="line">            MessagesPlaceholder(variable_name=<span class="string">&quot;chat_history&quot;</span>),</span><br><span class="line">            (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;&#123;input&#125;&quot;</span>),</span><br><span class="line">            MessagesPlaceholder(variable_name=<span class="string">&quot;agent_scratchpad&quot;</span>)</span><br><span class="line">        ])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Create agent</span></span><br><span class="line">        agent = create_structured_chat_agent(</span><br><span class="line">            llm=self.llm,</span><br><span class="line">            tools=self.tools,</span><br><span class="line">            prompt=self.prompt</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Create agent executor</span></span><br><span class="line">        self.agent_executor = AgentExecutor(</span><br><span class="line">            agent=agent,</span><br><span class="line">            tools=self.tools,</span><br><span class="line">            memory=self.memory,</span><br><span class="line">            verbose=<span class="literal">True</span>,</span><br><span class="line">            max_iterations=<span class="number">10</span>,</span><br><span class="line">            handle_parsing_errors=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, query</span>):</span><br><span class="line">        <span class="keyword">return</span> self.agent_executor.invoke(&#123;<span class="string">&quot;input&quot;</span>: query&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clear_memory</span>(<span class="params">self</span>):</span><br><span class="line">        self.memory.clear()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Building a research agent</span></span><br><span class="line"><span class="keyword">from</span> langchain.tools <span class="keyword">import</span> WikipediaQueryRun</span><br><span class="line"><span class="keyword">from</span> langchain.utilities <span class="keyword">import</span> WikipediaAPIWrapper</span><br><span class="line"></span><br><span class="line">wikipedia = WikipediaQueryRun(api_wrapper=WikipediaAPIWrapper())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">summarize_text</span>(<span class="params">text: <span class="built_in">str</span>, max_length: <span class="built_in">int</span> = <span class="number">100</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Summarize text to specified length&quot;&quot;&quot;</span></span><br><span class="line">    words = text.split()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(words) &lt;= max_length:</span><br><span class="line">        <span class="keyword">return</span> text</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; &quot;</span>.join(words[:max_length]) + <span class="string">&quot;...&quot;</span></span><br><span class="line"></span><br><span class="line">tools = [</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;Wikipedia&quot;</span>,</span><br><span class="line">        func=wikipedia.run,</span><br><span class="line">        description=<span class="string">&quot;Search Wikipedia for information about people, places, concepts, historical events, etc.&quot;</span></span><br><span class="line">    ),</span><br><span class="line">    Tool(</span><br><span class="line">        name=<span class="string">&quot;Summarize&quot;</span>,</span><br><span class="line">        func=summarize_text,</span><br><span class="line">        description=<span class="string">&quot;Summarizes long text into a shorter version. Input: text to summarize.&quot;</span></span><br><span class="line">    )</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">research_agent = CustomLangChainAgent(tools)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Multi-turn conversation with memory</span></span><br><span class="line">response1 = research_agent.run(<span class="string">&quot;Who invented the telephone?&quot;</span>)</span><br><span class="line">response2 = research_agent.run(<span class="string">&quot;What year did that happen?&quot;</span>)  <span class="comment"># Uses memory of previous context</span></span><br><span class="line">response3 = research_agent.run(<span class="string">&quot;Summarize his biography in 50 words&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="autogpt-autonomous-task-execution">AutoGPT: Autonomous Task
Execution</h3>
<p>AutoGPT represents a different paradigm: fully autonomous agents that
pursue goals with minimal human intervention.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AutoGPTAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, tools, workspace_dir=<span class="string">&quot;./agent_workspace&quot;</span></span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.tools = &#123;tool.name: tool <span class="keyword">for</span> tool <span class="keyword">in</span> tools&#125;</span><br><span class="line">        self.workspace_dir = workspace_dir</span><br><span class="line">        self.memory = []</span><br><span class="line">        self.goals = []</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_goals</span>(<span class="params">self, goals: <span class="type">List</span>[<span class="built_in">str</span>]</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Set high-level goals for the agent&quot;&quot;&quot;</span></span><br><span class="line">        self.goals = goals</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_autonomous</span>(<span class="params">self, max_iterations=<span class="number">20</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Run autonomously until goals are achieved or max iterations reached&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> iteration <span class="keyword">in</span> <span class="built_in">range</span>(max_iterations):</span><br><span class="line">            <span class="comment"># Assess current state</span></span><br><span class="line">            status = self._assess_progress()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> status[<span class="string">&quot;goals_achieved&quot;</span>]:</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                    <span class="string">&quot;iterations&quot;</span>: iteration + <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&quot;final_state&quot;</span>: status</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Generate next action plan</span></span><br><span class="line">            action_plan = self._generate_action_plan(status)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Execute actions</span></span><br><span class="line">            <span class="keyword">for</span> action <span class="keyword">in</span> action_plan[<span class="string">&quot;actions&quot;</span>]:</span><br><span class="line">                result = self._execute_action(action)</span><br><span class="line">                self.memory.append(&#123;</span><br><span class="line">                    <span class="string">&quot;iteration&quot;</span>: iteration + <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&quot;action&quot;</span>: action,</span><br><span class="line">                    <span class="string">&quot;result&quot;</span>: result</span><br><span class="line">                &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Self-reflection</span></span><br><span class="line">            reflection = self._reflect_on_progress()</span><br><span class="line">            self.memory.append(&#123;</span><br><span class="line">                <span class="string">&quot;iteration&quot;</span>: iteration + <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;reflection&quot;</span>,</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: reflection</span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">&quot;iterations&quot;</span>: max_iterations,</span><br><span class="line">            <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Max iterations reached without achieving all goals&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_assess_progress</span>(<span class="params">self</span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Assess progress towards goals&quot;&quot;&quot;</span></span><br><span class="line">        assessment_prompt = <span class="string">f&quot;&quot;&quot;Current goals:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;json.dumps(self.goals, indent=<span class="number">2</span>)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Memory of recent actions:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;json.dumps(self.memory[-<span class="number">5</span>:], indent=<span class="number">2</span>)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Assess:</span></span><br><span class="line"><span class="string">1. Which goals have been achieved?</span></span><br><span class="line"><span class="string">2. Which goals are in progress?</span></span><br><span class="line"><span class="string">3. Which goals haven&#x27;t been started?</span></span><br><span class="line"><span class="string">4. What obstacles have been encountered?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Provide assessment as JSON:</span></span><br><span class="line"><span class="string">&#123;&#123;</span></span><br><span class="line"><span class="string">  &quot;goals_achieved&quot;: boolean,</span></span><br><span class="line"><span class="string">  &quot;completed_goals&quot;: [goal indices],</span></span><br><span class="line"><span class="string">  &quot;in_progress&quot;: [goal indices],</span></span><br><span class="line"><span class="string">  &quot;not_started&quot;: [goal indices],</span></span><br><span class="line"><span class="string">  &quot;obstacles&quot;: [list of obstacles]</span></span><br><span class="line"><span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(assessment_prompt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> json.loads(response)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;goals_achieved&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;completed_goals&quot;</span>: []&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_action_plan</span>(<span class="params">self, current_status: <span class="type">Dict</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Generate next actions based on current status&quot;&quot;&quot;</span></span><br><span class="line">        planning_prompt = <span class="string">f&quot;&quot;&quot;You are an autonomous agent working towards these goals:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;json.dumps(self.goals, indent=<span class="number">2</span>)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Current status:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;json.dumps(current_status, indent=<span class="number">2</span>)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Available tools: <span class="subst">&#123;<span class="built_in">list</span>(self.tools.keys())&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Generate a plan for the next 1-3 actions that will make progress towards the goals.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Format as JSON:</span></span><br><span class="line"><span class="string">&#123;&#123;</span></span><br><span class="line"><span class="string">  &quot;reasoning&quot;: &quot;Why these actions?&quot;,</span></span><br><span class="line"><span class="string">  &quot;actions&quot;: [</span></span><br><span class="line"><span class="string">    &#123;&#123;</span></span><br><span class="line"><span class="string">      &quot;tool&quot;: &quot;tool_name&quot;,</span></span><br><span class="line"><span class="string">      &quot;input&quot;: &#123;&#123;&#125;&#125;,</span></span><br><span class="line"><span class="string">      &quot;expected_outcome&quot;: &quot;what should happen&quot;</span></span><br><span class="line"><span class="string">    &#125;&#125;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(planning_prompt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> json.loads(response)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;reasoning&quot;</span>: <span class="string">&quot;Parse error&quot;</span>, <span class="string">&quot;actions&quot;</span>: []&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_execute_action</span>(<span class="params">self, action: <span class="type">Dict</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Execute a single action&quot;&quot;&quot;</span></span><br><span class="line">        tool_name = action.get(<span class="string">&quot;tool&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> tool_name <span class="keyword">not</span> <span class="keyword">in</span> self.tools:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;success&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;error&quot;</span>: <span class="string">f&quot;Tool <span class="subst">&#123;tool_name&#125;</span> not found&quot;</span>&#125;</span><br><span class="line">        </span><br><span class="line">        tool = self.tools[tool_name]</span><br><span class="line">        tool_input = action.get(<span class="string">&quot;input&quot;</span>, &#123;&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> tool.execute(**tool_input)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_reflect_on_progress</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Reflect on recent progress&quot;&quot;&quot;</span></span><br><span class="line">        reflection_prompt = <span class="string">f&quot;&quot;&quot;Recent actions and results:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;json.dumps(self.memory[-<span class="number">3</span>:], indent=<span class="number">2</span>)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Goals:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;json.dumps(self.goals, indent=<span class="number">2</span>)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reflect:</span></span><br><span class="line"><span class="string">1. Are we making good progress?</span></span><br><span class="line"><span class="string">2. Should we change our strategy?</span></span><br><span class="line"><span class="string">3. What should be prioritized next?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Provide a brief reflection (2-3 sentences):</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.llm.predict(reflection_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Autonomous research and summary agent</span></span><br><span class="line">auto_agent = AutoGPTAgent(llm, tools=[</span><br><span class="line">    wikipedia_tool,</span><br><span class="line">    file_writer_tool,</span><br><span class="line">    summarizer_tool</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">auto_agent.set_goals([</span><br><span class="line">    <span class="string">&quot;Research the history of artificial intelligence&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Create a timeline of major AI breakthroughs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Write a summary report and save it to a file&quot;</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">result = auto_agent.run_autonomous(max_iterations=<span class="number">15</span>)</span><br><span class="line"><span class="comment"># Agent will autonomously:</span></span><br><span class="line"><span class="comment"># 1. Search Wikipedia for AI history</span></span><br><span class="line"><span class="comment"># 2. Extract key dates and events</span></span><br><span class="line"><span class="comment"># 3. Organize into timeline format</span></span><br><span class="line"><span class="comment"># 4. Generate summary report</span></span><br><span class="line"><span class="comment"># 5. Save to file</span></span><br><span class="line"><span class="comment"># All without human intervention between steps</span></span><br></pre></td></tr></table></figure>
<h3 id="babyagi-task-driven-autonomous-agent">BabyAGI: Task-Driven
Autonomous Agent</h3>
<p>BabyAGI implements a task management system where the agent
generates, prioritizes, and executes tasks.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BabyAGIAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, tools, objective</span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.tools = &#123;tool.name: tool <span class="keyword">for</span> tool <span class="keyword">in</span> tools&#125;</span><br><span class="line">        self.objective = objective</span><br><span class="line">        self.task_queue = deque()</span><br><span class="line">        self.completed_tasks = []</span><br><span class="line">        self.task_id_counter = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, max_iterations=<span class="number">10</span></span>):</span><br><span class="line">        <span class="comment"># Create initial task</span></span><br><span class="line">        self.task_queue.append(&#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: self.task_id_counter,</span><br><span class="line">            <span class="string">&quot;task&quot;</span>: <span class="string">f&quot;Develop a plan to achieve: <span class="subst">&#123;self.objective&#125;</span>&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        self.task_id_counter += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        iteration = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> self.task_queue <span class="keyword">and</span> iteration &lt; max_iterations:</span><br><span class="line">            <span class="comment"># Get next task</span></span><br><span class="line">            current_task = self.task_queue.popleft()</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span>*<span class="number">50</span>&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Executing Task <span class="subst">&#123;current_task[<span class="string">&#x27;id&#x27;</span>]&#125;</span>: <span class="subst">&#123;current_task[<span class="string">&#x27;task&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;=&#x27;</span>*<span class="number">50</span>&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Execute task</span></span><br><span class="line">            result = self._execute_task(current_task)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Store result</span></span><br><span class="line">            self.completed_tasks.append(&#123;</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: current_task[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">                <span class="string">&quot;task&quot;</span>: current_task[<span class="string">&quot;task&quot;</span>],</span><br><span class="line">                <span class="string">&quot;result&quot;</span>: result</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Generate new tasks based on result</span></span><br><span class="line">            new_tasks = self._generate_new_tasks(current_task, result)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Prioritize and add new tasks</span></span><br><span class="line">            prioritized_tasks = self._prioritize_tasks(new_tasks)</span><br><span class="line">            <span class="keyword">for</span> task <span class="keyword">in</span> prioritized_tasks:</span><br><span class="line">                task[<span class="string">&quot;id&quot;</span>] = self.task_id_counter</span><br><span class="line">                self.task_id_counter += <span class="number">1</span></span><br><span class="line">                self.task_queue.append(task)</span><br><span class="line">            </span><br><span class="line">            iteration += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;objective&quot;</span>: self.objective,</span><br><span class="line">            <span class="string">&quot;completed_tasks&quot;</span>: self.completed_tasks,</span><br><span class="line">            <span class="string">&quot;remaining_tasks&quot;</span>: <span class="built_in">list</span>(self.task_queue)</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_execute_task</span>(<span class="params">self, task: <span class="type">Dict</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Execute a single task&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># Build context from completed tasks</span></span><br><span class="line">        context = <span class="string">&quot;\n&quot;</span>.join([</span><br><span class="line">            <span class="string">f&quot;Task <span class="subst">&#123;t[<span class="string">&#x27;id&#x27;</span>]&#125;</span>: <span class="subst">&#123;t[<span class="string">&#x27;task&#x27;</span>]&#125;</span>\nResult: <span class="subst">&#123;t[<span class="string">&#x27;result&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> self.completed_tasks[-<span class="number">5</span>:]  <span class="comment"># Last 5 tasks</span></span><br><span class="line">        ])</span><br><span class="line">        </span><br><span class="line">        execution_prompt = <span class="string">f&quot;&quot;&quot;You are an AI agent working towards this objective:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;self.objective&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Previously completed tasks:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;context&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Current task: <span class="subst">&#123;task[<span class="string">&#x27;task&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Available tools: <span class="subst">&#123;<span class="built_in">list</span>(self.tools.keys())&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Execute this task and provide the result. If you need to use a tool, specify:</span></span><br><span class="line"><span class="string">Tool: [tool_name]</span></span><br><span class="line"><span class="string">Input: [tool_input]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Otherwise, provide your response directly.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(execution_prompt)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Check if tool use is requested</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Tool:&quot;</span> <span class="keyword">in</span> response:</span><br><span class="line">            tool_name = re.search(<span class="string">r&quot;Tool: (\w+)&quot;</span>, response).group(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> tool_name <span class="keyword">in</span> self.tools:</span><br><span class="line">                <span class="comment"># Extract tool input (simplified parsing)</span></span><br><span class="line">                input_match = re.search(<span class="string">r&quot;Input: (.+?)(?:\n|$)&quot;</span>, response, re.DOTALL)</span><br><span class="line">                tool_input = input_match.group(<span class="number">1</span>).strip() <span class="keyword">if</span> input_match <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                </span><br><span class="line">                tool_result = self.tools[tool_name].execute(query=tool_input)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;Tool Result: <span class="subst">&#123;tool_result&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_new_tasks</span>(<span class="params">self, completed_task: <span class="type">Dict</span>, result: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Generate new tasks based on completed task result&quot;&quot;&quot;</span></span><br><span class="line">        generation_prompt = <span class="string">f&quot;&quot;&quot;Objective: <span class="subst">&#123;self.objective&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Last completed task:</span></span><br><span class="line"><span class="string">Task: <span class="subst">&#123;completed_task[<span class="string">&#x27;task&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">Result: <span class="subst">&#123;result&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Based on this result, generate a list of new tasks needed to continue progress towards the objective.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Requirements:</span></span><br><span class="line"><span class="string">- Each task should be specific and actionable</span></span><br><span class="line"><span class="string">- Tasks should build on the completed work</span></span><br><span class="line"><span class="string">- Avoid redundancy with these completed tasks: <span class="subst">&#123;[t[<span class="string">&#x27;task&#x27;</span>] <span class="keyword">for</span> t <span class="keyword">in</span> self.completed_tasks]&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Provide tasks in this format:</span></span><br><span class="line"><span class="string">1. [First new task]</span></span><br><span class="line"><span class="string">2. [Second new task]</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(generation_prompt)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Parse numbered tasks</span></span><br><span class="line">        tasks = []</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> response.split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;^\d+\.\s*(.+)$&#x27;</span>, line.strip())</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                tasks.append(&#123;<span class="string">&quot;task&quot;</span>: <span class="keyword">match</span>.group(<span class="number">1</span>)&#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> tasks</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_prioritize_tasks</span>(<span class="params">self, tasks: <span class="type">List</span>[<span class="type">Dict</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Prioritize tasks based on objective&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> tasks:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        </span><br><span class="line">        tasks_str = <span class="string">&quot;\n&quot;</span>.join([<span class="string">f&quot;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>. <span class="subst">&#123;t[<span class="string">&#x27;task&#x27;</span>]&#125;</span>&quot;</span> <span class="keyword">for</span> i, t <span class="keyword">in</span> <span class="built_in">enumerate</span>(tasks)])</span><br><span class="line">        </span><br><span class="line">        prioritization_prompt = <span class="string">f&quot;&quot;&quot;Objective: <span class="subst">&#123;self.objective&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Tasks to prioritize:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;tasks_str&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Reorder these tasks by priority (most important first) considering:</span></span><br><span class="line"><span class="string">- Which tasks must be completed before others</span></span><br><span class="line"><span class="string">- Which tasks contribute most directly to the objective</span></span><br><span class="line"><span class="string">- Task dependencies</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Provide the reordered list with numbers:</span></span><br><span class="line"><span class="string">1. [Most important task]</span></span><br><span class="line"><span class="string">2. [Second most important]</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(prioritization_prompt)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Parse prioritized tasks</span></span><br><span class="line">        prioritized = []</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> response.split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;^\d+\.\s*(.+)$&#x27;</span>, line.strip())</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                task_text = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">                <span class="comment"># Find matching task from original list</span></span><br><span class="line">                <span class="keyword">for</span> task <span class="keyword">in</span> tasks:</span><br><span class="line">                    <span class="keyword">if</span> task_text.lower() <span class="keyword">in</span> task[<span class="string">&#x27;task&#x27;</span>].lower() <span class="keyword">or</span> task[<span class="string">&#x27;task&#x27;</span>].lower() <span class="keyword">in</span> task_text.lower():</span><br><span class="line">                        prioritized.append(task)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Add any tasks that weren&#x27;t matched</span></span><br><span class="line">        <span class="keyword">for</span> task <span class="keyword">in</span> tasks:</span><br><span class="line">            <span class="keyword">if</span> task <span class="keyword">not</span> <span class="keyword">in</span> prioritized:</span><br><span class="line">                prioritized.append(task)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> prioritized</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Using BabyAGI for complex objective</span></span><br><span class="line">babyagi = BabyAGIAgent(</span><br><span class="line">    llm=llm,</span><br><span class="line">    tools=[search_tool, calculator_tool, file_writer_tool],</span><br><span class="line">    objective=<span class="string">&quot;Research quantum computing and create a beginner-friendly explanation with examples&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">result = babyagi.run(max_iterations=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># BabyAGI execution flow:</span></span><br><span class="line"><span class="comment"># Task 1: Develop plan for quantum computing research</span></span><br><span class="line"><span class="comment">#    Generates: [Research QC basics, Find examples, Create outline]</span></span><br><span class="line"><span class="comment"># Task 2: Research QC basics (prioritized first)</span></span><br><span class="line"><span class="comment">#    Generates: [Research qubits, Research superposition, Research entanglement]</span></span><br><span class="line"><span class="comment"># Task 3: Research qubits</span></span><br><span class="line"><span class="comment">#    Result: Explanation of qubits</span></span><br><span class="line"><span class="comment"># Task 4: Research superposition</span></span><br><span class="line"><span class="comment">#    Result: Explanation of superposition</span></span><br><span class="line"><span class="comment"># ... continues until objective is achieved</span></span><br></pre></td></tr></table></figure>
<h2 id="multi-agent-systems">Multi-Agent Systems</h2>
<p>Single agents have limitations in handling complex, multi-faceted
problems. Multi-agent systems distribute work across specialized agents
that collaborate towards common goals.</p>
<h3 id="agent-collaboration-patterns">Agent Collaboration Patterns</h3>
<h4 id="hierarchical-organization">Hierarchical Organization</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ManagerAgent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Manages and delegates to worker agents&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, worker_agents: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="string">&#x27;WorkerAgent&#x27;</span>]</span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.workers = worker_agents</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_complex_task</span>(<span class="params">self, task: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="comment"># Decompose task into subtasks</span></span><br><span class="line">        subtasks = self._decompose_task(task)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Assign subtasks to appropriate workers</span></span><br><span class="line">        assignments = self._assign_tasks(subtasks)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Collect results from workers</span></span><br><span class="line">        results = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> worker_name, assigned_tasks <span class="keyword">in</span> assignments.items():</span><br><span class="line">            worker = self.workers[worker_name]</span><br><span class="line">            results[worker_name] = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> subtask <span class="keyword">in</span> assigned_tasks:</span><br><span class="line">                result = worker.execute(subtask)</span><br><span class="line">                results[worker_name].append(result)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Synthesize final result</span></span><br><span class="line">        final_result = self._synthesize_results(task, results)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> final_result</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_decompose_task</span>(<span class="params">self, task: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>]:</span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;Decompose this complex task into subtasks:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;task&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Available worker agents and their capabilities:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;self._get_worker_capabilities()&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Create a list of subtasks, each specifying:</span></span><br><span class="line"><span class="string">- Description of subtask</span></span><br><span class="line"><span class="string">- Which worker agent should handle it</span></span><br><span class="line"><span class="string">- Any dependencies on other subtasks</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Format as JSON array.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        response = self.llm.predict(prompt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> json.loads(response)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_worker_capabilities</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join([</span><br><span class="line">            <span class="string">f&quot;- <span class="subst">&#123;name&#125;</span>: <span class="subst">&#123;worker.capabilities&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">for</span> name, worker <span class="keyword">in</span> self.workers.items()</span><br><span class="line">        ])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_assign_tasks</span>(<span class="params">self, subtasks: <span class="type">List</span>[<span class="type">Dict</span>]</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">List</span>]:</span><br><span class="line">        assignments = &#123;name: [] <span class="keyword">for</span> name <span class="keyword">in</span> self.workers.keys()&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> subtask <span class="keyword">in</span> subtasks:</span><br><span class="line">            agent_name = subtask.get(<span class="string">&quot;assigned_to&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> agent_name <span class="keyword">in</span> assignments:</span><br><span class="line">                assignments[agent_name].append(subtask[<span class="string">&quot;description&quot;</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> assignments</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_synthesize_results</span>(<span class="params">self, original_task: <span class="built_in">str</span>, results: <span class="type">Dict</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        results_summary = json.dumps(results, indent=<span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        synthesis_prompt = <span class="string">f&quot;&quot;&quot;Original task: <span class="subst">&#123;original_task&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Results from worker agents:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;results_summary&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Synthesize these results into a cohesive final answer that addresses the original task.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        final_answer = self.llm.predict(synthesis_prompt)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;task&quot;</span>: original_task,</span><br><span class="line">            <span class="string">&quot;worker_results&quot;</span>: results,</span><br><span class="line">            <span class="string">&quot;final_answer&quot;</span>: final_answer</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WorkerAgent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Specialized agent for specific tasks&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name: <span class="built_in">str</span>, capabilities: <span class="built_in">str</span>, llm, tools</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.capabilities = capabilities</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.tools = tools</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, task: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;You are <span class="subst">&#123;self.name&#125;</span>, specialized in: <span class="subst">&#123;self.capabilities&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Task: <span class="subst">&#123;task&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Execute this task using your capabilities and available tools: <span class="subst">&#123;[t.name <span class="keyword">for</span> t <span class="keyword">in</span> self.tools]&#125;</span></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        result = self.llm.predict(prompt)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;agent&quot;</span>: self.name,</span><br><span class="line">            <span class="string">&quot;task&quot;</span>: task,</span><br><span class="line">            <span class="string">&quot;result&quot;</span>: result</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Building a research team</span></span><br><span class="line">research_agent = WorkerAgent(</span><br><span class="line">    name=<span class="string">&quot;ResearchAgent&quot;</span>,</span><br><span class="line">    capabilities=<span class="string">&quot;Searching for information, fact-checking, gathering data from multiple sources&quot;</span>,</span><br><span class="line">    llm=llm,</span><br><span class="line">    tools=[search_tool, wikipedia_tool]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">analysis_agent = WorkerAgent(</span><br><span class="line">    name=<span class="string">&quot;AnalysisAgent&quot;</span>,</span><br><span class="line">    capabilities=<span class="string">&quot;Data analysis, statistical computation, pattern recognition&quot;</span>,</span><br><span class="line">    llm=llm,</span><br><span class="line">    tools=[calculator_tool, data_analysis_tool]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">writing_agent = WorkerAgent(</span><br><span class="line">    name=<span class="string">&quot;WritingAgent&quot;</span>,</span><br><span class="line">    capabilities=<span class="string">&quot;Creating well-structured documents, reports, and summaries&quot;</span>,</span><br><span class="line">    llm=llm,</span><br><span class="line">    tools=[file_writer_tool, summarizer_tool]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">manager = ManagerAgent(</span><br><span class="line">    llm=llm,</span><br><span class="line">    worker_agents=&#123;</span><br><span class="line">        <span class="string">&quot;researcher&quot;</span>: research_agent,</span><br><span class="line">        <span class="string">&quot;analyst&quot;</span>: analysis_agent,</span><br><span class="line">        <span class="string">&quot;writer&quot;</span>: writing_agent</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Execute complex task</span></span><br><span class="line">result = manager.execute_complex_task(</span><br><span class="line">    <span class="string">&quot;Create a comprehensive report on global electric vehicle adoption rates, &quot;</span></span><br><span class="line">    <span class="string">&quot;including market analysis, growth trends, and future projections.&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Manager will:</span></span><br><span class="line"><span class="comment"># 1. Assign research task to ResearchAgent</span></span><br><span class="line"><span class="comment"># 2. Assign analysis task to AnalysisAgent  </span></span><br><span class="line"><span class="comment"># 3. Assign writing task to WritingAgent</span></span><br><span class="line"><span class="comment"># 4. Synthesize all results into final report</span></span><br></pre></td></tr></table></figure>
<h4 id="debate-and-consensus">Debate and Consensus</h4>
<p>Multiple agents debate different perspectives to reach better
solutions:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DebateSystem</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, num_agents=<span class="number">3</span>, rounds=<span class="number">2</span></span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.num_agents = num_agents</span><br><span class="line">        self.rounds = rounds</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solve_by_debate</span>(<span class="params">self, problem: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="comment"># Initialize agents with different perspectives</span></span><br><span class="line">        agents = [</span><br><span class="line">            &#123;<span class="string">&quot;id&quot;</span>: i, <span class="string">&quot;stance&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;arguments&quot;</span>: []&#125;</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.num_agents)</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        debate_history = []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Initial round: each agent proposes solution</span></span><br><span class="line">        <span class="keyword">for</span> agent <span class="keyword">in</span> agents:</span><br><span class="line">            solution = self._generate_solution(problem, agent, [])</span><br><span class="line">            agent[<span class="string">&quot;stance&quot;</span>] = solution</span><br><span class="line">            agent[<span class="string">&quot;arguments&quot;</span>].append(solution)</span><br><span class="line">            debate_history.append(&#123;</span><br><span class="line">                <span class="string">&quot;round&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">&quot;agent&quot;</span>: agent[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: solution</span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Debate rounds</span></span><br><span class="line">        <span class="keyword">for</span> round_num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, self.rounds + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> agent <span class="keyword">in</span> agents:</span><br><span class="line">                <span class="comment"># Agent reads other agents&#x27; arguments</span></span><br><span class="line">                other_arguments = [</span><br><span class="line">                    a[<span class="string">&quot;arguments&quot;</span>][-<span class="number">1</span>]</span><br><span class="line">                    <span class="keyword">for</span> a <span class="keyword">in</span> agents</span><br><span class="line">                    <span class="keyword">if</span> a[<span class="string">&quot;id&quot;</span>] != agent[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">                ]</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Generate response</span></span><br><span class="line">                response = self._generate_response(</span><br><span class="line">                    problem, agent, other_arguments, round_num</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                agent[<span class="string">&quot;arguments&quot;</span>].append(response)</span><br><span class="line">                debate_history.append(&#123;</span><br><span class="line">                    <span class="string">&quot;round&quot;</span>: round_num,</span><br><span class="line">                    <span class="string">&quot;agent&quot;</span>: agent[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">                    <span class="string">&quot;content&quot;</span>: response</span><br><span class="line">                &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Final consensus</span></span><br><span class="line">        consensus = self._reach_consensus(problem, agents)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;problem&quot;</span>: problem,</span><br><span class="line">            <span class="string">&quot;debate_history&quot;</span>: debate_history,</span><br><span class="line">            <span class="string">&quot;final_consensus&quot;</span>: consensus,</span><br><span class="line">            <span class="string">&quot;agent_final_stances&quot;</span>: [a[<span class="string">&quot;arguments&quot;</span>][-<span class="number">1</span>] <span class="keyword">for</span> a <span class="keyword">in</span> agents]</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_solution</span>(<span class="params">self, problem: <span class="built_in">str</span>, agent: <span class="type">Dict</span>, context: <span class="type">List</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;You are Agent <span class="subst">&#123;agent[<span class="string">&#x27;id&#x27;</span>]&#125;</span> in a debate to solve this problem:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;problem&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Propose your initial solution. Be specific and provide reasoning.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.llm.predict(prompt)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_response</span>(<span class="params">self, problem: <span class="built_in">str</span>, agent: <span class="type">Dict</span>, </span></span><br><span class="line"><span class="params">                          other_arguments: <span class="type">List</span>[<span class="built_in">str</span>], round_num: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        others_text = <span class="string">&quot;\n\n&quot;</span>.join([</span><br><span class="line">            <span class="string">f&quot;Other Agent&#x27;s Argument:\n<span class="subst">&#123;arg&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">for</span> arg <span class="keyword">in</span> other_arguments</span><br><span class="line">        ])</span><br><span class="line">        </span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;You are Agent <span class="subst">&#123;agent[<span class="string">&#x27;id&#x27;</span>]&#125;</span> in round <span class="subst">&#123;round_num&#125;</span> of a debate.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Problem: <span class="subst">&#123;problem&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your previous stance: <span class="subst">&#123;agent[<span class="string">&#x27;arguments&#x27;</span>][-<span class="number">1</span>]&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Other agents&#x27; arguments:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;others_text&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Respond by:</span></span><br><span class="line"><span class="string">1. Addressing criticisms of your approach</span></span><br><span class="line"><span class="string">2. Pointing out flaws in other approaches</span></span><br><span class="line"><span class="string">3. Refining your solution based on the discussion</span></span><br><span class="line"><span class="string">4. Or, if convinced, adopting a better solution</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Provide your updated stance:</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.llm.predict(prompt)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_reach_consensus</span>(<span class="params">self, problem: <span class="built_in">str</span>, agents: <span class="type">List</span>[<span class="type">Dict</span>]</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        all_arguments = <span class="string">&quot;\n\n&quot;</span>.join([</span><br><span class="line">            <span class="string">f&quot;Agent <span class="subst">&#123;agent[<span class="string">&#x27;id&#x27;</span>]&#125;</span> Final Stance:\n<span class="subst">&#123;agent[<span class="string">&#x27;arguments&#x27;</span>][-<span class="number">1</span>]&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">for</span> agent <span class="keyword">in</span> agents</span><br><span class="line">        ])</span><br><span class="line">        </span><br><span class="line">        consensus_prompt = <span class="string">f&quot;&quot;&quot;After debate, these agents proposed solutions to: <span class="subst">&#123;problem&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">&#123;all_arguments&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Synthesize the best elements from all arguments into a final consensus solution.</span></span><br><span class="line"><span class="string">Explain which ideas from each agent were incorporated and why.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.llm.predict(consensus_prompt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Using debate for problem solving</span></span><br><span class="line">debate_system = DebateSystem(llm, num_agents=<span class="number">3</span>, rounds=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">result = debate_system.solve_by_debate(</span><br><span class="line">    <span class="string">&quot;Design a recommendation system for an e-commerce platform that balances &quot;</span></span><br><span class="line">    <span class="string">&quot;accuracy, diversity, and business goals (conversion rate)&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output includes:</span></span><br><span class="line"><span class="comment"># - Round 0: Agent 0 proposes collaborative filtering</span></span><br><span class="line"><span class="comment">#           Agent 1 proposes content-based filtering</span></span><br><span class="line"><span class="comment">#           Agent 2 proposes hybrid approach</span></span><br><span class="line"><span class="comment"># - Round 1: Agents critique each other and refine</span></span><br><span class="line"><span class="comment"># - Round 2: Further refinement based on critiques</span></span><br><span class="line"><span class="comment"># - Final consensus: Synthesized best solution</span></span><br></pre></td></tr></table></figure>
<h3 id="communication-protocols">Communication Protocols</h3>
<p>Agents need structured communication to coordinate effectively:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MessageType</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    REQUEST = <span class="string">&quot;request&quot;</span></span><br><span class="line">    RESPONSE = <span class="string">&quot;response&quot;</span></span><br><span class="line">    BROADCAST = <span class="string">&quot;broadcast&quot;</span></span><br><span class="line">    QUERY = <span class="string">&quot;query&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>:</span><br><span class="line">    sender: <span class="built_in">str</span></span><br><span class="line">    recipient: <span class="built_in">str</span></span><br><span class="line">    msg_type: MessageType</span><br><span class="line">    content: <span class="built_in">str</span></span><br><span class="line">    context: <span class="type">Optional</span>[<span class="type">Dict</span>] = <span class="literal">None</span></span><br><span class="line">    requires_response: <span class="built_in">bool</span> = <span class="literal">False</span></span><br><span class="line">    conversation_id: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MessageBus</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Central message routing system for multi-agent communication&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.messages = []</span><br><span class="line">        self.agents = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_agent</span>(<span class="params">self, agent_id: <span class="built_in">str</span>, agent</span>):</span><br><span class="line">        self.agents[agent_id] = agent</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_message</span>(<span class="params">self, message: Message</span>):</span><br><span class="line">        self.messages.append(message)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Route message</span></span><br><span class="line">        <span class="keyword">if</span> message.recipient == <span class="string">&quot;broadcast&quot;</span>:</span><br><span class="line">            <span class="comment"># Send to all agents except sender</span></span><br><span class="line">            <span class="keyword">for</span> agent_id, agent <span class="keyword">in</span> self.agents.items():</span><br><span class="line">                <span class="keyword">if</span> agent_id != message.sender:</span><br><span class="line">                    agent.receive_message(message)</span><br><span class="line">        <span class="keyword">elif</span> message.recipient <span class="keyword">in</span> self.agents:</span><br><span class="line">            <span class="comment"># Send to specific agent</span></span><br><span class="line">            self.agents[message.recipient].receive_message(message)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Warning: Recipient <span class="subst">&#123;message.recipient&#125;</span> not found&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_conversation</span>(<span class="params">self, conversation_id: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[Message]:</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            msg <span class="keyword">for</span> msg <span class="keyword">in</span> self.messages</span><br><span class="line">            <span class="keyword">if</span> msg.conversation_id == conversation_id</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommunicativeAgent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Agent with communication capabilities&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, agent_id: <span class="built_in">str</span>, llm, message_bus: MessageBus</span>):</span><br><span class="line">        self.agent_id = agent_id</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.message_bus = message_bus</span><br><span class="line">        self.inbox = []</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Register with message bus</span></span><br><span class="line">        message_bus.register_agent(agent_id, self)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">receive_message</span>(<span class="params">self, message: Message</span>):</span><br><span class="line">        self.inbox.append(message)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Auto-respond if required</span></span><br><span class="line">        <span class="keyword">if</span> message.requires_response:</span><br><span class="line">            response = self._generate_response(message)</span><br><span class="line">            self.send_message(</span><br><span class="line">                recipient=message.sender,</span><br><span class="line">                msg_type=MessageType.RESPONSE,</span><br><span class="line">                content=response,</span><br><span class="line">                conversation_id=message.conversation_id</span><br><span class="line">            )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_message</span>(<span class="params">self, recipient: <span class="built_in">str</span>, msg_type: MessageType, </span></span><br><span class="line"><span class="params">                     content: <span class="built_in">str</span>, conversation_id: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">                     requires_response: <span class="built_in">bool</span> = <span class="literal">False</span></span>):</span><br><span class="line">        message = Message(</span><br><span class="line">            sender=self.agent_id,</span><br><span class="line">            recipient=recipient,</span><br><span class="line">            msg_type=msg_type,</span><br><span class="line">            content=content,</span><br><span class="line">            conversation_id=conversation_id <span class="keyword">or</span> self._generate_conversation_id(),</span><br><span class="line">            requires_response=requires_response</span><br><span class="line">        )</span><br><span class="line">        self.message_bus.send_message(message)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">broadcast</span>(<span class="params">self, content: <span class="built_in">str</span>, conversation_id: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span>):</span><br><span class="line">        self.send_message(</span><br><span class="line">            recipient=<span class="string">&quot;broadcast&quot;</span>,</span><br><span class="line">            msg_type=MessageType.BROADCAST,</span><br><span class="line">            content=content,</span><br><span class="line">            conversation_id=conversation_id</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_response</span>(<span class="params">self, message: Message</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;You are agent <span class="subst">&#123;self.agent_id&#125;</span>.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You received this message:</span></span><br><span class="line"><span class="string">From: <span class="subst">&#123;message.sender&#125;</span></span></span><br><span class="line"><span class="string">Type: <span class="subst">&#123;message.msg_type.value&#125;</span></span></span><br><span class="line"><span class="string">Content: <span class="subst">&#123;message.content&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Generate an appropriate response:</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.llm.predict(prompt)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_conversation_id</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">import</span> uuid</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(uuid.uuid4())[:<span class="number">8</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example: Multi-agent collaboration with messaging</span></span><br><span class="line">message_bus = MessageBus()</span><br><span class="line"></span><br><span class="line">coordinator = CommunicativeAgent(<span class="string">&quot;coordinator&quot;</span>, llm, message_bus)</span><br><span class="line">data_collector = CommunicativeAgent(<span class="string">&quot;data_collector&quot;</span>, llm, message_bus)</span><br><span class="line">analyzer = CommunicativeAgent(<span class="string">&quot;analyzer&quot;</span>, llm, message_bus)</span><br><span class="line">reporter = CommunicativeAgent(<span class="string">&quot;reporter&quot;</span>, llm, message_bus)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Coordinator initiates workflow</span></span><br><span class="line">conversation_id = <span class="string">&quot;proj_001&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 1: Request data collection</span></span><br><span class="line">coordinator.send_message(</span><br><span class="line">    recipient=<span class="string">&quot;data_collector&quot;</span>,</span><br><span class="line">    msg_type=MessageType.REQUEST,</span><br><span class="line">    content=<span class="string">&quot;Collect latest sales data for Q4 2024&quot;</span>,</span><br><span class="line">    conversation_id=conversation_id,</span><br><span class="line">    requires_response=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2: After receiving data, request analysis</span></span><br><span class="line">coordinator.send_message(</span><br><span class="line">    recipient=<span class="string">&quot;analyzer&quot;</span>,</span><br><span class="line">    msg_type=MessageType.REQUEST,</span><br><span class="line">    content=<span class="string">&quot;Analyze sales trends and identify patterns&quot;</span>,</span><br><span class="line">    conversation_id=conversation_id,</span><br><span class="line">    requires_response=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3: Request report generation</span></span><br><span class="line">coordinator.send_message(</span><br><span class="line">    recipient=<span class="string">&quot;reporter&quot;</span>,</span><br><span class="line">    msg_type=MessageType.REQUEST,</span><br><span class="line">    content=<span class="string">&quot;Generate executive summary report&quot;</span>,</span><br><span class="line">    conversation_id=conversation_id,</span><br><span class="line">    requires_response=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Retrieve full conversation</span></span><br><span class="line">conversation = message_bus.get_conversation(conversation_id)</span><br></pre></td></tr></table></figure>
<h2 id="evaluation-and-benchmarking">Evaluation and Benchmarking</h2>
<p>Measuring agent performance is crucial for understanding capabilities
and limitations.</p>
<h3 id="agentbench-comprehensive-agent-evaluation">AgentBench:
Comprehensive Agent Evaluation</h3>
<p>AgentBench evaluates agents across 8 different environments:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AgentBenchmark</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, agent</span>):</span><br><span class="line">        self.agent = agent</span><br><span class="line">        self.results = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_benchmark_suite</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Run comprehensive benchmark tests&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. Operating System Tasks</span></span><br><span class="line">        os_score = self._test_os_tasks()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. Database Queries</span></span><br><span class="line">        db_score = self._test_database_queries()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. Knowledge Graph Navigation</span></span><br><span class="line">        kg_score = self._test_knowledge_graph()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. Web Browsing</span></span><br><span class="line">        web_score = self._test_web_browsing()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 5. Code Generation</span></span><br><span class="line">        code_score = self._test_code_generation()</span><br><span class="line">        </span><br><span class="line">        self.results = &#123;</span><br><span class="line">            <span class="string">&quot;os_tasks&quot;</span>: os_score,</span><br><span class="line">            <span class="string">&quot;database&quot;</span>: db_score,</span><br><span class="line">            <span class="string">&quot;knowledge_graph&quot;</span>: kg_score,</span><br><span class="line">            <span class="string">&quot;web_browsing&quot;</span>: web_score,</span><br><span class="line">            <span class="string">&quot;code_generation&quot;</span>: code_score,</span><br><span class="line">            <span class="string">&quot;overall&quot;</span>: self._calculate_overall_score()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> self.results</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_test_os_tasks</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Test agent&#x27;s ability to perform OS operations&quot;&quot;&quot;</span></span><br><span class="line">        tasks = [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;task&quot;</span>: <span class="string">&quot;Create a directory named &#x27;test_folder&#x27; and create 3 text files in it&quot;</span>,</span><br><span class="line">                <span class="string">&quot;validation&quot;</span>: <span class="keyword">lambda</span>: os.path.exists(<span class="string">&quot;test_folder&quot;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(os.listdir(<span class="string">&quot;test_folder&quot;</span>)) == <span class="number">3</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;task&quot;</span>: <span class="string">&quot;Find all Python files in the current directory and count lines of code&quot;</span>,</span><br><span class="line">                <span class="string">&quot;validation&quot;</span>: <span class="keyword">lambda</span> result: <span class="built_in">isinstance</span>(result, <span class="built_in">int</span>) <span class="keyword">and</span> result &gt; <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;task&quot;</span>: <span class="string">&quot;Monitor CPU usage and alert if it exceeds 80%&quot;</span>,</span><br><span class="line">                <span class="string">&quot;validation&quot;</span>: <span class="keyword">lambda</span> result: <span class="string">&quot;cpu&quot;</span> <span class="keyword">in</span> result.lower()</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        passed = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> task_spec <span class="keyword">in</span> tasks:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = self.agent.run(task_spec[<span class="string">&quot;task&quot;</span>])</span><br><span class="line">                <span class="keyword">if</span> task_spec[<span class="string">&quot;validation&quot;</span>](result):</span><br><span class="line">                    passed += <span class="number">1</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> passed / <span class="built_in">len</span>(tasks)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_test_database_queries</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Test SQL generation and data retrieval&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># Test database with sample data</span></span><br><span class="line">        test_cases = [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;question&quot;</span>: <span class="string">&quot;What is the average age of users who made purchases in the last month?&quot;</span>,</span><br><span class="line">                <span class="string">&quot;expected_tables&quot;</span>: [<span class="string">&quot;users&quot;</span>, <span class="string">&quot;purchases&quot;</span>],</span><br><span class="line">                <span class="string">&quot;expected_operations&quot;</span>: [<span class="string">&quot;JOIN&quot;</span>, <span class="string">&quot;AVG&quot;</span>, <span class="string">&quot;WHERE&quot;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;question&quot;</span>: <span class="string">&quot;List top 5 products by revenue&quot;</span>,</span><br><span class="line">                <span class="string">&quot;expected_tables&quot;</span>: [<span class="string">&quot;products&quot;</span>],</span><br><span class="line">                <span class="string">&quot;expected_operations&quot;</span>: [<span class="string">&quot;ORDER BY&quot;</span>, <span class="string">&quot;LIMIT&quot;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        score = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">case</span> <span class="keyword">in</span> test_cases:</span><br><span class="line">            result = self.agent.run(<span class="string">f&quot;Generate SQL query: <span class="subst">&#123;<span class="keyword">case</span>[<span class="string">&#x27;question&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Check if result contains expected elements</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">all</span>(table <span class="keyword">in</span> result.lower() <span class="keyword">for</span> table <span class="keyword">in</span> <span class="keyword">case</span>[<span class="string">&quot;expected_tables&quot;</span>]):</span><br><span class="line">                score += <span class="number">0.5</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(op <span class="keyword">in</span> result.upper() <span class="keyword">for</span> op <span class="keyword">in</span> <span class="keyword">case</span>[<span class="string">&quot;expected_operations&quot;</span>]):</span><br><span class="line">                score += <span class="number">0.5</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> score / <span class="built_in">len</span>(test_cases)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_test_code_generation</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Test code generation quality&quot;&quot;&quot;</span></span><br><span class="line">        test_problems = [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Write a function to find the longest palindromic substring&quot;</span>,</span><br><span class="line">                <span class="string">&quot;test_cases&quot;</span>: [</span><br><span class="line">                    (<span class="string">&quot;babad&quot;</span>, [<span class="string">&quot;bab&quot;</span>, <span class="string">&quot;aba&quot;</span>]),</span><br><span class="line">                    (<span class="string">&quot;cbbd&quot;</span>, [<span class="string">&quot;bb&quot;</span>])</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Implement binary search on a sorted array&quot;</span>,</span><br><span class="line">                <span class="string">&quot;test_cases&quot;</span>: [</span><br><span class="line">                    (([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="number">3</span>), <span class="number">2</span>),</span><br><span class="line">                    (([<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>], <span class="number">6</span>), -<span class="number">1</span>)</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        passed = <span class="number">0</span></span><br><span class="line">        total = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> problem <span class="keyword">in</span> test_problems:</span><br><span class="line">            code = self.agent.run(<span class="string">f&quot;Write Python code: <span class="subst">&#123;problem[<span class="string">&#x27;description&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Try to execute generated code</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                exec_globals = &#123;&#125;</span><br><span class="line">                <span class="built_in">exec</span>(code, exec_globals)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Find the generated function</span></span><br><span class="line">                func = <span class="built_in">next</span>(v <span class="keyword">for</span> v <span class="keyword">in</span> exec_globals.values() <span class="keyword">if</span> <span class="built_in">callable</span>(v))</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Test all test cases</span></span><br><span class="line">                <span class="keyword">for</span> test_input, expected <span class="keyword">in</span> problem[<span class="string">&quot;test_cases&quot;</span>]:</span><br><span class="line">                    total += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">isinstance</span>(test_input, <span class="built_in">tuple</span>):</span><br><span class="line">                            result = func(*test_input)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            result = func(test_input)</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">isinstance</span>(expected, <span class="built_in">list</span>):</span><br><span class="line">                            <span class="keyword">if</span> result <span class="keyword">in</span> expected:</span><br><span class="line">                                passed += <span class="number">1</span></span><br><span class="line">                        <span class="keyword">elif</span> result == expected:</span><br><span class="line">                            passed += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> passed / <span class="built_in">max</span>(total, <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_calculate_overall_score</span>(<span class="params">self</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.results.values()) / <span class="built_in">len</span>(self.results)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run benchmark</span></span><br><span class="line">benchmark = AgentBenchmark(my_agent)</span><br><span class="line">results = benchmark.run_benchmark_suite()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Overall Score: <span class="subst">&#123;results[<span class="string">&#x27;overall&#x27;</span>]:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;OS Tasks: <span class="subst">&#123;results[<span class="string">&#x27;os_tasks&#x27;</span>]:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Database: <span class="subst">&#123;results[<span class="string">&#x27;database&#x27;</span>]:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Code Generation: <span class="subst">&#123;results[<span class="string">&#x27;code_generation&#x27;</span>]:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="gaia-general-ai-assistant-benchmark">GAIA: General AI Assistant
Benchmark</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GAIAEvaluator</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Evaluates agents on General AI Assistant Benchmark&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, agent</span>):</span><br><span class="line">        self.agent = agent</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">evaluate</span>(<span class="params">self, test_set_path: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Evaluate agent on GAIA benchmark&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Load GAIA test set</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(test_set_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            test_cases = json.load(f)</span><br><span class="line">        </span><br><span class="line">        results = &#123;</span><br><span class="line">            <span class="string">&quot;level_1&quot;</span>: [],  <span class="comment"># Simple factual questions</span></span><br><span class="line">            <span class="string">&quot;level_2&quot;</span>: [],  <span class="comment"># Multi-step reasoning</span></span><br><span class="line">            <span class="string">&quot;level_3&quot;</span>: []   <span class="comment"># Complex real-world tasks</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">case</span> <span class="keyword">in</span> test_cases:</span><br><span class="line">            level = <span class="keyword">case</span>[<span class="string">&quot;level&quot;</span>]</span><br><span class="line">            question = <span class="keyword">case</span>[<span class="string">&quot;question&quot;</span>]</span><br><span class="line">            expected_answer = <span class="keyword">case</span>[<span class="string">&quot;answer&quot;</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Agent attempts to answer</span></span><br><span class="line">            agent_answer = self.agent.run(question)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Evaluate answer</span></span><br><span class="line">            is_correct = self._evaluate_answer(</span><br><span class="line">                agent_answer,</span><br><span class="line">                expected_answer,</span><br><span class="line">                <span class="keyword">case</span>.get(<span class="string">&quot;evaluation_criteria&quot;</span>, &#123;&#125;)</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            results[<span class="string">f&quot;level_<span class="subst">&#123;level&#125;</span>&quot;</span>].append(&#123;</span><br><span class="line">                <span class="string">&quot;question&quot;</span>: question,</span><br><span class="line">                <span class="string">&quot;expected&quot;</span>: expected_answer,</span><br><span class="line">                <span class="string">&quot;agent_answer&quot;</span>: agent_answer,</span><br><span class="line">                <span class="string">&quot;correct&quot;</span>: is_correct</span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Calculate scores</span></span><br><span class="line">        summary = &#123;</span><br><span class="line">            <span class="string">&quot;level_1_accuracy&quot;</span>: self._calculate_accuracy(results[<span class="string">&quot;level_1&quot;</span>]),</span><br><span class="line">            <span class="string">&quot;level_2_accuracy&quot;</span>: self._calculate_accuracy(results[<span class="string">&quot;level_2&quot;</span>]),</span><br><span class="line">            <span class="string">&quot;level_3_accuracy&quot;</span>: self._calculate_accuracy(results[<span class="string">&quot;level_3&quot;</span>]),</span><br><span class="line">            <span class="string">&quot;overall_accuracy&quot;</span>: self._calculate_overall_accuracy(results)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;detailed_results&quot;</span>: results,</span><br><span class="line">            <span class="string">&quot;summary&quot;</span>: summary</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_evaluate_answer</span>(<span class="params">self, agent_answer: <span class="built_in">str</span>, expected: <span class="built_in">str</span>, </span></span><br><span class="line"><span class="params">                        criteria: <span class="type">Dict</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Evaluate if agent answer matches expected answer&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Exact match</span></span><br><span class="line">        <span class="keyword">if</span> agent_answer.strip().lower() == expected.strip().lower():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Numerical tolerance</span></span><br><span class="line">        <span class="keyword">if</span> criteria.get(<span class="string">&quot;type&quot;</span>) == <span class="string">&quot;numerical&quot;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                agent_num = <span class="built_in">float</span>(agent_answer)</span><br><span class="line">                expected_num = <span class="built_in">float</span>(expected)</span><br><span class="line">                tolerance = criteria.get(<span class="string">&quot;tolerance&quot;</span>, <span class="number">0.01</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">abs</span>(agent_num - expected_num) / expected_num &lt; tolerance</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Semantic similarity (using LLM)</span></span><br><span class="line">        <span class="keyword">if</span> criteria.get(<span class="string">&quot;type&quot;</span>) == <span class="string">&quot;semantic&quot;</span>:</span><br><span class="line">            eval_prompt = <span class="string">f&quot;&quot;&quot;Are these two answers semantically equivalent?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Answer 1: <span class="subst">&#123;agent_answer&#125;</span></span></span><br><span class="line"><span class="string">Answer 2: <span class="subst">&#123;expected&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Respond with only &quot;Yes&quot; or &quot;No&quot;.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">            evaluation = self.agent.llm.predict(eval_prompt)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;yes&quot;</span> <span class="keyword">in</span> evaluation.lower()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_calculate_accuracy</span>(<span class="params">self, results: <span class="type">List</span>[<span class="type">Dict</span>]</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> results:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0.0</span></span><br><span class="line">        correct = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> r <span class="keyword">in</span> results <span class="keyword">if</span> r[<span class="string">&quot;correct&quot;</span>])</span><br><span class="line">        <span class="keyword">return</span> correct / <span class="built_in">len</span>(results)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_calculate_overall_accuracy</span>(<span class="params">self, results: <span class="type">Dict</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        all_results = []</span><br><span class="line">        <span class="keyword">for</span> level_results <span class="keyword">in</span> results.values():</span><br><span class="line">            all_results.extend(level_results)</span><br><span class="line">        <span class="keyword">return</span> self._calculate_accuracy(all_results)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example usage</span></span><br><span class="line">gaia_eval = GAIAEvaluator(my_agent)</span><br><span class="line">results = gaia_eval.evaluate(<span class="string">&quot;gaia_test_set.json&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;GAIA Benchmark Results:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Level 1 (Simple): <span class="subst">&#123;results[<span class="string">&#x27;summary&#x27;</span>][<span class="string">&#x27;level_1_accuracy&#x27;</span>]:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Level 2 (Multi-step): <span class="subst">&#123;results[<span class="string">&#x27;summary&#x27;</span>][<span class="string">&#x27;level_2_accuracy&#x27;</span>]:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Level 3 (Complex): <span class="subst">&#123;results[<span class="string">&#x27;summary&#x27;</span>][<span class="string">&#x27;level_3_accuracy&#x27;</span>]:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Overall: <span class="subst">&#123;results[<span class="string">&#x27;summary&#x27;</span>][<span class="string">&#x27;overall_accuracy&#x27;</span>]:<span class="number">.2</span>%&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="production-deployment-and-best-practices">Production Deployment
and Best Practices</h2>
<h3 id="error-handling-and-robustness">Error Handling and
Robustness</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RobustAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, tools, max_retries=<span class="number">3</span></span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.tools = tools</span><br><span class="line">        self.max_retries = max_retries</span><br><span class="line">        self.error_log = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_with_retry</span>(<span class="params">self, task: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Execute task with automatic retry on failure&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="built_in">range</span>(self.max_retries):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = self._execute_internal(task)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Validate result</span></span><br><span class="line">                <span class="keyword">if</span> self._is_valid_result(result):</span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                        <span class="string">&quot;result&quot;</span>: result,</span><br><span class="line">                        <span class="string">&quot;attempts&quot;</span>: attempt + <span class="number">1</span></span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid result format&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                self.error_log.append(&#123;</span><br><span class="line">                    <span class="string">&quot;attempt&quot;</span>: attempt + <span class="number">1</span>,</span><br><span class="line">                    <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                    <span class="string">&quot;task&quot;</span>: task,</span><br><span class="line">                    <span class="string">&quot;timestamp&quot;</span>: datetime.now()</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> attempt &lt; self.max_retries - <span class="number">1</span>:</span><br><span class="line">                    <span class="comment"># Generate recovery strategy</span></span><br><span class="line">                    recovery = self._generate_recovery_strategy(task, e)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Attempt <span class="subst">&#123;attempt + <span class="number">1</span>&#125;</span> failed. Recovery: <span class="subst">&#123;recovery&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                        <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                        <span class="string">&quot;attempts&quot;</span>: self.max_retries,</span><br><span class="line">                        <span class="string">&quot;error_log&quot;</span>: self.error_log[-self.max_retries:]</span><br><span class="line">                    &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;success&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;error&quot;</span>: <span class="string">&quot;Max retries exceeded&quot;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_execute_internal</span>(<span class="params">self, task: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="comment"># Actual execution logic</span></span><br><span class="line">        <span class="keyword">return</span> self.agent_logic(task)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_is_valid_result</span>(<span class="params">self, result</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Validate that result meets quality criteria&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> result <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(result, <span class="built_in">str</span>) <span class="keyword">and</span> <span class="built_in">len</span>(result.strip()) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(result, <span class="built_in">dict</span>) <span class="keyword">and</span> <span class="keyword">not</span> result:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_recovery_strategy</span>(<span class="params">self, task: <span class="built_in">str</span>, error: Exception</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        recovery_prompt = <span class="string">f&quot;&quot;&quot;The agent failed with this error:</span></span><br><span class="line"><span class="string">Task: <span class="subst">&#123;task&#125;</span></span></span><br><span class="line"><span class="string">Error: <span class="subst">&#123;<span class="built_in">str</span>(error)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Suggest a recovery strategy to fix this issue.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.llm.predict(recovery_prompt)</span><br></pre></td></tr></table></figure>
<h3 id="rate-limiting-and-cost-management">Rate Limiting and Cost
Management</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CostManagedAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm, tools, max_cost_per_hour=<span class="number">10.0</span></span>):</span><br><span class="line">        self.llm = llm</span><br><span class="line">        self.tools = tools</span><br><span class="line">        self.max_cost_per_hour = max_cost_per_hour</span><br><span class="line">        self.cost_tracker = deque()  <span class="comment"># (timestamp, cost) tuples</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, task: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="comment"># Check if we&#x27;re within budget</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._check_budget():</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="string">&quot;Cost limit exceeded for this hour&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Estimate cost before execution</span></span><br><span class="line">        estimated_cost = self._estimate_cost(task)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> self._would_exceed_budget(estimated_cost):</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="string">f&quot;Task would exceed budget (estimated: $<span class="subst">&#123;estimated_cost:<span class="number">.2</span>f&#125;</span>)&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Execute task</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        result = self._execute_task(task)</span><br><span class="line">        execution_time = time.time() - start_time</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Calculate actual cost</span></span><br><span class="line">        actual_cost = self._calculate_cost(task, result, execution_time)</span><br><span class="line">        self.cost_tracker.append((time.time(), actual_cost))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&quot;result&quot;</span>: result,</span><br><span class="line">            <span class="string">&quot;cost&quot;</span>: actual_cost,</span><br><span class="line">            <span class="string">&quot;execution_time&quot;</span>: execution_time</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_budget</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="comment"># Remove entries older than 1 hour</span></span><br><span class="line">        current_time = time.time()</span><br><span class="line">        <span class="keyword">while</span> self.cost_tracker <span class="keyword">and</span> current_time - self.cost_tracker[<span class="number">0</span>][<span class="number">0</span>] &gt; <span class="number">3600</span>:</span><br><span class="line">            self.cost_tracker.popleft()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Calculate hourly cost</span></span><br><span class="line">        hourly_cost = <span class="built_in">sum</span>(cost <span class="keyword">for</span> _, cost <span class="keyword">in</span> self.cost_tracker)</span><br><span class="line">        <span class="keyword">return</span> hourly_cost &lt; self.max_cost_per_hour</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_estimate_cost</span>(<span class="params">self, task: <span class="built_in">str</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">        <span class="comment"># Rough estimation based on task complexity</span></span><br><span class="line">        token_estimate = <span class="built_in">len</span>(task.split()) * <span class="number">2</span>  <span class="comment"># Simple heuristic</span></span><br><span class="line">        cost_per_1k_tokens = <span class="number">0.03</span>  <span class="comment"># GPT-4 pricing</span></span><br><span class="line">        <span class="keyword">return</span> (token_estimate / <span class="number">1000</span>) * cost_per_1k_tokens</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_would_exceed_budget</span>(<span class="params">self, additional_cost: <span class="built_in">float</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        current_hourly_cost = <span class="built_in">sum</span>(cost <span class="keyword">for</span> _, cost <span class="keyword">in</span> self.cost_tracker)</span><br><span class="line">        <span class="keyword">return</span> current_hourly_cost + additional_cost &gt; self.max_cost_per_hour</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_cost_report</span>(<span class="params">self</span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        current_time = time.time()</span><br><span class="line">        hourly_cost = <span class="built_in">sum</span>(</span><br><span class="line">            cost <span class="keyword">for</span> timestamp, cost <span class="keyword">in</span> self.cost_tracker</span><br><span class="line">            <span class="keyword">if</span> current_time - timestamp &lt;= <span class="number">3600</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;hourly_cost&quot;</span>: hourly_cost,</span><br><span class="line">            <span class="string">&quot;remaining_budget&quot;</span>: self.max_cost_per_hour - hourly_cost,</span><br><span class="line">            <span class="string">&quot;total_requests&quot;</span>: <span class="built_in">len</span>(self.cost_tracker)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h3 id="q1-whats-the-difference-between-an-ai-agent-and-a-chatbot">Q1:
What's the difference between an AI Agent and a chatbot?</h3>
<p>A chatbot is designed for conversational interactions and responds to
user inputs in a dialogue format. It's reactive and waits for user
prompts. An AI Agent, on the other hand, is proactive and goal-oriented.
It can:</p>
<ul>
<li>Break down complex tasks autonomously</li>
<li>Use external tools without explicit instructions</li>
<li>Maintain state and context across multiple steps</li>
<li>Make decisions about what to do next based on intermediate
results</li>
</ul>
<p>Example: A chatbot might answer "What's the weather?" with weather
information. An agent given the goal "Plan my day" would check the
weather, review your calendar, suggest activities based on weather
conditions, and potentially book reservations.</p>
<h3 id="q2-how-do-i-choose-between-different-planning-strategies-cot-react-tot">Q2:
How do I choose between different planning strategies (CoT, ReAct,
ToT)?</h3>
<p>Choose based on task complexity and resource constraints:</p>
<ul>
<li><strong>Chain-of-Thought (CoT)</strong>: Best for straightforward
reasoning tasks where the path to solution is relatively linear. Fast
and cost-effective.
<ul>
<li>Use when: Tasks have clear sequential steps, like math problems or
logical puzzles</li>
</ul></li>
<li><strong>ReAct</strong>: Ideal when the agent needs to gather
information during execution. Balances reasoning with action.
<ul>
<li>Use when: Tasks require external data, like "Research topic X and
summarize findings"</li>
</ul></li>
<li><strong>Tree of Thoughts (ToT)</strong>: For complex problems with
multiple viable approaches where exploration is valuable. More
expensive.
<ul>
<li>Use when: Tasks are open-ended with trade-offs, like "Design a
system architecture"</li>
</ul></li>
</ul>
<h3 id="q3-how-much-memory-should-my-agent-have">Q3: How much memory
should my agent have?</h3>
<p>Memory requirements depend on task complexity:</p>
<ul>
<li><strong>Short conversations (&lt; 10 exchanges)</strong>:
Conversation buffer (4000-8000 tokens) is sufficient</li>
<li><strong>Long sessions with context requirements</strong>: Add
semantic memory with vector database</li>
<li><strong>Learning from past experiences</strong>: Implement episodic
memory to store task outcomes</li>
<li><strong>Entity tracking</strong>: Add entity memory for applications
involving multiple people/places/things</li>
</ul>
<p>Start simple with conversation buffer, then add specialized memory as
needs emerge.</p>
<h3 id="q4-when-should-i-use-multiple-agents-vs.-a-single-powerful-agent">Q4:
When should I use multiple agents vs. a single powerful agent?</h3>
<p>Use multiple agents when:</p>
<ul>
<li>Tasks naturally decompose into specialized roles (research,
analysis, writing)</li>
<li>Different subtasks require different tools or expertise</li>
<li>You want parallelization for speed</li>
<li>Individual agents can be simpler and more reliable than one complex
agent</li>
</ul>
<p>Use a single agent when:</p>
<ul>
<li>Tasks are tightly coupled and require constant context sharing</li>
<li>Coordination overhead would outweigh benefits</li>
<li>The problem domain is narrow and well-defined</li>
</ul>
<h3 id="q5-how-do-i-handle-agent-hallucinations-in-production">Q5: How
do I handle agent hallucinations in production?</h3>
<p>Implement multiple safeguards:</p>
<ol type="1">
<li><strong>Grounding</strong>: Always retrieve factual information from
reliable sources rather than relying on LLM knowledge</li>
<li><strong>Verification</strong>: Have agents cite sources and
cross-reference information</li>
<li><strong>Confidence scoring</strong>: Ask the LLM to provide
confidence levels for its outputs</li>
<li><strong>Human-in-the-loop</strong>: For critical decisions, require
human approval</li>
<li><strong>Reflection</strong>: Use self-critique mechanisms to catch
obvious errors</li>
</ol>
<p>Example verification pattern:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">verified_fact_retrieval</span>(<span class="params">agent, question</span>):</span><br><span class="line">    <span class="comment"># Step 1: Search for answer</span></span><br><span class="line">    answer = agent.search(question)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 2: Find supporting evidence</span></span><br><span class="line">    evidence = agent.search(<span class="string">f&quot;evidence for: <span class="subst">&#123;answer&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 3: Verify consistency</span></span><br><span class="line">    verification = agent.llm.predict(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Question: <span class="subst">&#123;question&#125;</span></span></span><br><span class="line"><span class="string">        Answer: <span class="subst">&#123;answer&#125;</span></span></span><br><span class="line"><span class="string">        Evidence: <span class="subst">&#123;evidence&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Is the answer consistent with the evidence? </span></span><br><span class="line"><span class="string">        Identify any contradictions.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;answer&quot;</span>: answer,</span><br><span class="line">        <span class="string">&quot;evidence&quot;</span>: evidence,</span><br><span class="line">        <span class="string">&quot;verification&quot;</span>: verification</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="q6-what-are-the-main-failure-modes-of-ai-agents">Q6: What are
the main failure modes of AI agents?</h3>
<p>Common failure patterns:</p>
<ol type="1">
<li><strong>Infinite loops</strong>: Agent gets stuck repeating the same
action
<ul>
<li>Mitigation: Set max iteration limits, detect repetition
patterns</li>
</ul></li>
<li><strong>Tool misuse</strong>: Agent calls tools incorrectly or with
invalid parameters
<ul>
<li>Mitigation: Strict parameter validation, provide clear tool
documentation</li>
</ul></li>
<li><strong>Context loss</strong>: Agent forgets important information
from earlier steps
<ul>
<li>Mitigation: Implement proper memory systems, summarize
periodically</li>
</ul></li>
<li><strong>Goal drift</strong>: Agent pursues tangential objectives
<ul>
<li>Mitigation: Regular goal checking, explicit success criteria</li>
</ul></li>
<li><strong>Over-confidence</strong>: Agent proceeds with uncertain
information
<ul>
<li>Mitigation: Implement confidence thresholds, require
verification</li>
</ul></li>
</ol>
<h3 id="q7-how-do-i-evaluate-if-my-agent-is-working-well">Q7: How do I
evaluate if my agent is working well?</h3>
<p>Implement multi-level evaluation:</p>
<p><strong>Functional Testing</strong>: - Define test cases with clear
inputs and expected outputs - Measure success rate on standard tasks</p>
<p><strong>Efficiency Metrics</strong>: - Steps required to complete
tasks - Token usage and API costs - Time to completion</p>
<p><strong>Quality Metrics</strong>: - Accuracy of final outputs
(compared to ground truth) - Appropriateness of tool selection -
Coherence of reasoning chains</p>
<p><strong>User Experience</strong>: - Satisfaction scores from end
users - Task completion rates - Error recovery success</p>
<h3 id="q8-should-i-use-open-source-or-proprietary-llms-for-my-agent">Q8:
Should I use open-source or proprietary LLMs for my agent?</h3>
<p>Considerations:</p>
<p><strong>Proprietary (GPT-4, Claude)</strong>: - Pros: Superior
reasoning, better tool use, less prompt engineering needed - Cons:
Ongoing API costs, potential latency, data privacy concerns - Best for:
Production applications where quality is critical</p>
<p><strong>Open-source (Llama, Mistral)</strong>: - Pros: No per-token
costs, full data control, customizable - Cons: Requires infrastructure,
may need fine-tuning, potentially lower quality - Best for: High-volume
applications, sensitive data, budget constraints</p>
<p>Many production systems use hybrid approaches: proprietary LLMs for
complex reasoning, open-source for routine tasks.</p>
<h3 id="q9-how-do-i-prevent-my-agent-from-taking-harmful-actions">Q9:
How do I prevent my agent from taking harmful actions?</h3>
<p>Implement safety layers:</p>
<ol type="1">
<li><strong>Action whitelist</strong>: Explicitly define allowed actions
and tools</li>
<li><strong>Approval gates</strong>: Require confirmation for high-risk
actions</li>
<li><strong>Sandbox environments</strong>: Test agent behavior in
isolated environments first</li>
<li><strong>Output filtering</strong>: Screen agent outputs for harmful
content</li>
<li><strong>Monitoring and alerts</strong>: Track agent behavior and
flag anomalies</li>
</ol>
<p>Example safety wrapper:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SafeAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_agent, forbidden_actions</span>):</span><br><span class="line">        self.base_agent = base_agent</span><br><span class="line">        self.forbidden_actions = forbidden_actions</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, task</span>):</span><br><span class="line">        <span class="comment"># Check task safety before execution</span></span><br><span class="line">        <span class="keyword">if</span> self._is_forbidden(task):</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="string">&quot;Task involves forbidden actions&quot;</span>,</span><br><span class="line">                <span class="string">&quot;blocked_action&quot;</span>: self._identify_forbidden(task)</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Execute with monitoring</span></span><br><span class="line">        result = self.base_agent.execute(task)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Audit log</span></span><br><span class="line">        self._log_action(task, result)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<h3 id="q10-whats-the-future-direction-of-ai-agents">Q10: What's the
future direction of AI agents?</h3>
<p>Emerging trends:</p>
<ol type="1">
<li><strong>Longer context windows</strong>: Enabling agents to maintain
more information without external memory</li>
<li><strong>Multimodal agents</strong>: Processing and generating
images, audio, video alongside text</li>
<li><strong>Improved reasoning</strong>: Better planning, more reliable
multi-step execution</li>
<li><strong>Agent marketplaces</strong>: Ecosystems of specialized
agents that can be composed</li>
<li><strong>Embodied agents</strong>: Integration with robotics and
physical systems</li>
<li><strong>Formal verification</strong>: Mathematical proofs of agent
behavior and safety</li>
<li><strong>Self-improvement</strong>: Agents that can autonomously
improve their own capabilities</li>
</ol>
<p>The field is rapidly evolving, with new architectures and techniques
emerging continuously.</p>
<h2 id="conclusion">Conclusion</h2>
<p>AI Agents represent a paradigm shift from passive language models to
active, goal-oriented systems that can autonomously solve complex
real-world problems. By combining planning, memory, tool use, and
reflection, agents extend the capabilities of LLMs far beyond text
generation.</p>
<p>We've explored the foundational concepts that distinguish agents from
simple LLM interactions, examined the core capabilities that enable
agent behavior, surveyed popular frameworks and implementation patterns,
and discussed multi-agent systems and evaluation methodologies. We've
also covered critical production concerns like error handling, cost
management, and safety considerations.</p>
<p>The key takeaways for building effective agents:</p>
<ol type="1">
<li><strong>Start simple</strong>: Begin with basic ReAct-style agents
before adding complexity</li>
<li><strong>Memory matters</strong>: Implement appropriate memory
systems for your use case</li>
<li><strong>Tool quality is crucial</strong>: Well-designed, reliable
tools are more important than clever prompting</li>
<li><strong>Plan for failure</strong>: Agents will fail; build robust
error handling and recovery</li>
<li><strong>Evaluate continuously</strong>: Establish metrics and test
regularly</li>
<li><strong>Safety first</strong>: Implement guardrails and monitoring
from the start</li>
</ol>
<p>As you build your own agents, remember that this is still an emerging
field. Experimentation, iteration, and learning from failures are
essential parts of the process. The techniques and patterns described
here provide a solid foundation, but the most effective agent
architectures will emerge from hands-on experience with real-world
problems.</p>
<p>The future of AI agents is promising, with rapid advances in
reasoning capabilities, tool use, and multi-agent coordination. By
understanding the principles and practices outlined in this guide,
you're well-equipped to harness these powerful systems and push the
boundaries of what's possible with AI.</p>
<hr>
<p><strong>Additional Resources</strong>:</p>
<ul>
<li>LangChain Documentation: https://docs.langchain.com/</li>
<li>AutoGPT Repository:
https://github.com/Significant-Gravitas/AutoGPT</li>
<li>AgentBench Paper: https://arxiv.org/abs/2308.03688</li>
<li>GAIA Benchmark: https://arxiv.org/abs/2311.12983</li>
<li>OpenAI Function Calling:
https://platform.openai.com/docs/guides/function-calling</li>
</ul>
<p>This article has covered the fundamental concepts, practical
implementations, and advanced considerations for building and deploying
AI agents. Whether you're creating simple task automation or complex
multi-agent systems, these principles and patterns will serve as a
comprehensive guide to success in the rapidly evolving field of AI
agents.</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    
    
    
    
    
    
    <ul>
        <li>Post titleAI Agents Complete Guide: From Theory to Industrial Practice</li>
        <li>Post authorChen Kai</li>
        <li>Create time2025-04-03 00:00:00</li>
        <li>
            Post linkhttps://www.chenk.top/en/ai-agents-complete-guide/
        </li>
        <li>
            Copyright NoticeAll articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/en/tags/LLM/">#LLM</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/en/tags/AI-Agents/">#AI Agents</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/en/tags/Applications/">#Applications</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/en/cloud-computing-fundamentals-architecture/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Cloud Computing (1): Fundamentals and Architecture Systems</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/en/Solving%20Constrained%20Mean-Variance%20Portfolio%20Optimization%20Problems%20Using%20Spiral%20Optimization%20Algorithm/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Solving Constrained Mean-Variance Portfolio Optimization Problems Using Spiral Optimization Algorithm</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'p2Cu9MgjoKzo3VmulhNLIusH-gzGzoHsz',
                    appKey: 'QThQHg3c8sVwGpzg9lu8zEG3',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: ' ck~',
                    lang: 'en'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'Chen Kai';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2026&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Chen Kai</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
            </div>
        
        <div class="theme-info info-item">
            <!-- Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a> -->
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#what-are-ai-agents"><span class="nav-number">1.</span> <span class="nav-text">What Are AI Agents?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#from-static-llms-to-dynamic-agents"><span class="nav-number">1.1.</span> <span class="nav-text">From Static LLMs to Dynamic
Agents</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#core-components-of-ai-agents"><span class="nav-number">1.2.</span> <span class="nav-text">Core Components of AI Agents</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ai-agents-vs.-traditional-llms-a-direct-comparison"><span class="nav-number">1.3.</span> <span class="nav-text">AI Agents
vs. Traditional LLMs: A Direct Comparison</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#core-capabilities-of-ai-agents"><span class="nav-number">2.</span> <span class="nav-text">Core Capabilities of AI
Agents</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#planning-and-task-decomposition"><span class="nav-number">2.1.</span> <span class="nav-text">Planning and Task
Decomposition</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#chain-of-thought-planning"><span class="nav-number">2.1.1.</span> <span class="nav-text">Chain-of-Thought Planning</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#react-reasoning-acting"><span class="nav-number">2.1.2.</span> <span class="nav-text">ReAct: Reasoning + Acting</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tree-of-thoughts-exploring-multiple-reasoning-paths"><span class="nav-number">2.1.3.</span> <span class="nav-text">Tree of
Thoughts: Exploring Multiple Reasoning Paths</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memory-architecture"><span class="nav-number">2.2.</span> <span class="nav-text">Memory Architecture</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#working-memory-conversation-buffer"><span class="nav-number">2.2.1.</span> <span class="nav-text">Working Memory (Conversation
Buffer)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#entity-memory-tracking-important-information"><span class="nav-number">2.2.2.</span> <span class="nav-text">Entity Memory:
Tracking Important Information</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#semantic-memory-vector-based-retrieval"><span class="nav-number">2.2.3.</span> <span class="nav-text">Semantic Memory:
Vector-based Retrieval</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#episodic-memory-learning-from-experience"><span class="nav-number">2.2.4.</span> <span class="nav-text">Episodic Memory:
Learning from Experience</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tool-use-and-function-calling"><span class="nav-number">2.3.</span> <span class="nav-text">Tool Use and Function
Calling</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#function-calling-with-openai-api"><span class="nav-number">2.3.1.</span> <span class="nav-text">Function Calling with OpenAI
API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#building-custom-tool-executors"><span class="nav-number">2.3.2.</span> <span class="nav-text">Building Custom Tool
Executors</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reflection-and-self-improvement"><span class="nav-number">2.4.</span> <span class="nav-text">Reflection and
Self-Improvement</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#reflexionagent-learning-from-mistakes"><span class="nav-number">2.4.1.</span> <span class="nav-text">ReflexionAgent: Learning
from Mistakes</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#popular-ai-agent-frameworks"><span class="nav-number">3.</span> <span class="nav-text">Popular AI Agent Frameworks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#langchain-modular-agent-framework"><span class="nav-number">3.1.</span> <span class="nav-text">LangChain: Modular Agent
Framework</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#basic-langchain-agent"><span class="nav-number">3.1.1.</span> <span class="nav-text">Basic LangChain Agent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#custom-langchain-agent-with-memory"><span class="nav-number">3.1.2.</span> <span class="nav-text">Custom LangChain Agent with
Memory</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#autogpt-autonomous-task-execution"><span class="nav-number">3.2.</span> <span class="nav-text">AutoGPT: Autonomous Task
Execution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#babyagi-task-driven-autonomous-agent"><span class="nav-number">3.3.</span> <span class="nav-text">BabyAGI: Task-Driven
Autonomous Agent</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#multi-agent-systems"><span class="nav-number">4.</span> <span class="nav-text">Multi-Agent Systems</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#agent-collaboration-patterns"><span class="nav-number">4.1.</span> <span class="nav-text">Agent Collaboration Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#hierarchical-organization"><span class="nav-number">4.1.1.</span> <span class="nav-text">Hierarchical Organization</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#debate-and-consensus"><span class="nav-number">4.1.2.</span> <span class="nav-text">Debate and Consensus</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#communication-protocols"><span class="nav-number">4.2.</span> <span class="nav-text">Communication Protocols</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#evaluation-and-benchmarking"><span class="nav-number">5.</span> <span class="nav-text">Evaluation and Benchmarking</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#agentbench-comprehensive-agent-evaluation"><span class="nav-number">5.1.</span> <span class="nav-text">AgentBench:
Comprehensive Agent Evaluation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gaia-general-ai-assistant-benchmark"><span class="nav-number">5.2.</span> <span class="nav-text">GAIA: General AI Assistant
Benchmark</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#production-deployment-and-best-practices"><span class="nav-number">6.</span> <span class="nav-text">Production Deployment
and Best Practices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#error-handling-and-robustness"><span class="nav-number">6.1.</span> <span class="nav-text">Error Handling and
Robustness</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rate-limiting-and-cost-management"><span class="nav-number">6.2.</span> <span class="nav-text">Rate Limiting and Cost
Management</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#frequently-asked-questions"><span class="nav-number">7.</span> <span class="nav-text">Frequently Asked Questions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#q1-whats-the-difference-between-an-ai-agent-and-a-chatbot"><span class="nav-number">7.1.</span> <span class="nav-text">Q1:
What&#39;s the difference between an AI Agent and a chatbot?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q2-how-do-i-choose-between-different-planning-strategies-cot-react-tot"><span class="nav-number">7.2.</span> <span class="nav-text">Q2:
How do I choose between different planning strategies (CoT, ReAct,
ToT)?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q3-how-much-memory-should-my-agent-have"><span class="nav-number">7.3.</span> <span class="nav-text">Q3: How much memory
should my agent have?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q4-when-should-i-use-multiple-agents-vs.-a-single-powerful-agent"><span class="nav-number">7.4.</span> <span class="nav-text">Q4:
When should I use multiple agents vs. a single powerful agent?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q5-how-do-i-handle-agent-hallucinations-in-production"><span class="nav-number">7.5.</span> <span class="nav-text">Q5: How
do I handle agent hallucinations in production?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q6-what-are-the-main-failure-modes-of-ai-agents"><span class="nav-number">7.6.</span> <span class="nav-text">Q6: What are
the main failure modes of AI agents?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q7-how-do-i-evaluate-if-my-agent-is-working-well"><span class="nav-number">7.7.</span> <span class="nav-text">Q7: How do I
evaluate if my agent is working well?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q8-should-i-use-open-source-or-proprietary-llms-for-my-agent"><span class="nav-number">7.8.</span> <span class="nav-text">Q8:
Should I use open-source or proprietary LLMs for my agent?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q9-how-do-i-prevent-my-agent-from-taking-harmful-actions"><span class="nav-number">7.9.</span> <span class="nav-text">Q9:
How do I prevent my agent from taking harmful actions?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#q10-whats-the-future-direction-of-ai-agents"><span class="nav-number">7.10.</span> <span class="nav-text">Q10: What&#39;s the
future direction of AI agents?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#conclusion"><span class="nav-number">8.</span> <span class="nav-text">Conclusion</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>

<script src="/js/lang-switch.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
